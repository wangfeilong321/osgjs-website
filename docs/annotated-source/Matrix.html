<!DOCTYPE html>

<html>
<head>
  <title>Matrix.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="OSG.html">
                OSG.js
              </a>
            
              
              <a class="source" href="BillboardAttribute.html">
                BillboardAttribute.js
              </a>
            
              
              <a class="source" href="BlendColor.html">
                BlendColor.js
              </a>
            
              
              <a class="source" href="BlendFunc.html">
                BlendFunc.js
              </a>
            
              
              <a class="source" href="BoundingBox.html">
                BoundingBox.js
              </a>
            
              
              <a class="source" href="BoundingSphere.html">
                BoundingSphere.js
              </a>
            
              
              <a class="source" href="BufferArray.html">
                BufferArray.js
              </a>
            
              
              <a class="source" href="BufferArrayProxy.html">
                BufferArrayProxy.js
              </a>
            
              
              <a class="source" href="Camera.html">
                Camera.js
              </a>
            
              
              <a class="source" href="ColorMask.html">
                ColorMask.js
              </a>
            
              
              <a class="source" href="ComputeBoundsVisitor.html">
                ComputeBoundsVisitor.js
              </a>
            
              
              <a class="source" href="ComputeMatrixFromNodePath.html">
                ComputeMatrixFromNodePath.js
              </a>
            
              
              <a class="source" href="CullFace.html">
                CullFace.js
              </a>
            
              
              <a class="source" href="CullSettings.html">
                CullSettings.js
              </a>
            
              
              <a class="source" href="CullStack.html">
                CullStack.js
              </a>
            
              
              <a class="source" href="CullVisitor.html">
                CullVisitor.js
              </a>
            
              
              <a class="source" href="CullingSet.html">
                CullingSet.js
              </a>
            
              
              <a class="source" href="Depth.html">
                Depth.js
              </a>
            
              
              <a class="source" href="DrawArrayLengths.html">
                DrawArrayLengths.js
              </a>
            
              
              <a class="source" href="DrawArrays.html">
                DrawArrays.js
              </a>
            
              
              <a class="source" href="DrawElements.html">
                DrawElements.js
              </a>
            
              
              <a class="source" href="EllipsoidModel.html">
                EllipsoidModel.js
              </a>
            
              
              <a class="source" href="FrameBufferObject.html">
                FrameBufferObject.js
              </a>
            
              
              <a class="source" href="FrameStamp.html">
                FrameStamp.js
              </a>
            
              
              <a class="source" href="GLObject.html">
                GLObject.js
              </a>
            
              
              <a class="source" href="Geometry.html">
                Geometry.js
              </a>
            
              
              <a class="source" href="Image.html">
                Image.js
              </a>
            
              
              <a class="source" href="ImageStream.html">
                ImageStream.js
              </a>
            
              
              <a class="source" href="KdTree.html">
                KdTree.js
              </a>
            
              
              <a class="source" href="KdTreeBuilder.html">
                KdTreeBuilder.js
              </a>
            
              
              <a class="source" href="KdTreeRayIntersector.html">
                KdTreeRayIntersector.js
              </a>
            
              
              <a class="source" href="KdTreeSphereIntersector.html">
                KdTreeSphereIntersector.js
              </a>
            
              
              <a class="source" href="Light.html">
                Light.js
              </a>
            
              
              <a class="source" href="LightSource.html">
                LightSource.js
              </a>
            
              
              <a class="source" href="LineWidth.html">
                LineWidth.js
              </a>
            
              
              <a class="source" href="Lod.html">
                Lod.js
              </a>
            
              
              <a class="source" href="Map.html">
                Map.js
              </a>
            
              
              <a class="source" href="Material.html">
                Material.js
              </a>
            
              
              <a class="source" href="Math.html">
                Math.js
              </a>
            
              
              <a class="source" href="Matrix.html">
                Matrix.js
              </a>
            
              
              <a class="source" href="MatrixMemoryPool.html">
                MatrixMemoryPool.js
              </a>
            
              
              <a class="source" href="MatrixTransform.html">
                MatrixTransform.js
              </a>
            
              
              <a class="source" href="Node.html">
                Node.js
              </a>
            
              
              <a class="source" href="NodeVisitor.html">
                NodeVisitor.js
              </a>
            
              
              <a class="source" href="Notify.html">
                Notify.js
              </a>
            
              
              <a class="source" href="Object.html">
                Object.js
              </a>
            
              
              <a class="source" href="Options.html">
                Options.js
              </a>
            
              
              <a class="source" href="PagedLOD.html">
                PagedLOD.js
              </a>
            
              
              <a class="source" href="Plane.html">
                Plane.js
              </a>
            
              
              <a class="source" href="Polytope.html">
                Polytope.js
              </a>
            
              
              <a class="source" href="PrimitiveFunctor.html">
                PrimitiveFunctor.js
              </a>
            
              
              <a class="source" href="PrimitiveSet.html">
                PrimitiveSet.js
              </a>
            
              
              <a class="source" href="Program.html">
                Program.js
              </a>
            
              
              <a class="source" href="Projection.html">
                Projection.js
              </a>
            
              
              <a class="source" href="Quat.html">
                Quat.js
              </a>
            
              
              <a class="source" href="RenderBin.html">
                RenderBin.js
              </a>
            
              
              <a class="source" href="RenderLeaf.html">
                RenderLeaf.js
              </a>
            
              
              <a class="source" href="RenderStage.html">
                RenderStage.js
              </a>
            
              
              <a class="source" href="Shader.html">
                Shader.js
              </a>
            
              
              <a class="source" href="Shape.html">
                Shape.js
              </a>
            
              
              <a class="source" href="Stack.html">
                Stack.js
              </a>
            
              
              <a class="source" href="State.html">
                State.js
              </a>
            
              
              <a class="source" href="StateAttribute.html">
                StateAttribute.js
              </a>
            
              
              <a class="source" href="StateGraph.html">
                StateGraph.js
              </a>
            
              
              <a class="source" href="StateSet.html">
                StateSet.js
              </a>
            
              
              <a class="source" href="Texture.html">
                Texture.js
              </a>
            
              
              <a class="source" href="TextureCubeMap.html">
                TextureCubeMap.js
              </a>
            
              
              <a class="source" href="TextureManager.html">
                TextureManager.js
              </a>
            
              
              <a class="source" href="Timer.html">
                Timer.js
              </a>
            
              
              <a class="source" href="Transform.html">
                Transform.js
              </a>
            
              
              <a class="source" href="TransformEnums.html">
                TransformEnums.js
              </a>
            
              
              <a class="source" href="TriangleIndexFunctor.html">
                TriangleIndexFunctor.js
              </a>
            
              
              <a class="source" href="Uniform.html">
                Uniform.js
              </a>
            
              
              <a class="source" href="UpdateVisitor.html">
                UpdateVisitor.js
              </a>
            
              
              <a class="source" href="Utils.html">
                Utils.js
              </a>
            
              
              <a class="source" href="Vec2.html">
                Vec2.js
              </a>
            
              
              <a class="source" href="Vec3.html">
                Vec3.js
              </a>
            
              
              <a class="source" href="Vec4.html">
                Vec4.js
              </a>
            
              
              <a class="source" href="Viewport.html">
                Viewport.js
              </a>
            
              
              <a class="source" href="WebGLCaps.html">
                WebGLCaps.js
              </a>
            
              
              <a class="source" href="osg.html">
                osg.js
              </a>
            
              
              <a class="source" href="Animation.html">
                Animation.js
              </a>
            
              
              <a class="source" href="AnimationUpdateCallback.html">
                AnimationUpdateCallback.js
              </a>
            
              
              <a class="source" href="BasicAnimationManager.html">
                BasicAnimationManager.js
              </a>
            
              
              <a class="source" href="Bone.html">
                Bone.js
              </a>
            
              
              <a class="source" href="Channel.html">
                Channel.js
              </a>
            
              
              <a class="source" href="CollectAnimationUpdateCallbackVisitor.html">
                CollectAnimationUpdateCallbackVisitor.js
              </a>
            
              
              <a class="source" href="CollectBoneVisitor.html">
                CollectBoneVisitor.js
              </a>
            
              
              <a class="source" href="Easing.html">
                Easing.js
              </a>
            
              
              <a class="source" href="FindNearestParentSkeleton.html">
                FindNearestParentSkeleton.js
              </a>
            
              
              <a class="source" href="Interpolator.html">
                Interpolator.js
              </a>
            
              
              <a class="source" href="MorphAttribute.html">
                MorphAttribute.js
              </a>
            
              
              <a class="source" href="MorphGeometry.html">
                MorphGeometry.js
              </a>
            
              
              <a class="source" href="RigGeometry.html">
                RigGeometry.js
              </a>
            
              
              <a class="source" href="RigTransformHardware.html">
                RigTransformHardware.js
              </a>
            
              
              <a class="source" href="Skeleton.html">
                Skeleton.js
              </a>
            
              
              <a class="source" href="SkinningAttribute.html">
                SkinningAttribute.js
              </a>
            
              
              <a class="source" href="StackedMatrix.html">
                StackedMatrix.js
              </a>
            
              
              <a class="source" href="StackedQuaternion.html">
                StackedQuaternion.js
              </a>
            
              
              <a class="source" href="StackedRotateAxis.html">
                StackedRotateAxis.js
              </a>
            
              
              <a class="source" href="StackedScale.html">
                StackedScale.js
              </a>
            
              
              <a class="source" href="StackedTranslate.html">
                StackedTranslate.js
              </a>
            
              
              <a class="source" href="Target.html">
                Target.js
              </a>
            
              
              <a class="source" href="UpdateBone.html">
                UpdateBone.js
              </a>
            
              
              <a class="source" href="UpdateMatrixTransform.html">
                UpdateMatrixTransform.js
              </a>
            
              
              <a class="source" href="UpdateMorph.html">
                UpdateMorph.js
              </a>
            
              
              <a class="source" href="UpdateRigGeometry.html">
                UpdateRigGeometry.js
              </a>
            
              
              <a class="source" href="UpdateSkeleton.html">
                UpdateSkeleton.js
              </a>
            
              
              <a class="source" href="channelType.html">
                channelType.js
              </a>
            
              
              <a class="source" href="osgAnimation.html">
                osgAnimation.js
              </a>
            
              
              <a class="source" href="DatabasePager.html">
                DatabasePager.js
              </a>
            
              
              <a class="source" href="Input.html">
                Input.js
              </a>
            
              
              <a class="source" href="Options.html">
                Options.js
              </a>
            
              
              <a class="source" href="ReaderParser.html">
                ReaderParser.js
              </a>
            
              
              <a class="source" href="osgDB.html">
                osgDB.js
              </a>
            
              
              <a class="source" href="FirstPersonManipulator.html">
                FirstPersonManipulator.js
              </a>
            
              
              <a class="source" href="FirstPersonManipulatorDeviceOrientationController.html">
                FirstPersonManipulatorDeviceOrientationController.js
              </a>
            
              
              <a class="source" href="FirstPersonManipulatorHammerController.html">
                FirstPersonManipulatorHammerController.js
              </a>
            
              
              <a class="source" href="FirstPersonManipulatorStandardMouseKeyboardController.html">
                FirstPersonManipulatorStandardMouseKeyboardController.js
              </a>
            
              
              <a class="source" href="FirstPersonManipulatorWebVRController.html">
                FirstPersonManipulatorWebVRController.js
              </a>
            
              
              <a class="source" href="Manipulator.html">
                Manipulator.js
              </a>
            
              
              <a class="source" href="OrbitManipulator.html">
                OrbitManipulator.js
              </a>
            
              
              <a class="source" href="OrbitManipulatorDeviceOrientationController.html">
                OrbitManipulatorDeviceOrientationController.js
              </a>
            
              
              <a class="source" href="OrbitManipulatorEnums.html">
                OrbitManipulatorEnums.js
              </a>
            
              
              <a class="source" href="OrbitManipulatorGamePadController.html">
                OrbitManipulatorGamePadController.js
              </a>
            
              
              <a class="source" href="OrbitManipulatorHammerController.html">
                OrbitManipulatorHammerController.js
              </a>
            
              
              <a class="source" href="OrbitManipulatorLeapMotionController.html">
                OrbitManipulatorLeapMotionController.js
              </a>
            
              
              <a class="source" href="OrbitManipulatorStandardMouseKeyboardController.html">
                OrbitManipulatorStandardMouseKeyboardController.js
              </a>
            
              
              <a class="source" href="OrbitManipulatorWebVRController.html">
                OrbitManipulatorWebVRController.js
              </a>
            
              
              <a class="source" href="SwitchManipulator.html">
                SwitchManipulator.js
              </a>
            
              
              <a class="source" href="osgGA.html">
                osgGA.js
              </a>
            
              
              <a class="source" href="osgNameSpace.html">
                osgNameSpace.js
              </a>
            
              
              <a class="source" href="Compiler.html">
                Compiler.js
              </a>
            
              
              <a class="source" href="ShaderGenerator.html">
                ShaderGenerator.js
              </a>
            
              
              <a class="source" href="ShaderGeneratorProxy.html">
                ShaderGeneratorProxy.js
              </a>
            
              
              <a class="source" href="ShaderProcessor.html">
                ShaderProcessor.js
              </a>
            
              
              <a class="source" href="node.html">
                node.js
              </a>
            
              
              <a class="source" href="Node.html">
                Node.js
              </a>
            
              
              <a class="source" href="data.html">
                data.js
              </a>
            
              
              <a class="source" href="functions.html">
                functions.js
              </a>
            
              
              <a class="source" href="lights.html">
                lights.js
              </a>
            
              
              <a class="source" href="morph.html">
                morph.js
              </a>
            
              
              <a class="source" href="operations.html">
                operations.js
              </a>
            
              
              <a class="source" href="shadows.html">
                shadows.js
              </a>
            
              
              <a class="source" href="skinning.html">
                skinning.js
              </a>
            
              
              <a class="source" href="textures.html">
                textures.js
              </a>
            
              
              <a class="source" href="nodeFactory.html">
                nodeFactory.js
              </a>
            
              
              <a class="source" href="osgShader.html">
                osgShader.js
              </a>
            
              
              <a class="source" href="shaderLib.html">
                shaderLib.js
              </a>
            
              
              <a class="source" href="utils.html">
                utils.js
              </a>
            
              
              <a class="source" href="ShadowCastAttribute.html">
                ShadowCastAttribute.js
              </a>
            
              
              <a class="source" href="ShadowCastCompiler.html">
                ShadowCastCompiler.js
              </a>
            
              
              <a class="source" href="ShadowCastShaderGenerator.html">
                ShadowCastShaderGenerator.js
              </a>
            
              
              <a class="source" href="ShadowCasterVisitor.html">
                ShadowCasterVisitor.js
              </a>
            
              
              <a class="source" href="ShadowFrustumIntersection.html">
                ShadowFrustumIntersection.js
              </a>
            
              
              <a class="source" href="ShadowMap.html">
                ShadowMap.js
              </a>
            
              
              <a class="source" href="ShadowReceiveAttribute.html">
                ShadowReceiveAttribute.js
              </a>
            
              
              <a class="source" href="ShadowSettings.html">
                ShadowSettings.js
              </a>
            
              
              <a class="source" href="ShadowTechnique.html">
                ShadowTechnique.js
              </a>
            
              
              <a class="source" href="ShadowTexture.html">
                ShadowTexture.js
              </a>
            
              
              <a class="source" href="ShadowedScene.html">
                ShadowedScene.js
              </a>
            
              
              <a class="source" href="osgShadow.html">
                osgShadow.js
              </a>
            
              
              <a class="source" href="shaderLib.html">
                shaderLib.js
              </a>
            
              
              <a class="source" href="Text.html">
                Text.js
              </a>
            
              
              <a class="source" href="osgText.html">
                osgText.js
              </a>
            
              
              <a class="source" href="Composer.html">
                Composer.js
              </a>
            
              
              <a class="source" href="DisplayGeometryVisitor.html">
                DisplayGeometryVisitor.js
              </a>
            
              
              <a class="source" href="DisplayGraph.html">
                DisplayGraph.js
              </a>
            
              
              <a class="source" href="DisplayGraphNode.html">
                DisplayGraphNode.js
              </a>
            
              
              <a class="source" href="DisplayGraphRenderer.html">
                DisplayGraphRenderer.js
              </a>
            
              
              <a class="source" href="DisplayNormalVisitor.html">
                DisplayNormalVisitor.js
              </a>
            
              
              <a class="source" href="GizmoGeometry.html">
                GizmoGeometry.js
              </a>
            
              
              <a class="source" href="IntersectionVisitor.html">
                IntersectionVisitor.js
              </a>
            
              
              <a class="source" href="LineSegmentIntersector.html">
                LineSegmentIntersector.js
              </a>
            
              
              <a class="source" href="NodeGizmo.html">
                NodeGizmo.js
              </a>
            
              
              <a class="source" href="ParameterVisitor.html">
                ParameterVisitor.js
              </a>
            
              
              <a class="source" href="PolytopeIntersector.html">
                PolytopeIntersector.js
              </a>
            
              
              <a class="source" href="PolytopePrimitiveIntersector.html">
                PolytopePrimitiveIntersector.js
              </a>
            
              
              <a class="source" href="SphereIntersector.html">
                SphereIntersector.js
              </a>
            
              
              <a class="source" href="TangentSpaceGenerator.html">
                TangentSpaceGenerator.js
              </a>
            
              
              <a class="source" href="TriangleIntersector.html">
                TriangleIntersector.js
              </a>
            
              
              <a class="source" href="TriangleSphereIntersector.html">
                TriangleSphereIntersector.js
              </a>
            
              
              <a class="source" href="WebVR.html">
                WebVR.js
              </a>
            
              
              <a class="source" href="WebVRCustom.html">
                WebVRCustom.js
              </a>
            
              
              <a class="source" href="osgPool.html">
                osgPool.js
              </a>
            
              
              <a class="source" href="osgUtil.html">
                osgUtil.js
              </a>
            
              
              <a class="source" href="Renderer.html">
                Renderer.js
              </a>
            
              
              <a class="source" href="Scene.html">
                Scene.js
              </a>
            
              
              <a class="source" href="View.html">
                View.js
              </a>
            
              
              <a class="source" href="Viewer.html">
                Viewer.js
              </a>
            
              
              <a class="source" href="createStats.html">
                createStats.js
              </a>
            
              
              <a class="source" href="DeviceOrientation.html">
                DeviceOrientation.js
              </a>
            
              
              <a class="source" href="EventProxy.html">
                EventProxy.js
              </a>
            
              
              <a class="source" href="GamePad.html">
                GamePad.js
              </a>
            
              
              <a class="source" href="Hammer.html">
                Hammer.js
              </a>
            
              
              <a class="source" href="LeapMotion.html">
                LeapMotion.js
              </a>
            
              
              <a class="source" href="StandardMouseKeyboard.html">
                StandardMouseKeyboard.js
              </a>
            
              
              <a class="source" href="WebVR.html">
                WebVR.js
              </a>
            
              
              <a class="source" href="osgViewer.html">
                osgViewer.js
              </a>
            
              
              <a class="source" href="webgl-debug.html">
                webgl-debug.js
              </a>
            
              
              <a class="source" href="webgl-utils.html">
                webgl-utils.js
              </a>
            
              
              <a class="source" href="osgWrappers.html">
                osgWrappers.js
              </a>
            
              
              <a class="source" href="osg.html">
                osg.js
              </a>
            
              
              <a class="source" href="osgAnimation.html">
                osgAnimation.js
              </a>
            
              
              <a class="source" href="osgText.html">
                osgText.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>Matrix.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-meta">'use strict'</span>;
<span class="hljs-keyword">var</span> Notify = <span class="hljs-built_in">require</span>( <span class="hljs-string">'osg/Notify'</span> );
<span class="hljs-keyword">var</span> osgMath = <span class="hljs-built_in">require</span>( <span class="hljs-string">'osg/Math'</span> );
<span class="hljs-keyword">var</span> BoundingBox = <span class="hljs-built_in">require</span>( <span class="hljs-string">'osg/BoundingBox'</span> );
<span class="hljs-keyword">var</span> Plane = <span class="hljs-built_in">require</span>( <span class="hljs-string">'osg/Plane'</span> );
<span class="hljs-keyword">var</span> Quat = <span class="hljs-built_in">require</span>( <span class="hljs-string">'osg/Quat'</span> );
<span class="hljs-keyword">var</span> Vec3 = <span class="hljs-built_in">require</span>( <span class="hljs-string">'osg/Vec3'</span> );
<span class="hljs-keyword">var</span> Vec4 = <span class="hljs-built_in">require</span>( <span class="hljs-string">'osg/Vec4'</span> );


<span class="hljs-keyword">var</span> Mabs = <span class="hljs-built_in">Math</span>.abs;
<span class="hljs-keyword">var</span> NMIN_VALUE = <span class="hljs-built_in">Number</span>.MIN_VALUE;

<span class="hljs-comment">/** @class Matrix Operations */</span>
<span class="hljs-keyword">var</span> Matrix = {

    create: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> [ <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span> ];
    },
    isIdentity: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> matrix </span>) </span>{
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++ ) {
            <span class="hljs-keyword">if</span> ( matrix[ i ] !== Matrix.identity[ i ] ) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    },
    valid: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> matrix </span>) </span>{
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++ ) {
            <span class="hljs-keyword">if</span> ( osgMath.isNaN( matrix[ i ] ) ) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    },
    setRow: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> matrix, row, v0, v1, v2, v3 </span>) </span>{
        <span class="hljs-keyword">var</span> rowIndex = row * <span class="hljs-number">4</span>;
        matrix[ rowIndex + <span class="hljs-number">0</span> ] = v0;
        matrix[ rowIndex + <span class="hljs-number">1</span> ] = v1;
        matrix[ rowIndex + <span class="hljs-number">2</span> ] = v2;
        matrix[ rowIndex + <span class="hljs-number">3</span> ] = v3;
    },
    innerProduct: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> a, b, r, c </span>) </span>{
        <span class="hljs-keyword">var</span> rIndex = r * <span class="hljs-number">4</span>;
        <span class="hljs-keyword">return</span> ( ( a[ rIndex + <span class="hljs-number">0</span> ] * b[ <span class="hljs-number">0</span> + c ] ) + ( a[ rIndex + <span class="hljs-number">1</span> ] * b[ <span class="hljs-number">4</span> + c ] ) + ( a[ rIndex + <span class="hljs-number">2</span> ] * b[ <span class="hljs-number">8</span> + c ] ) + ( a[ rIndex + <span class="hljs-number">3</span> ] * b[ <span class="hljs-number">12</span> + c ] ) );
    },

    set: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> matrix, row, col, value </span>) </span>{
        matrix[ row * <span class="hljs-number">4</span> + col ] = value;
        <span class="hljs-keyword">return</span> value;
    },

    get: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> matrix, row, col </span>) </span>{
        <span class="hljs-keyword">return</span> matrix[ row * <span class="hljs-number">4</span> + col ];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>explaining comment
Matrix.setRow( matrix, 0, 1.0, 0.0, 0.0, 0.0 );
Matrix.setRow( matrix, 1, 0.0, 1.0, 0.0, 0.0 );
Matrix.setRow( matrix, 2, 0.0, 0.0, 1.0, 0.0 );
Matrix.setRow( matrix, 3, 0.0, 0.0, 0.0, 1.0 );</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    makeIdentity: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> matrix </span>) </span>{
        Matrix.copy( Matrix.identity, matrix );
        <span class="hljs-keyword">return</span> matrix;
    },

    <span class="hljs-comment">/**
     * @param {Number} x position
     * @param {Number} y position
     * @param {Number} z position
     * @param {Array} matrix to write result
     */</span>
    makeTranslate: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> x, y, z, matrix </span>) </span>{
        <span class="hljs-keyword">if</span> ( matrix === <span class="hljs-literal">undefined</span> ) {
            Notify.warn( <span class="hljs-string">'no matrix destination !'</span> );
            matrix = Matrix.create();
            Matrix.setRow( matrix, <span class="hljs-number">3</span>, x, y, z, <span class="hljs-number">1.0</span> );
            <span class="hljs-keyword">return</span> matrix;
        }
        Matrix.setRow( matrix, <span class="hljs-number">0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span> );
        Matrix.setRow( matrix, <span class="hljs-number">1</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span> );
        Matrix.setRow( matrix, <span class="hljs-number">2</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span> );
        Matrix.setRow( matrix, <span class="hljs-number">3</span>, x, y, z, <span class="hljs-number">1.0</span> );
        <span class="hljs-keyword">return</span> matrix;
    },

    setTrans: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> matrix, x, y, z </span>) </span>{
        matrix[ <span class="hljs-number">12</span> ] = x;
        matrix[ <span class="hljs-number">13</span> ] = y;
        matrix[ <span class="hljs-number">14</span> ] = z;
        <span class="hljs-keyword">return</span> matrix;
    },

    getTrans: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> matrix, result </span>) </span>{
        result[ <span class="hljs-number">0</span> ] = matrix[ <span class="hljs-number">12</span> ];
        result[ <span class="hljs-number">1</span> ] = matrix[ <span class="hljs-number">13</span> ];
        result[ <span class="hljs-number">2</span> ] = matrix[ <span class="hljs-number">14</span> ];
        <span class="hljs-keyword">return</span> result;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>do a * b and result in a</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    preMult: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> a, b </span>) </span>{
        <span class="hljs-keyword">var</span> atmp0, atmp1, atmp2, atmp3;

        atmp0 = ( b[ <span class="hljs-number">0</span> ] * a[ <span class="hljs-number">0</span> ] ) + ( b[ <span class="hljs-number">1</span> ] * a[ <span class="hljs-number">4</span> ] ) + ( b[ <span class="hljs-number">2</span> ] * a[ <span class="hljs-number">8</span> ] ) + ( b[ <span class="hljs-number">3</span> ] * a[ <span class="hljs-number">12</span> ] );
        atmp1 = ( b[ <span class="hljs-number">4</span> ] * a[ <span class="hljs-number">0</span> ] ) + ( b[ <span class="hljs-number">5</span> ] * a[ <span class="hljs-number">4</span> ] ) + ( b[ <span class="hljs-number">6</span> ] * a[ <span class="hljs-number">8</span> ] ) + ( b[ <span class="hljs-number">7</span> ] * a[ <span class="hljs-number">12</span> ] );
        atmp2 = ( b[ <span class="hljs-number">8</span> ] * a[ <span class="hljs-number">0</span> ] ) + ( b[ <span class="hljs-number">9</span> ] * a[ <span class="hljs-number">4</span> ] ) + ( b[ <span class="hljs-number">10</span> ] * a[ <span class="hljs-number">8</span> ] ) + ( b[ <span class="hljs-number">11</span> ] * a[ <span class="hljs-number">12</span> ] );
        atmp3 = ( b[ <span class="hljs-number">12</span> ] * a[ <span class="hljs-number">0</span> ] ) + ( b[ <span class="hljs-number">13</span> ] * a[ <span class="hljs-number">4</span> ] ) + ( b[ <span class="hljs-number">14</span> ] * a[ <span class="hljs-number">8</span> ] ) + ( b[ <span class="hljs-number">15</span> ] * a[ <span class="hljs-number">12</span> ] );
        a[ <span class="hljs-number">0</span> ] = atmp0;
        a[ <span class="hljs-number">4</span> ] = atmp1;
        a[ <span class="hljs-number">8</span> ] = atmp2;
        a[ <span class="hljs-number">12</span> ] = atmp3;

        atmp0 = ( b[ <span class="hljs-number">0</span> ] * a[ <span class="hljs-number">1</span> ] ) + ( b[ <span class="hljs-number">1</span> ] * a[ <span class="hljs-number">5</span> ] ) + ( b[ <span class="hljs-number">2</span> ] * a[ <span class="hljs-number">9</span> ] ) + ( b[ <span class="hljs-number">3</span> ] * a[ <span class="hljs-number">13</span> ] );
        atmp1 = ( b[ <span class="hljs-number">4</span> ] * a[ <span class="hljs-number">1</span> ] ) + ( b[ <span class="hljs-number">5</span> ] * a[ <span class="hljs-number">5</span> ] ) + ( b[ <span class="hljs-number">6</span> ] * a[ <span class="hljs-number">9</span> ] ) + ( b[ <span class="hljs-number">7</span> ] * a[ <span class="hljs-number">13</span> ] );
        atmp2 = ( b[ <span class="hljs-number">8</span> ] * a[ <span class="hljs-number">1</span> ] ) + ( b[ <span class="hljs-number">9</span> ] * a[ <span class="hljs-number">5</span> ] ) + ( b[ <span class="hljs-number">10</span> ] * a[ <span class="hljs-number">9</span> ] ) + ( b[ <span class="hljs-number">11</span> ] * a[ <span class="hljs-number">13</span> ] );
        atmp3 = ( b[ <span class="hljs-number">12</span> ] * a[ <span class="hljs-number">1</span> ] ) + ( b[ <span class="hljs-number">13</span> ] * a[ <span class="hljs-number">5</span> ] ) + ( b[ <span class="hljs-number">14</span> ] * a[ <span class="hljs-number">9</span> ] ) + ( b[ <span class="hljs-number">15</span> ] * a[ <span class="hljs-number">13</span> ] );
        a[ <span class="hljs-number">1</span> ] = atmp0;
        a[ <span class="hljs-number">5</span> ] = atmp1;
        a[ <span class="hljs-number">9</span> ] = atmp2;
        a[ <span class="hljs-number">13</span> ] = atmp3;

        atmp0 = ( b[ <span class="hljs-number">0</span> ] * a[ <span class="hljs-number">2</span> ] ) + ( b[ <span class="hljs-number">1</span> ] * a[ <span class="hljs-number">6</span> ] ) + ( b[ <span class="hljs-number">2</span> ] * a[ <span class="hljs-number">10</span> ] ) + ( b[ <span class="hljs-number">3</span> ] * a[ <span class="hljs-number">14</span> ] );
        atmp1 = ( b[ <span class="hljs-number">4</span> ] * a[ <span class="hljs-number">2</span> ] ) + ( b[ <span class="hljs-number">5</span> ] * a[ <span class="hljs-number">6</span> ] ) + ( b[ <span class="hljs-number">6</span> ] * a[ <span class="hljs-number">10</span> ] ) + ( b[ <span class="hljs-number">7</span> ] * a[ <span class="hljs-number">14</span> ] );
        atmp2 = ( b[ <span class="hljs-number">8</span> ] * a[ <span class="hljs-number">2</span> ] ) + ( b[ <span class="hljs-number">9</span> ] * a[ <span class="hljs-number">6</span> ] ) + ( b[ <span class="hljs-number">10</span> ] * a[ <span class="hljs-number">10</span> ] ) + ( b[ <span class="hljs-number">11</span> ] * a[ <span class="hljs-number">14</span> ] );
        atmp3 = ( b[ <span class="hljs-number">12</span> ] * a[ <span class="hljs-number">2</span> ] ) + ( b[ <span class="hljs-number">13</span> ] * a[ <span class="hljs-number">6</span> ] ) + ( b[ <span class="hljs-number">14</span> ] * a[ <span class="hljs-number">10</span> ] ) + ( b[ <span class="hljs-number">15</span> ] * a[ <span class="hljs-number">14</span> ] );
        a[ <span class="hljs-number">2</span> ] = atmp0;
        a[ <span class="hljs-number">6</span> ] = atmp1;
        a[ <span class="hljs-number">10</span> ] = atmp2;
        a[ <span class="hljs-number">14</span> ] = atmp3;

        atmp0 = ( b[ <span class="hljs-number">0</span> ] * a[ <span class="hljs-number">3</span> ] ) + ( b[ <span class="hljs-number">1</span> ] * a[ <span class="hljs-number">7</span> ] ) + ( b[ <span class="hljs-number">2</span> ] * a[ <span class="hljs-number">11</span> ] ) + ( b[ <span class="hljs-number">3</span> ] * a[ <span class="hljs-number">15</span> ] );
        atmp1 = ( b[ <span class="hljs-number">4</span> ] * a[ <span class="hljs-number">3</span> ] ) + ( b[ <span class="hljs-number">5</span> ] * a[ <span class="hljs-number">7</span> ] ) + ( b[ <span class="hljs-number">6</span> ] * a[ <span class="hljs-number">11</span> ] ) + ( b[ <span class="hljs-number">7</span> ] * a[ <span class="hljs-number">15</span> ] );
        atmp2 = ( b[ <span class="hljs-number">8</span> ] * a[ <span class="hljs-number">3</span> ] ) + ( b[ <span class="hljs-number">9</span> ] * a[ <span class="hljs-number">7</span> ] ) + ( b[ <span class="hljs-number">10</span> ] * a[ <span class="hljs-number">11</span> ] ) + ( b[ <span class="hljs-number">11</span> ] * a[ <span class="hljs-number">15</span> ] );
        atmp3 = ( b[ <span class="hljs-number">12</span> ] * a[ <span class="hljs-number">3</span> ] ) + ( b[ <span class="hljs-number">13</span> ] * a[ <span class="hljs-number">7</span> ] ) + ( b[ <span class="hljs-number">14</span> ] * a[ <span class="hljs-number">11</span> ] ) + ( b[ <span class="hljs-number">15</span> ] * a[ <span class="hljs-number">15</span> ] );
        a[ <span class="hljs-number">3</span> ] = atmp0;
        a[ <span class="hljs-number">7</span> ] = atmp1;
        a[ <span class="hljs-number">11</span> ] = atmp2;
        a[ <span class="hljs-number">15</span> ] = atmp3;

        <span class="hljs-keyword">return</span> a;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>do a * b and result in b</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    postMult: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> a, b </span>) </span>{
        <span class="hljs-keyword">var</span> btmp0, btmp1, btmp2, btmp3;</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>post mult</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        btmp0 = ( b[ <span class="hljs-number">0</span> ] * a[ <span class="hljs-number">0</span> ] ) + ( b[ <span class="hljs-number">1</span> ] * a[ <span class="hljs-number">4</span> ] ) + ( b[ <span class="hljs-number">2</span> ] * a[ <span class="hljs-number">8</span> ] ) + ( b[ <span class="hljs-number">3</span> ] * a[ <span class="hljs-number">12</span> ] );
        btmp1 = ( b[ <span class="hljs-number">0</span> ] * a[ <span class="hljs-number">1</span> ] ) + ( b[ <span class="hljs-number">1</span> ] * a[ <span class="hljs-number">5</span> ] ) + ( b[ <span class="hljs-number">2</span> ] * a[ <span class="hljs-number">9</span> ] ) + ( b[ <span class="hljs-number">3</span> ] * a[ <span class="hljs-number">13</span> ] );
        btmp2 = ( b[ <span class="hljs-number">0</span> ] * a[ <span class="hljs-number">2</span> ] ) + ( b[ <span class="hljs-number">1</span> ] * a[ <span class="hljs-number">6</span> ] ) + ( b[ <span class="hljs-number">2</span> ] * a[ <span class="hljs-number">10</span> ] ) + ( b[ <span class="hljs-number">3</span> ] * a[ <span class="hljs-number">14</span> ] );
        btmp3 = ( b[ <span class="hljs-number">0</span> ] * a[ <span class="hljs-number">3</span> ] ) + ( b[ <span class="hljs-number">1</span> ] * a[ <span class="hljs-number">7</span> ] ) + ( b[ <span class="hljs-number">2</span> ] * a[ <span class="hljs-number">11</span> ] ) + ( b[ <span class="hljs-number">3</span> ] * a[ <span class="hljs-number">15</span> ] );
        b[ <span class="hljs-number">0</span> ] = btmp0;
        b[ <span class="hljs-number">1</span> ] = btmp1;
        b[ <span class="hljs-number">2</span> ] = btmp2;
        b[ <span class="hljs-number">3</span> ] = btmp3;

        btmp0 = ( b[ <span class="hljs-number">4</span> ] * a[ <span class="hljs-number">0</span> ] ) + ( b[ <span class="hljs-number">5</span> ] * a[ <span class="hljs-number">4</span> ] ) + ( b[ <span class="hljs-number">6</span> ] * a[ <span class="hljs-number">8</span> ] ) + ( b[ <span class="hljs-number">7</span> ] * a[ <span class="hljs-number">12</span> ] );
        btmp1 = ( b[ <span class="hljs-number">4</span> ] * a[ <span class="hljs-number">1</span> ] ) + ( b[ <span class="hljs-number">5</span> ] * a[ <span class="hljs-number">5</span> ] ) + ( b[ <span class="hljs-number">6</span> ] * a[ <span class="hljs-number">9</span> ] ) + ( b[ <span class="hljs-number">7</span> ] * a[ <span class="hljs-number">13</span> ] );
        btmp2 = ( b[ <span class="hljs-number">4</span> ] * a[ <span class="hljs-number">2</span> ] ) + ( b[ <span class="hljs-number">5</span> ] * a[ <span class="hljs-number">6</span> ] ) + ( b[ <span class="hljs-number">6</span> ] * a[ <span class="hljs-number">10</span> ] ) + ( b[ <span class="hljs-number">7</span> ] * a[ <span class="hljs-number">14</span> ] );
        btmp3 = ( b[ <span class="hljs-number">4</span> ] * a[ <span class="hljs-number">3</span> ] ) + ( b[ <span class="hljs-number">5</span> ] * a[ <span class="hljs-number">7</span> ] ) + ( b[ <span class="hljs-number">6</span> ] * a[ <span class="hljs-number">11</span> ] ) + ( b[ <span class="hljs-number">7</span> ] * a[ <span class="hljs-number">15</span> ] );
        b[ <span class="hljs-number">4</span> ] = btmp0;
        b[ <span class="hljs-number">5</span> ] = btmp1;
        b[ <span class="hljs-number">6</span> ] = btmp2;
        b[ <span class="hljs-number">7</span> ] = btmp3;

        btmp0 = ( b[ <span class="hljs-number">8</span> ] * a[ <span class="hljs-number">0</span> ] ) + ( b[ <span class="hljs-number">9</span> ] * a[ <span class="hljs-number">4</span> ] ) + ( b[ <span class="hljs-number">10</span> ] * a[ <span class="hljs-number">8</span> ] ) + ( b[ <span class="hljs-number">11</span> ] * a[ <span class="hljs-number">12</span> ] );
        btmp1 = ( b[ <span class="hljs-number">8</span> ] * a[ <span class="hljs-number">1</span> ] ) + ( b[ <span class="hljs-number">9</span> ] * a[ <span class="hljs-number">5</span> ] ) + ( b[ <span class="hljs-number">10</span> ] * a[ <span class="hljs-number">9</span> ] ) + ( b[ <span class="hljs-number">11</span> ] * a[ <span class="hljs-number">13</span> ] );
        btmp2 = ( b[ <span class="hljs-number">8</span> ] * a[ <span class="hljs-number">2</span> ] ) + ( b[ <span class="hljs-number">9</span> ] * a[ <span class="hljs-number">6</span> ] ) + ( b[ <span class="hljs-number">10</span> ] * a[ <span class="hljs-number">10</span> ] ) + ( b[ <span class="hljs-number">11</span> ] * a[ <span class="hljs-number">14</span> ] );
        btmp3 = ( b[ <span class="hljs-number">8</span> ] * a[ <span class="hljs-number">3</span> ] ) + ( b[ <span class="hljs-number">9</span> ] * a[ <span class="hljs-number">7</span> ] ) + ( b[ <span class="hljs-number">10</span> ] * a[ <span class="hljs-number">11</span> ] ) + ( b[ <span class="hljs-number">11</span> ] * a[ <span class="hljs-number">15</span> ] );
        b[ <span class="hljs-number">8</span> ] = btmp0;
        b[ <span class="hljs-number">9</span> ] = btmp1;
        b[ <span class="hljs-number">10</span> ] = btmp2;
        b[ <span class="hljs-number">11</span> ] = btmp3;

        btmp0 = ( b[ <span class="hljs-number">12</span> ] * a[ <span class="hljs-number">0</span> ] ) + ( b[ <span class="hljs-number">13</span> ] * a[ <span class="hljs-number">4</span> ] ) + ( b[ <span class="hljs-number">14</span> ] * a[ <span class="hljs-number">8</span> ] ) + ( b[ <span class="hljs-number">15</span> ] * a[ <span class="hljs-number">12</span> ] );
        btmp1 = ( b[ <span class="hljs-number">12</span> ] * a[ <span class="hljs-number">1</span> ] ) + ( b[ <span class="hljs-number">13</span> ] * a[ <span class="hljs-number">5</span> ] ) + ( b[ <span class="hljs-number">14</span> ] * a[ <span class="hljs-number">9</span> ] ) + ( b[ <span class="hljs-number">15</span> ] * a[ <span class="hljs-number">13</span> ] );
        btmp2 = ( b[ <span class="hljs-number">12</span> ] * a[ <span class="hljs-number">2</span> ] ) + ( b[ <span class="hljs-number">13</span> ] * a[ <span class="hljs-number">6</span> ] ) + ( b[ <span class="hljs-number">14</span> ] * a[ <span class="hljs-number">10</span> ] ) + ( b[ <span class="hljs-number">15</span> ] * a[ <span class="hljs-number">14</span> ] );
        btmp3 = ( b[ <span class="hljs-number">12</span> ] * a[ <span class="hljs-number">3</span> ] ) + ( b[ <span class="hljs-number">13</span> ] * a[ <span class="hljs-number">7</span> ] ) + ( b[ <span class="hljs-number">14</span> ] * a[ <span class="hljs-number">11</span> ] ) + ( b[ <span class="hljs-number">15</span> ] * a[ <span class="hljs-number">15</span> ] );
        b[ <span class="hljs-number">12</span> ] = btmp0;
        b[ <span class="hljs-number">13</span> ] = btmp1;
        b[ <span class="hljs-number">14</span> ] = btmp2;
        b[ <span class="hljs-number">15</span> ] = btmp3;

        <span class="hljs-keyword">return</span> b;
    },
    multa: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> a, b, r </span>) </span>{
        <span class="hljs-keyword">if</span> ( r === a ) {
            <span class="hljs-keyword">return</span> Matrix.preMult( a, b );
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( r === b ) {
            <span class="hljs-keyword">return</span> Matrix.postMult( a, b );
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">if</span> ( r === <span class="hljs-literal">undefined</span> ) {
                Notify.warn( <span class="hljs-string">'no matrix destination !'</span> );
                r = Matrix.create();
            }
            r[ <span class="hljs-number">0</span> ] = b[ <span class="hljs-number">0</span> ] * a[ <span class="hljs-number">0</span> ] + b[ <span class="hljs-number">1</span> ] * a[ <span class="hljs-number">4</span> ] + b[ <span class="hljs-number">2</span> ] * a[ <span class="hljs-number">8</span> ] + b[ <span class="hljs-number">3</span> ] * a[ <span class="hljs-number">12</span> ];
            r[ <span class="hljs-number">1</span> ] = b[ <span class="hljs-number">0</span> ] * a[ <span class="hljs-number">1</span> ] + b[ <span class="hljs-number">1</span> ] * a[ <span class="hljs-number">5</span> ] + b[ <span class="hljs-number">2</span> ] * a[ <span class="hljs-number">9</span> ] + b[ <span class="hljs-number">3</span> ] * a[ <span class="hljs-number">13</span> ];
            r[ <span class="hljs-number">2</span> ] = b[ <span class="hljs-number">0</span> ] * a[ <span class="hljs-number">2</span> ] + b[ <span class="hljs-number">1</span> ] * a[ <span class="hljs-number">6</span> ] + b[ <span class="hljs-number">2</span> ] * a[ <span class="hljs-number">10</span> ] + b[ <span class="hljs-number">3</span> ] * a[ <span class="hljs-number">14</span> ];
            r[ <span class="hljs-number">3</span> ] = b[ <span class="hljs-number">0</span> ] * a[ <span class="hljs-number">3</span> ] + b[ <span class="hljs-number">1</span> ] * a[ <span class="hljs-number">7</span> ] + b[ <span class="hljs-number">2</span> ] * a[ <span class="hljs-number">11</span> ] + b[ <span class="hljs-number">3</span> ] * a[ <span class="hljs-number">15</span> ];

            r[ <span class="hljs-number">4</span> ] = b[ <span class="hljs-number">4</span> ] * a[ <span class="hljs-number">0</span> ] + b[ <span class="hljs-number">5</span> ] * a[ <span class="hljs-number">4</span> ] + b[ <span class="hljs-number">6</span> ] * a[ <span class="hljs-number">8</span> ] + b[ <span class="hljs-number">7</span> ] * a[ <span class="hljs-number">12</span> ];
            r[ <span class="hljs-number">5</span> ] = b[ <span class="hljs-number">4</span> ] * a[ <span class="hljs-number">1</span> ] + b[ <span class="hljs-number">5</span> ] * a[ <span class="hljs-number">5</span> ] + b[ <span class="hljs-number">6</span> ] * a[ <span class="hljs-number">9</span> ] + b[ <span class="hljs-number">7</span> ] * a[ <span class="hljs-number">13</span> ];
            r[ <span class="hljs-number">6</span> ] = b[ <span class="hljs-number">4</span> ] * a[ <span class="hljs-number">2</span> ] + b[ <span class="hljs-number">5</span> ] * a[ <span class="hljs-number">6</span> ] + b[ <span class="hljs-number">6</span> ] * a[ <span class="hljs-number">10</span> ] + b[ <span class="hljs-number">7</span> ] * a[ <span class="hljs-number">14</span> ];
            r[ <span class="hljs-number">7</span> ] = b[ <span class="hljs-number">4</span> ] * a[ <span class="hljs-number">3</span> ] + b[ <span class="hljs-number">5</span> ] * a[ <span class="hljs-number">7</span> ] + b[ <span class="hljs-number">6</span> ] * a[ <span class="hljs-number">11</span> ] + b[ <span class="hljs-number">7</span> ] * a[ <span class="hljs-number">15</span> ];

            r[ <span class="hljs-number">8</span> ] = b[ <span class="hljs-number">8</span> ] * a[ <span class="hljs-number">0</span> ] + b[ <span class="hljs-number">9</span> ] * a[ <span class="hljs-number">4</span> ] + b[ <span class="hljs-number">10</span> ] * a[ <span class="hljs-number">8</span> ] + b[ <span class="hljs-number">11</span> ] * a[ <span class="hljs-number">12</span> ];
            r[ <span class="hljs-number">9</span> ] = b[ <span class="hljs-number">8</span> ] * a[ <span class="hljs-number">1</span> ] + b[ <span class="hljs-number">9</span> ] * a[ <span class="hljs-number">5</span> ] + b[ <span class="hljs-number">10</span> ] * a[ <span class="hljs-number">9</span> ] + b[ <span class="hljs-number">11</span> ] * a[ <span class="hljs-number">13</span> ];
            r[ <span class="hljs-number">10</span> ] = b[ <span class="hljs-number">8</span> ] * a[ <span class="hljs-number">2</span> ] + b[ <span class="hljs-number">9</span> ] * a[ <span class="hljs-number">6</span> ] + b[ <span class="hljs-number">10</span> ] * a[ <span class="hljs-number">10</span> ] + b[ <span class="hljs-number">11</span> ] * a[ <span class="hljs-number">14</span> ];
            r[ <span class="hljs-number">11</span> ] = b[ <span class="hljs-number">8</span> ] * a[ <span class="hljs-number">3</span> ] + b[ <span class="hljs-number">9</span> ] * a[ <span class="hljs-number">7</span> ] + b[ <span class="hljs-number">10</span> ] * a[ <span class="hljs-number">11</span> ] + b[ <span class="hljs-number">11</span> ] * a[ <span class="hljs-number">15</span> ];

            r[ <span class="hljs-number">12</span> ] = b[ <span class="hljs-number">12</span> ] * a[ <span class="hljs-number">0</span> ] + b[ <span class="hljs-number">13</span> ] * a[ <span class="hljs-number">4</span> ] + b[ <span class="hljs-number">14</span> ] * a[ <span class="hljs-number">8</span> ] + b[ <span class="hljs-number">15</span> ] * a[ <span class="hljs-number">12</span> ];
            r[ <span class="hljs-number">13</span> ] = b[ <span class="hljs-number">12</span> ] * a[ <span class="hljs-number">1</span> ] + b[ <span class="hljs-number">13</span> ] * a[ <span class="hljs-number">5</span> ] + b[ <span class="hljs-number">14</span> ] * a[ <span class="hljs-number">9</span> ] + b[ <span class="hljs-number">15</span> ] * a[ <span class="hljs-number">13</span> ];
            r[ <span class="hljs-number">14</span> ] = b[ <span class="hljs-number">12</span> ] * a[ <span class="hljs-number">2</span> ] + b[ <span class="hljs-number">13</span> ] * a[ <span class="hljs-number">6</span> ] + b[ <span class="hljs-number">14</span> ] * a[ <span class="hljs-number">10</span> ] + b[ <span class="hljs-number">15</span> ] * a[ <span class="hljs-number">14</span> ];
            r[ <span class="hljs-number">15</span> ] = b[ <span class="hljs-number">12</span> ] * a[ <span class="hljs-number">3</span> ] + b[ <span class="hljs-number">13</span> ] * a[ <span class="hljs-number">7</span> ] + b[ <span class="hljs-number">14</span> ] * a[ <span class="hljs-number">11</span> ] + b[ <span class="hljs-number">15</span> ] * a[ <span class="hljs-number">15</span> ];

            <span class="hljs-keyword">return</span> r;
        }
    },
    <span class="hljs-comment">/* r = a * b */</span>
    mult: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> a, b, r </span>) </span>{
        <span class="hljs-keyword">var</span> s00 = b[ <span class="hljs-number">0</span> ];
        <span class="hljs-keyword">var</span> s01 = b[ <span class="hljs-number">1</span> ];
        <span class="hljs-keyword">var</span> s02 = b[ <span class="hljs-number">2</span> ];
        <span class="hljs-keyword">var</span> s03 = b[ <span class="hljs-number">3</span> ];
        <span class="hljs-keyword">var</span> s10 = b[ <span class="hljs-number">4</span> ];
        <span class="hljs-keyword">var</span> s11 = b[ <span class="hljs-number">5</span> ];
        <span class="hljs-keyword">var</span> s12 = b[ <span class="hljs-number">6</span> ];
        <span class="hljs-keyword">var</span> s13 = b[ <span class="hljs-number">7</span> ];
        <span class="hljs-keyword">var</span> s20 = b[ <span class="hljs-number">8</span> ];
        <span class="hljs-keyword">var</span> s21 = b[ <span class="hljs-number">9</span> ];
        <span class="hljs-keyword">var</span> s22 = b[ <span class="hljs-number">10</span> ];
        <span class="hljs-keyword">var</span> s23 = b[ <span class="hljs-number">11</span> ];
        <span class="hljs-keyword">var</span> s30 = b[ <span class="hljs-number">12</span> ];
        <span class="hljs-keyword">var</span> s31 = b[ <span class="hljs-number">13</span> ];
        <span class="hljs-keyword">var</span> s32 = b[ <span class="hljs-number">14</span> ];
        <span class="hljs-keyword">var</span> s33 = b[ <span class="hljs-number">15</span> ];

        <span class="hljs-keyword">var</span> o00 = a[ <span class="hljs-number">0</span> ];
        <span class="hljs-keyword">var</span> o01 = a[ <span class="hljs-number">1</span> ];
        <span class="hljs-keyword">var</span> o02 = a[ <span class="hljs-number">2</span> ];
        <span class="hljs-keyword">var</span> o03 = a[ <span class="hljs-number">3</span> ];
        <span class="hljs-keyword">var</span> o10 = a[ <span class="hljs-number">4</span> ];
        <span class="hljs-keyword">var</span> o11 = a[ <span class="hljs-number">5</span> ];
        <span class="hljs-keyword">var</span> o12 = a[ <span class="hljs-number">6</span> ];
        <span class="hljs-keyword">var</span> o13 = a[ <span class="hljs-number">7</span> ];
        <span class="hljs-keyword">var</span> o20 = a[ <span class="hljs-number">8</span> ];
        <span class="hljs-keyword">var</span> o21 = a[ <span class="hljs-number">9</span> ];
        <span class="hljs-keyword">var</span> o22 = a[ <span class="hljs-number">10</span> ];
        <span class="hljs-keyword">var</span> o23 = a[ <span class="hljs-number">11</span> ];
        <span class="hljs-keyword">var</span> o30 = a[ <span class="hljs-number">12</span> ];
        <span class="hljs-keyword">var</span> o31 = a[ <span class="hljs-number">13</span> ];
        <span class="hljs-keyword">var</span> o32 = a[ <span class="hljs-number">14</span> ];
        <span class="hljs-keyword">var</span> o33 = a[ <span class="hljs-number">15</span> ];

        r[ <span class="hljs-number">0</span> ] = s00 * o00 + s01 * o10 + s02 * o20 + s03 * o30;
        r[ <span class="hljs-number">1</span> ] = s00 * o01 + s01 * o11 + s02 * o21 + s03 * o31;
        r[ <span class="hljs-number">2</span> ] = s00 * o02 + s01 * o12 + s02 * o22 + s03 * o32;
        r[ <span class="hljs-number">3</span> ] = s00 * o03 + s01 * o13 + s02 * o23 + s03 * o33;

        r[ <span class="hljs-number">4</span> ] = s10 * o00 + s11 * o10 + s12 * o20 + s13 * o30;
        r[ <span class="hljs-number">5</span> ] = s10 * o01 + s11 * o11 + s12 * o21 + s13 * o31;
        r[ <span class="hljs-number">6</span> ] = s10 * o02 + s11 * o12 + s12 * o22 + s13 * o32;
        r[ <span class="hljs-number">7</span> ] = s10 * o03 + s11 * o13 + s12 * o23 + s13 * o33;

        r[ <span class="hljs-number">8</span> ] = s20 * o00 + s21 * o10 + s22 * o20 + s23 * o30;
        r[ <span class="hljs-number">9</span> ] = s20 * o01 + s21 * o11 + s22 * o21 + s23 * o31;
        r[ <span class="hljs-number">10</span> ] = s20 * o02 + s21 * o12 + s22 * o22 + s23 * o32;
        r[ <span class="hljs-number">11</span> ] = s20 * o03 + s21 * o13 + s22 * o23 + s23 * o33;

        r[ <span class="hljs-number">12</span> ] = s30 * o00 + s31 * o10 + s32 * o20 + s33 * o30;
        r[ <span class="hljs-number">13</span> ] = s30 * o01 + s31 * o11 + s32 * o21 + s33 * o31;
        r[ <span class="hljs-number">14</span> ] = s30 * o02 + s31 * o12 + s32 * o22 + s33 * o32;
        r[ <span class="hljs-number">15</span> ] = s30 * o03 + s31 * o13 + s32 * o23 + s33 * o33;

        <span class="hljs-keyword">return</span> r;
    },
    multOrig: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> a, b, r </span>) </span>{
        <span class="hljs-keyword">var</span> inner1 = <span class="hljs-number">0.0</span>,
            inner2 = <span class="hljs-number">0.0</span>,
            inner3 = <span class="hljs-number">0.0</span>,
            inner4 = <span class="hljs-number">0.0</span>;
        <span class="hljs-keyword">if</span> ( r === a ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>pre mult</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> col = <span class="hljs-number">0</span>; col &lt; <span class="hljs-number">4</span>; col++ ) {
                inner1 = Matrix.innerProduct( b, a, <span class="hljs-number">0</span>, col );
                inner2 = Matrix.innerProduct( b, a, <span class="hljs-number">1</span>, col );
                inner3 = Matrix.innerProduct( b, a, <span class="hljs-number">2</span>, col );
                inner4 = Matrix.innerProduct( b, a, <span class="hljs-number">3</span>, col );
                a[ <span class="hljs-number">0</span> + col ] = inner1;
                a[ <span class="hljs-number">4</span> + col ] = inner2;
                a[ <span class="hljs-number">8</span> + col ] = inner3;
                a[ <span class="hljs-number">12</span> + col ] = inner4;
            }
            <span class="hljs-keyword">return</span> a;</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>return Matrix.preMult(r, b);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( r === b ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>post mult</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> row = <span class="hljs-number">0</span>; row &lt; <span class="hljs-number">4</span>; row++ ) {
                inner1 = Matrix.innerProduct( b, a, row, <span class="hljs-number">0</span> );
                inner2 = Matrix.innerProduct( b, a, row, <span class="hljs-number">1</span> );
                inner3 = Matrix.innerProduct( b, a, row, <span class="hljs-number">2</span> );
                inner4 = Matrix.innerProduct( b, a, row, <span class="hljs-number">3</span> );
                Matrix.setRow( b, row, inner1, inner2, inner3, inner4 );
            }
            <span class="hljs-keyword">return</span> b;</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>return Matrix.postMult(r, a);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        }
        <span class="hljs-keyword">if</span> ( r === <span class="hljs-literal">undefined</span> ) {
            Notify.warn( <span class="hljs-string">'no matrix destination !'</span> );
            r = Matrix.create();
        }

        <span class="hljs-keyword">var</span> s00 = b[ <span class="hljs-number">0</span> ];
        <span class="hljs-keyword">var</span> s01 = b[ <span class="hljs-number">1</span> ];
        <span class="hljs-keyword">var</span> s02 = b[ <span class="hljs-number">2</span> ];
        <span class="hljs-keyword">var</span> s03 = b[ <span class="hljs-number">3</span> ];
        <span class="hljs-keyword">var</span> s10 = b[ <span class="hljs-number">4</span> ];
        <span class="hljs-keyword">var</span> s11 = b[ <span class="hljs-number">5</span> ];
        <span class="hljs-keyword">var</span> s12 = b[ <span class="hljs-number">6</span> ];
        <span class="hljs-keyword">var</span> s13 = b[ <span class="hljs-number">7</span> ];
        <span class="hljs-keyword">var</span> s20 = b[ <span class="hljs-number">8</span> ];
        <span class="hljs-keyword">var</span> s21 = b[ <span class="hljs-number">9</span> ];
        <span class="hljs-keyword">var</span> s22 = b[ <span class="hljs-number">10</span> ];
        <span class="hljs-keyword">var</span> s23 = b[ <span class="hljs-number">11</span> ];
        <span class="hljs-keyword">var</span> s30 = b[ <span class="hljs-number">12</span> ];
        <span class="hljs-keyword">var</span> s31 = b[ <span class="hljs-number">13</span> ];
        <span class="hljs-keyword">var</span> s32 = b[ <span class="hljs-number">14</span> ];
        <span class="hljs-keyword">var</span> s33 = b[ <span class="hljs-number">15</span> ];

        <span class="hljs-keyword">var</span> o00 = a[ <span class="hljs-number">0</span> ];
        <span class="hljs-keyword">var</span> o01 = a[ <span class="hljs-number">1</span> ];
        <span class="hljs-keyword">var</span> o02 = a[ <span class="hljs-number">2</span> ];
        <span class="hljs-keyword">var</span> o03 = a[ <span class="hljs-number">3</span> ];
        <span class="hljs-keyword">var</span> o10 = a[ <span class="hljs-number">4</span> ];
        <span class="hljs-keyword">var</span> o11 = a[ <span class="hljs-number">5</span> ];
        <span class="hljs-keyword">var</span> o12 = a[ <span class="hljs-number">6</span> ];
        <span class="hljs-keyword">var</span> o13 = a[ <span class="hljs-number">7</span> ];
        <span class="hljs-keyword">var</span> o20 = a[ <span class="hljs-number">8</span> ];
        <span class="hljs-keyword">var</span> o21 = a[ <span class="hljs-number">9</span> ];
        <span class="hljs-keyword">var</span> o22 = a[ <span class="hljs-number">10</span> ];
        <span class="hljs-keyword">var</span> o23 = a[ <span class="hljs-number">11</span> ];
        <span class="hljs-keyword">var</span> o30 = a[ <span class="hljs-number">12</span> ];
        <span class="hljs-keyword">var</span> o31 = a[ <span class="hljs-number">13</span> ];
        <span class="hljs-keyword">var</span> o32 = a[ <span class="hljs-number">14</span> ];
        <span class="hljs-keyword">var</span> o33 = a[ <span class="hljs-number">15</span> ];

        r[ <span class="hljs-number">0</span> ] = s00 * o00 + s01 * o10 + s02 * o20 + s03 * o30;
        r[ <span class="hljs-number">1</span> ] = s00 * o01 + s01 * o11 + s02 * o21 + s03 * o31;
        r[ <span class="hljs-number">2</span> ] = s00 * o02 + s01 * o12 + s02 * o22 + s03 * o32;
        r[ <span class="hljs-number">3</span> ] = s00 * o03 + s01 * o13 + s02 * o23 + s03 * o33;

        r[ <span class="hljs-number">4</span> ] = s10 * o00 + s11 * o10 + s12 * o20 + s13 * o30;
        r[ <span class="hljs-number">5</span> ] = s10 * o01 + s11 * o11 + s12 * o21 + s13 * o31;
        r[ <span class="hljs-number">6</span> ] = s10 * o02 + s11 * o12 + s12 * o22 + s13 * o32;
        r[ <span class="hljs-number">7</span> ] = s10 * o03 + s11 * o13 + s12 * o23 + s13 * o33;

        r[ <span class="hljs-number">8</span> ] = s20 * o00 + s21 * o10 + s22 * o20 + s23 * o30;
        r[ <span class="hljs-number">9</span> ] = s20 * o01 + s21 * o11 + s22 * o21 + s23 * o31;
        r[ <span class="hljs-number">10</span> ] = s20 * o02 + s21 * o12 + s22 * o22 + s23 * o32;
        r[ <span class="hljs-number">11</span> ] = s20 * o03 + s21 * o13 + s22 * o23 + s23 * o33;

        r[ <span class="hljs-number">12</span> ] = s30 * o00 + s31 * o10 + s32 * o20 + s33 * o30;
        r[ <span class="hljs-number">13</span> ] = s30 * o01 + s31 * o11 + s32 * o21 + s33 * o31;
        r[ <span class="hljs-number">14</span> ] = s30 * o02 + s31 * o12 + s32 * o22 + s33 * o32;
        r[ <span class="hljs-number">15</span> ] = s30 * o03 + s31 * o13 + s32 * o23 + s33 * o33;

        <span class="hljs-keyword">return</span> r;
    },

    makeLookFromDirection: ( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> s = Vec3.create();
        <span class="hljs-keyword">var</span> u = Vec3.create();
        <span class="hljs-keyword">var</span> neg = Vec3.create();

        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> eye, eyeDir, up, result </span>) </span>{
            <span class="hljs-keyword">if</span> ( result === <span class="hljs-literal">undefined</span> ) {
                Notify.warn( <span class="hljs-string">'no matrix destination !'</span> );
                result = Matrix.create();
            }
            <span class="hljs-keyword">var</span> f = eyeDir;
            Vec3.cross( f, up, s );
            Vec3.normalize( s, s );

            Vec3.cross( s, f, u );
            Vec3.normalize( u, u );</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>s[0], u[0], -f[0], 0.0,
s[1], u[1], -f[1], 0.0,
s[2], u[2], -f[2], 0.0,
0,    0,    0,     1.0</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            result[ <span class="hljs-number">0</span> ] = s[ <span class="hljs-number">0</span> ];
            result[ <span class="hljs-number">1</span> ] = u[ <span class="hljs-number">0</span> ];
            result[ <span class="hljs-number">2</span> ] = -f[ <span class="hljs-number">0</span> ];
            result[ <span class="hljs-number">3</span> ] = <span class="hljs-number">0.0</span>;
            result[ <span class="hljs-number">4</span> ] = s[ <span class="hljs-number">1</span> ];
            result[ <span class="hljs-number">5</span> ] = u[ <span class="hljs-number">1</span> ];
            result[ <span class="hljs-number">6</span> ] = -f[ <span class="hljs-number">1</span> ];
            result[ <span class="hljs-number">7</span> ] = <span class="hljs-number">0.0</span>;
            result[ <span class="hljs-number">8</span> ] = s[ <span class="hljs-number">2</span> ];
            result[ <span class="hljs-number">9</span> ] = u[ <span class="hljs-number">2</span> ];
            result[ <span class="hljs-number">10</span> ] = -f[ <span class="hljs-number">2</span> ];
            result[ <span class="hljs-number">11</span> ] = <span class="hljs-number">0.0</span>;
            result[ <span class="hljs-number">12</span> ] = <span class="hljs-number">0</span>;
            result[ <span class="hljs-number">13</span> ] = <span class="hljs-number">0</span>;
            result[ <span class="hljs-number">14</span> ] = <span class="hljs-number">0</span>;
            result[ <span class="hljs-number">15</span> ] = <span class="hljs-number">1.0</span>;

            Matrix.multTranslate( result, Vec3.neg( eye, neg ), result );
            <span class="hljs-keyword">return</span> result;
        };
    } )(),
    makeLookAt: ( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> f = Vec3.create();

        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> eye, center, up, result </span>) </span>{
            <span class="hljs-keyword">if</span> ( result === <span class="hljs-literal">undefined</span> ) {
                Notify.warn( <span class="hljs-string">'no matrix destination !'</span> );
                result = Matrix.create();
            }


            Vec3.sub( center, eye, f );
            Vec3.normalize( f, f );
            <span class="hljs-keyword">this</span>.makeLookFromDirection( eye, f, up, result );
            <span class="hljs-keyword">return</span> result;
        };
    } )(),
    makeOrtho: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> left, right, bottom, top, zNear, zFar, result </span>) </span>{
        <span class="hljs-keyword">if</span> ( result === <span class="hljs-literal">undefined</span> ) {
            Notify.warn( <span class="hljs-string">'no matrix destination !'</span> );
            result = Matrix.create();
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>note transpose of Matrix_implementation wr.t OpenGL documentation, since the OSG use post multiplication rather than pre.
we will change this convention later</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> tx = -( right + left ) / ( right - left );
        <span class="hljs-keyword">var</span> ty = -( top + bottom ) / ( top - bottom );
        <span class="hljs-keyword">var</span> tz = -( zFar + zNear ) / ( zFar - zNear );
        <span class="hljs-keyword">var</span> row = Matrix.setRow;
        row( result, <span class="hljs-number">0</span>, <span class="hljs-number">2.0</span> / ( right - left ), <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span> );
        row( result, <span class="hljs-number">1</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">2.0</span> / ( top - bottom ), <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span> );
        row( result, <span class="hljs-number">2</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">-2.0</span> / ( zFar - zNear ), <span class="hljs-number">0.0</span> );
        row( result, <span class="hljs-number">3</span>, tx, ty, tz, <span class="hljs-number">1.0</span> );
        <span class="hljs-keyword">return</span> result;
    },

    getLookAt: ( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> inv = [ <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span> ];
        <span class="hljs-keyword">var</span> v1 = Vec3.create();
        <span class="hljs-keyword">var</span> v2 = [ <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span> ];
        <span class="hljs-keyword">var</span> v3 = [ <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">-1.0</span> ];

        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> matrix, eye, center, up, distance </span>) </span>{
            <span class="hljs-keyword">if</span> ( distance === <span class="hljs-literal">undefined</span> ) {
                distance = <span class="hljs-number">1.0</span>;
            }
            <span class="hljs-keyword">var</span> result = Matrix.inverse( matrix, inv );
            <span class="hljs-keyword">if</span> ( !result ) {
                Matrix.makeIdentity( inv );
            }
            Matrix.transformVec3( inv, v1, eye );
            Matrix.transform3x3( matrix, v2, up );
            Matrix.transform3x3( matrix, v3, center );
            Vec3.normalize( center, center );
            Vec3.add( Vec3.mult( center, distance, v1 ), eye, center );
        };
    } )(),</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>getRotate_David_Spillings_Mk1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    getRotate: ( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> tq = [ <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span> ];

        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> mat, quatResult </span>) </span>{
            <span class="hljs-keyword">if</span> ( quatResult === <span class="hljs-literal">undefined</span> ) {
                Notify.warn( <span class="hljs-string">'no quat destination !'</span> );
                quatResult = [ <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span> ];
            }

            <span class="hljs-keyword">var</span> s;
            <span class="hljs-keyword">var</span> i, j;</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Use tq to store the largest trace</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> mat00 = mat[ <span class="hljs-number">4</span> * <span class="hljs-number">0</span> + <span class="hljs-number">0</span> ];
            <span class="hljs-keyword">var</span> mat11 = mat[ <span class="hljs-number">4</span> * <span class="hljs-number">1</span> + <span class="hljs-number">1</span> ];
            <span class="hljs-keyword">var</span> mat22 = mat[ <span class="hljs-number">4</span> * <span class="hljs-number">2</span> + <span class="hljs-number">2</span> ];
            tq[ <span class="hljs-number">0</span> ] = <span class="hljs-number">1.0</span> + mat00 + mat11 + mat22;
            tq[ <span class="hljs-number">1</span> ] = <span class="hljs-number">1.0</span> + mat00 - mat11 - mat22;
            tq[ <span class="hljs-number">2</span> ] = <span class="hljs-number">1.0</span> - mat00 + mat11 - mat22;
            tq[ <span class="hljs-number">3</span> ] = <span class="hljs-number">1.0</span> - mat00 - mat11 + mat22;</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Find the maximum (could also use stacked if’s later)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            j = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">4</span>; i++ ) {
                <span class="hljs-keyword">if</span> ( ( tq[ i ] &gt; tq[ j ] ) ) {
                    j = i;
                } <span class="hljs-keyword">else</span> {
                    j = j;
                }
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>check the diagonal</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> ( j === <span class="hljs-number">0</span> ) {
                <span class="hljs-comment">/* perform instant calculation */</span>
                quatResult[ <span class="hljs-number">3</span> ] = tq[ <span class="hljs-number">0</span> ];
                quatResult[ <span class="hljs-number">0</span> ] = mat[ <span class="hljs-number">1</span> * <span class="hljs-number">4</span> + <span class="hljs-number">2</span> ] - mat[ <span class="hljs-number">2</span> * <span class="hljs-number">4</span> + <span class="hljs-number">1</span> ];
                quatResult[ <span class="hljs-number">1</span> ] = mat[ <span class="hljs-number">2</span> * <span class="hljs-number">4</span> + <span class="hljs-number">0</span> ] - mat[ <span class="hljs-number">0</span> + <span class="hljs-number">2</span> ];
                quatResult[ <span class="hljs-number">2</span> ] = mat[ <span class="hljs-number">0</span> + <span class="hljs-number">1</span> ] - mat[ <span class="hljs-number">1</span> * <span class="hljs-number">4</span> + <span class="hljs-number">0</span> ];
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( j === <span class="hljs-number">1</span> ) {
                quatResult[ <span class="hljs-number">3</span> ] = mat[ <span class="hljs-number">1</span> * <span class="hljs-number">4</span> + <span class="hljs-number">2</span> ] - mat[ <span class="hljs-number">2</span> * <span class="hljs-number">4</span> + <span class="hljs-number">1</span> ];
                quatResult[ <span class="hljs-number">0</span> ] = tq[ <span class="hljs-number">1</span> ];
                quatResult[ <span class="hljs-number">1</span> ] = mat[ <span class="hljs-number">0</span> + <span class="hljs-number">1</span> ] + mat[ <span class="hljs-number">1</span> * <span class="hljs-number">4</span> + <span class="hljs-number">0</span> ];
                quatResult[ <span class="hljs-number">2</span> ] = mat[ <span class="hljs-number">2</span> * <span class="hljs-number">4</span> + <span class="hljs-number">0</span> ] + mat[ <span class="hljs-number">0</span> + <span class="hljs-number">2</span> ];
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( j === <span class="hljs-number">2</span> ) {
                quatResult[ <span class="hljs-number">3</span> ] = mat[ <span class="hljs-number">2</span> * <span class="hljs-number">4</span> + <span class="hljs-number">0</span> ] - mat[ <span class="hljs-number">0</span> + <span class="hljs-number">2</span> ];
                quatResult[ <span class="hljs-number">0</span> ] = mat[ <span class="hljs-number">0</span> + <span class="hljs-number">1</span> ] + mat[ <span class="hljs-number">1</span> * <span class="hljs-number">4</span> + <span class="hljs-number">0</span> ];
                quatResult[ <span class="hljs-number">1</span> ] = tq[ <span class="hljs-number">2</span> ];
                quatResult[ <span class="hljs-number">2</span> ] = mat[ <span class="hljs-number">1</span> * <span class="hljs-number">4</span> + <span class="hljs-number">2</span> ] + mat[ <span class="hljs-number">2</span> * <span class="hljs-number">4</span> + <span class="hljs-number">1</span> ];
            } <span class="hljs-keyword">else</span> <span class="hljs-comment">/* if (j==3) */</span> {
                quatResult[ <span class="hljs-number">3</span> ] = mat[ <span class="hljs-number">0</span> + <span class="hljs-number">1</span> ] - mat[ <span class="hljs-number">1</span> * <span class="hljs-number">4</span> + <span class="hljs-number">0</span> ];
                quatResult[ <span class="hljs-number">0</span> ] = mat[ <span class="hljs-number">2</span> * <span class="hljs-number">4</span> + <span class="hljs-number">0</span> ] + mat[ <span class="hljs-number">0</span> + <span class="hljs-number">2</span> ];
                quatResult[ <span class="hljs-number">1</span> ] = mat[ <span class="hljs-number">1</span> * <span class="hljs-number">4</span> + <span class="hljs-number">2</span> ] + mat[ <span class="hljs-number">2</span> * <span class="hljs-number">4</span> + <span class="hljs-number">1</span> ];
                quatResult[ <span class="hljs-number">2</span> ] = tq[ <span class="hljs-number">3</span> ];
            }

            s = <span class="hljs-built_in">Math</span>.sqrt( <span class="hljs-number">0.25</span> / tq[ j ] );
            quatResult[ <span class="hljs-number">3</span> ] *= s;
            quatResult[ <span class="hljs-number">0</span> ] *= s;
            quatResult[ <span class="hljs-number">1</span> ] *= s;
            quatResult[ <span class="hljs-number">2</span> ] *= s;

            <span class="hljs-keyword">return</span> quatResult;
        };
    } )(),</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Matrix M = Matrix M * Matrix Translate</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    preMultTranslate: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> mat, translate </span>) </span>{
        <span class="hljs-keyword">var</span> val;
        <span class="hljs-keyword">if</span> ( translate[ <span class="hljs-number">0</span> ] !== <span class="hljs-number">0.0</span> ) {
            val = translate[ <span class="hljs-number">0</span> ];
            mat[ <span class="hljs-number">12</span> ] += val * mat[ <span class="hljs-number">0</span> ];
            mat[ <span class="hljs-number">13</span> ] += val * mat[ <span class="hljs-number">1</span> ];
            mat[ <span class="hljs-number">14</span> ] += val * mat[ <span class="hljs-number">2</span> ];
            mat[ <span class="hljs-number">15</span> ] += val * mat[ <span class="hljs-number">3</span> ];
        }

        <span class="hljs-keyword">if</span> ( translate[ <span class="hljs-number">1</span> ] !== <span class="hljs-number">0.0</span> ) {
            val = translate[ <span class="hljs-number">1</span> ];
            mat[ <span class="hljs-number">12</span> ] += val * mat[ <span class="hljs-number">4</span> ];
            mat[ <span class="hljs-number">13</span> ] += val * mat[ <span class="hljs-number">5</span> ];
            mat[ <span class="hljs-number">14</span> ] += val * mat[ <span class="hljs-number">6</span> ];
            mat[ <span class="hljs-number">15</span> ] += val * mat[ <span class="hljs-number">7</span> ];
        }

        <span class="hljs-keyword">if</span> ( translate[ <span class="hljs-number">2</span> ] !== <span class="hljs-number">0.0</span> ) {
            val = translate[ <span class="hljs-number">2</span> ];
            mat[ <span class="hljs-number">12</span> ] += val * mat[ <span class="hljs-number">8</span> ];
            mat[ <span class="hljs-number">13</span> ] += val * mat[ <span class="hljs-number">9</span> ];
            mat[ <span class="hljs-number">14</span> ] += val * mat[ <span class="hljs-number">10</span> ];
            mat[ <span class="hljs-number">15</span> ] += val * mat[ <span class="hljs-number">11</span> ];
        }
        <span class="hljs-keyword">return</span> mat;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>result = Matrix M * Matrix Translate</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    multTranslate: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> mat, translate, result </span>) </span>{
        <span class="hljs-keyword">if</span> ( result === <span class="hljs-literal">undefined</span> ) {
            Notify.warn( <span class="hljs-string">'no matrix destination !'</span> );
            result = Matrix.create();
        }
        <span class="hljs-keyword">if</span> ( result !== mat ) {
            Matrix.copy( mat, result );
        }

        <span class="hljs-keyword">var</span> val;
        <span class="hljs-keyword">if</span> ( translate[ <span class="hljs-number">0</span> ] !== <span class="hljs-number">0.0</span> ) {
            val = translate[ <span class="hljs-number">0</span> ];
            result[ <span class="hljs-number">12</span> ] += val * mat[ <span class="hljs-number">0</span> ];
            result[ <span class="hljs-number">13</span> ] += val * mat[ <span class="hljs-number">1</span> ];
            result[ <span class="hljs-number">14</span> ] += val * mat[ <span class="hljs-number">2</span> ];
            result[ <span class="hljs-number">15</span> ] += val * mat[ <span class="hljs-number">3</span> ];
        }

        <span class="hljs-keyword">if</span> ( translate[ <span class="hljs-number">1</span> ] !== <span class="hljs-number">0.0</span> ) {
            val = translate[ <span class="hljs-number">1</span> ];
            result[ <span class="hljs-number">12</span> ] += val * mat[ <span class="hljs-number">4</span> ];
            result[ <span class="hljs-number">13</span> ] += val * mat[ <span class="hljs-number">5</span> ];
            result[ <span class="hljs-number">14</span> ] += val * mat[ <span class="hljs-number">6</span> ];
            result[ <span class="hljs-number">15</span> ] += val * mat[ <span class="hljs-number">7</span> ];
        }

        <span class="hljs-keyword">if</span> ( translate[ <span class="hljs-number">2</span> ] !== <span class="hljs-number">0.0</span> ) {
            val = translate[ <span class="hljs-number">2</span> ];
            result[ <span class="hljs-number">12</span> ] += val * mat[ <span class="hljs-number">8</span> ];
            result[ <span class="hljs-number">13</span> ] += val * mat[ <span class="hljs-number">9</span> ];
            result[ <span class="hljs-number">14</span> ] += val * mat[ <span class="hljs-number">10</span> ];
            result[ <span class="hljs-number">15</span> ] += val * mat[ <span class="hljs-number">11</span> ];
        }
        <span class="hljs-keyword">return</span> result;
    },

    makeRotate: ( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> qtemp = Quat.create();

        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> angle, x, y, z, result </span>) </span>{
            <span class="hljs-keyword">if</span> ( result === <span class="hljs-literal">undefined</span> ) {
                Notify.warn( <span class="hljs-string">'no matrix destination !'</span> );
                result = Matrix.create();
            }
            <span class="hljs-keyword">return</span> Matrix.makeRotateFromQuat( Quat.makeRotate( angle, x, y, z, qtemp ), result );
        };
    } )(),

    transform3x3: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> m, v, result </span>) </span>{
        <span class="hljs-keyword">if</span> ( result === <span class="hljs-literal">undefined</span> ) {
            Notify.warn( <span class="hljs-string">'no matrix destination !'</span> );
            result = Matrix.create();
        }

        result[ <span class="hljs-number">0</span> ] = m[ <span class="hljs-number">0</span> ] * v[ <span class="hljs-number">0</span> ] + m[ <span class="hljs-number">1</span> ] * v[ <span class="hljs-number">1</span> ] + m[ <span class="hljs-number">2</span> ] * v[ <span class="hljs-number">2</span> ];
        result[ <span class="hljs-number">1</span> ] = m[ <span class="hljs-number">4</span> ] * v[ <span class="hljs-number">0</span> ] + m[ <span class="hljs-number">5</span> ] * v[ <span class="hljs-number">1</span> ] + m[ <span class="hljs-number">6</span> ] * v[ <span class="hljs-number">2</span> ];
        result[ <span class="hljs-number">2</span> ] = m[ <span class="hljs-number">8</span> ] * v[ <span class="hljs-number">0</span> ] + m[ <span class="hljs-number">9</span> ] * v[ <span class="hljs-number">1</span> ] + m[ <span class="hljs-number">10</span> ] * v[ <span class="hljs-number">2</span> ];
        <span class="hljs-keyword">return</span> result;
    },

    transformVec3: ( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> tmpVec = Vec3.create();

        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> matrix, vector, result </span>) </span>{
            <span class="hljs-keyword">if</span> ( result === <span class="hljs-literal">undefined</span> ) {
                Notify.warn( <span class="hljs-string">'no vec3 destination !'</span> );
                result = Vec3.create();
            }

            <span class="hljs-keyword">var</span> d = <span class="hljs-number">1.0</span> / ( matrix[ <span class="hljs-number">3</span> ] * vector[ <span class="hljs-number">0</span> ] + matrix[ <span class="hljs-number">7</span> ] * vector[ <span class="hljs-number">1</span> ] + matrix[ <span class="hljs-number">11</span> ] * vector[ <span class="hljs-number">2</span> ] + matrix[ <span class="hljs-number">15</span> ] );

            <span class="hljs-keyword">var</span> tmp;
            <span class="hljs-keyword">if</span> ( result === vector ) {
                tmp = tmpVec;
            } <span class="hljs-keyword">else</span> {
                tmp = result;
            }
            tmp[ <span class="hljs-number">0</span> ] = ( matrix[ <span class="hljs-number">0</span> ] * vector[ <span class="hljs-number">0</span> ] + matrix[ <span class="hljs-number">4</span> ] * vector[ <span class="hljs-number">1</span> ] + matrix[ <span class="hljs-number">8</span> ] * vector[ <span class="hljs-number">2</span> ] + matrix[ <span class="hljs-number">12</span> ] ) * d;
            tmp[ <span class="hljs-number">1</span> ] = ( matrix[ <span class="hljs-number">1</span> ] * vector[ <span class="hljs-number">0</span> ] + matrix[ <span class="hljs-number">5</span> ] * vector[ <span class="hljs-number">1</span> ] + matrix[ <span class="hljs-number">9</span> ] * vector[ <span class="hljs-number">2</span> ] + matrix[ <span class="hljs-number">13</span> ] ) * d;
            tmp[ <span class="hljs-number">2</span> ] = ( matrix[ <span class="hljs-number">2</span> ] * vector[ <span class="hljs-number">0</span> ] + matrix[ <span class="hljs-number">6</span> ] * vector[ <span class="hljs-number">1</span> ] + matrix[ <span class="hljs-number">10</span> ] * vector[ <span class="hljs-number">2</span> ] + matrix[ <span class="hljs-number">14</span> ] ) * d;

            <span class="hljs-keyword">if</span> ( result === vector ) {
                Vec3.copy( tmp, result );
            }
            <span class="hljs-keyword">return</span> result;
        };
    } )(),

    transformVec4: ( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> tmpVec = Vec4.create();

        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> matrix, vector, result </span>) </span>{

            <span class="hljs-keyword">if</span> ( result === <span class="hljs-literal">undefined</span> ) {
                Notify.warn( <span class="hljs-string">'no Vec4 destination !'</span> );
                result = Vec4.create();
            }
            <span class="hljs-keyword">var</span> tmp;
            <span class="hljs-keyword">if</span> ( result === vector ) {
                tmp = tmpVec;
            } <span class="hljs-keyword">else</span> {
                tmp = result;
            }
            tmp[ <span class="hljs-number">0</span> ] = ( matrix[ <span class="hljs-number">0</span> ] * vector[ <span class="hljs-number">0</span> ] + matrix[ <span class="hljs-number">4</span> ] * vector[ <span class="hljs-number">1</span> ] + matrix[ <span class="hljs-number">8</span> ] * vector[ <span class="hljs-number">2</span> ] + matrix[ <span class="hljs-number">12</span> ] * vector[ <span class="hljs-number">3</span> ] );
            tmp[ <span class="hljs-number">1</span> ] = ( matrix[ <span class="hljs-number">1</span> ] * vector[ <span class="hljs-number">0</span> ] + matrix[ <span class="hljs-number">5</span> ] * vector[ <span class="hljs-number">1</span> ] + matrix[ <span class="hljs-number">9</span> ] * vector[ <span class="hljs-number">2</span> ] + matrix[ <span class="hljs-number">13</span> ] * vector[ <span class="hljs-number">3</span> ] );
            tmp[ <span class="hljs-number">2</span> ] = ( matrix[ <span class="hljs-number">2</span> ] * vector[ <span class="hljs-number">0</span> ] + matrix[ <span class="hljs-number">6</span> ] * vector[ <span class="hljs-number">1</span> ] + matrix[ <span class="hljs-number">10</span> ] * vector[ <span class="hljs-number">2</span> ] + matrix[ <span class="hljs-number">14</span> ] * vector[ <span class="hljs-number">3</span> ] );
            tmp[ <span class="hljs-number">3</span> ] = ( matrix[ <span class="hljs-number">3</span> ] * vector[ <span class="hljs-number">0</span> ] + matrix[ <span class="hljs-number">7</span> ] * vector[ <span class="hljs-number">1</span> ] + matrix[ <span class="hljs-number">11</span> ] * vector[ <span class="hljs-number">2</span> ] + matrix[ <span class="hljs-number">15</span> ] * vector[ <span class="hljs-number">3</span> ] );

            <span class="hljs-keyword">if</span> ( result === vector ) {
                Vec4.copy( tmp, result );
            }
            <span class="hljs-keyword">return</span> result;
        };
    } )(),</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p><a href="http://dev.theomader.com/transform-bounding-boxes/">http://dev.theomader.com/transform-bounding-boxes/</a>
<a href="https://github.com/erich666/GraphicsGems/blob/master/gems/TransBox.c">https://github.com/erich666/GraphicsGems/blob/master/gems/TransBox.c</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    transformBoundingBox: ( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> tempBbox = <span class="hljs-keyword">new</span> BoundingBox();
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> m, bbIn, bbOut </span>) </span>{
            <span class="hljs-keyword">if</span> ( bbOut === bbIn ) {
                bbOut = tempBbox;
            }
            <span class="hljs-keyword">var</span> inMin = bbIn.getMin();
            <span class="hljs-keyword">var</span> inMax = bbIn.getMax();

            <span class="hljs-comment">/* Take care of translation by beginning at T. */</span>
            <span class="hljs-keyword">var</span> outMin = Matrix.getTrans( m, bbOut.getMin() );
            <span class="hljs-keyword">var</span> outMax = Vec3.copy( outMin, bbOut.getMax() );

            <span class="hljs-comment">/* Now find the extreme points by considering the product of the */</span>
            <span class="hljs-comment">/* min and max with each component of M.  */</span>
            <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; ++i ) {
                <span class="hljs-keyword">var</span> i4 = i * <span class="hljs-number">4</span>;
                <span class="hljs-keyword">var</span> mini = inMin[ i ];
                <span class="hljs-keyword">var</span> maxi = inMax[ i ];
                <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">3</span>; ++j ) {
                    <span class="hljs-keyword">var</span> cm = m[ i4 + j ];
                    <span class="hljs-keyword">var</span> a = cm * maxi;
                    <span class="hljs-keyword">var</span> b = cm * mini;
                    <span class="hljs-keyword">if</span> ( a &lt; b ) {
                        outMin[ j ] += a;
                        outMax[ j ] += b;
                    } <span class="hljs-keyword">else</span> {
                        outMin[ j ] += b;
                        outMax[ j ] += a;
                    }
                }
            }

            <span class="hljs-keyword">if</span> ( bbOut === tempBbox ) {
                bbIn.copy( tempBbox );
            }
        };
    } )(),

    transformBoundingSphere: ( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> scaleVec = Vec3.create();
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> matrix, bSphere, bsOut </span>) </span>{
            <span class="hljs-keyword">if</span> ( !bSphere.valid() ) {
                <span class="hljs-keyword">return</span> bsOut;
            }
            Vec3.copy( bSphere._center, bsOut._center );
            bsOut._radius = bSphere._radius;
            <span class="hljs-keyword">var</span> sphCenter = bsOut._center;
            <span class="hljs-keyword">var</span> sphRadius = bsOut._radius;

            Matrix.getScale2( matrix, scaleVec );
            <span class="hljs-keyword">var</span> scale = <span class="hljs-built_in">Math</span>.sqrt( <span class="hljs-built_in">Math</span>.max( <span class="hljs-built_in">Math</span>.max( scaleVec[ <span class="hljs-number">0</span> ], scaleVec[ <span class="hljs-number">1</span> ] ), scaleVec[ <span class="hljs-number">2</span> ] ) );
            sphRadius = sphRadius * scale;
            bsOut._radius = sphRadius;
            Matrix.transformVec3( matrix, sphCenter, sphCenter );

            <span class="hljs-keyword">return</span> bsOut;
        };
    } )(),

    transformVec4PostMult: ( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> tmpVec = Vec4.create();

        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> matrix, vector, result </span>) </span>{

            <span class="hljs-keyword">if</span> ( result === <span class="hljs-literal">undefined</span> ) {
                Notify.warn( <span class="hljs-string">'no Vec4 destination !'</span> );
                result = Vec4.create();
            }
            <span class="hljs-keyword">var</span> tmp;
            <span class="hljs-keyword">if</span> ( result === vector ) {
                tmp = tmpVec;
            } <span class="hljs-keyword">else</span> {
                tmp = result;
            }
            tmp[ <span class="hljs-number">0</span> ] = ( matrix[ <span class="hljs-number">0</span> ] * vector[ <span class="hljs-number">0</span> ] + matrix[ <span class="hljs-number">1</span> ] * vector[ <span class="hljs-number">1</span> ] + matrix[ <span class="hljs-number">2</span> ] * vector[ <span class="hljs-number">2</span> ] + matrix[ <span class="hljs-number">3</span> ] * vector[ <span class="hljs-number">3</span> ] );
            tmp[ <span class="hljs-number">1</span> ] = ( matrix[ <span class="hljs-number">4</span> ] * vector[ <span class="hljs-number">0</span> ] + matrix[ <span class="hljs-number">5</span> ] * vector[ <span class="hljs-number">1</span> ] + matrix[ <span class="hljs-number">6</span> ] * vector[ <span class="hljs-number">2</span> ] + matrix[ <span class="hljs-number">7</span> ] * vector[ <span class="hljs-number">3</span> ] );
            tmp[ <span class="hljs-number">2</span> ] = ( matrix[ <span class="hljs-number">8</span> ] * vector[ <span class="hljs-number">0</span> ] + matrix[ <span class="hljs-number">9</span> ] * vector[ <span class="hljs-number">1</span> ] + matrix[ <span class="hljs-number">10</span> ] * vector[ <span class="hljs-number">2</span> ] + matrix[ <span class="hljs-number">11</span> ] * vector[ <span class="hljs-number">3</span> ] );
            tmp[ <span class="hljs-number">3</span> ] = ( matrix[ <span class="hljs-number">12</span> ] * vector[ <span class="hljs-number">0</span> ] + matrix[ <span class="hljs-number">13</span> ] * vector[ <span class="hljs-number">1</span> ] + matrix[ <span class="hljs-number">14</span> ] * vector[ <span class="hljs-number">2</span> ] + matrix[ <span class="hljs-number">15</span> ] * vector[ <span class="hljs-number">3</span> ] );

            <span class="hljs-keyword">if</span> ( result === vector ) {
                Vec4.copy( tmp, result );
            }
            <span class="hljs-keyword">return</span> result;
        };
    } )(),

    copy: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> matrix, result </span>) </span>{
        result[ <span class="hljs-number">0</span> ] = matrix[ <span class="hljs-number">0</span> ];
        result[ <span class="hljs-number">1</span> ] = matrix[ <span class="hljs-number">1</span> ];
        result[ <span class="hljs-number">2</span> ] = matrix[ <span class="hljs-number">2</span> ];
        result[ <span class="hljs-number">3</span> ] = matrix[ <span class="hljs-number">3</span> ];
        result[ <span class="hljs-number">4</span> ] = matrix[ <span class="hljs-number">4</span> ];
        result[ <span class="hljs-number">5</span> ] = matrix[ <span class="hljs-number">5</span> ];
        result[ <span class="hljs-number">6</span> ] = matrix[ <span class="hljs-number">6</span> ];
        result[ <span class="hljs-number">7</span> ] = matrix[ <span class="hljs-number">7</span> ];
        result[ <span class="hljs-number">8</span> ] = matrix[ <span class="hljs-number">8</span> ];
        result[ <span class="hljs-number">9</span> ] = matrix[ <span class="hljs-number">9</span> ];
        result[ <span class="hljs-number">10</span> ] = matrix[ <span class="hljs-number">10</span> ];
        result[ <span class="hljs-number">11</span> ] = matrix[ <span class="hljs-number">11</span> ];
        result[ <span class="hljs-number">12</span> ] = matrix[ <span class="hljs-number">12</span> ];
        result[ <span class="hljs-number">13</span> ] = matrix[ <span class="hljs-number">13</span> ];
        result[ <span class="hljs-number">14</span> ] = matrix[ <span class="hljs-number">14</span> ];
        result[ <span class="hljs-number">15</span> ] = matrix[ <span class="hljs-number">15</span> ];
        <span class="hljs-keyword">return</span> result;
    },

    inverse: ( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> tmp = [ <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span> ];

        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> matrix, result </span>) </span>{
            <span class="hljs-keyword">if</span> ( result === matrix ) {
                Matrix.copy( matrix, tmp );
                matrix = tmp;
            }

            <span class="hljs-keyword">if</span> ( matrix[ <span class="hljs-number">3</span> ] === <span class="hljs-number">0.0</span> &amp;&amp; matrix[ <span class="hljs-number">7</span> ] === <span class="hljs-number">0.0</span> &amp;&amp; matrix[ <span class="hljs-number">11</span> ] === <span class="hljs-number">0.0</span> &amp;&amp; matrix[ <span class="hljs-number">15</span> ] === <span class="hljs-number">1.0</span> ) {
                <span class="hljs-keyword">return</span> Matrix.inverse4x3( matrix, result );
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> Matrix.inverse4x4( matrix, result );
            }
        };
    } )(),

    <span class="hljs-comment">/**
     *  if a result argument is given the return of the function is true or false
     *  depending if the matrix can be inverted, else if no result argument is given
     *  the return is identity if the matrix can not be inverted and the matrix overthise
     */</span>
    inverse4x4: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> matrix, result </span>) </span>{
        <span class="hljs-keyword">var</span> tmp0 = matrix[ <span class="hljs-number">10</span> ] * matrix[ <span class="hljs-number">15</span> ];
        <span class="hljs-keyword">var</span> tmp1 = matrix[ <span class="hljs-number">14</span> ] * matrix[ <span class="hljs-number">11</span> ];
        <span class="hljs-keyword">var</span> tmp2 = matrix[ <span class="hljs-number">6</span> ] * matrix[ <span class="hljs-number">15</span> ];
        <span class="hljs-keyword">var</span> tmp3 = matrix[ <span class="hljs-number">14</span> ] * matrix[ <span class="hljs-number">7</span> ];
        <span class="hljs-keyword">var</span> tmp4 = matrix[ <span class="hljs-number">6</span> ] * matrix[ <span class="hljs-number">11</span> ];
        <span class="hljs-keyword">var</span> tmp5 = matrix[ <span class="hljs-number">10</span> ] * matrix[ <span class="hljs-number">7</span> ];
        <span class="hljs-keyword">var</span> tmp6 = matrix[ <span class="hljs-number">2</span> ] * matrix[ <span class="hljs-number">15</span> ];
        <span class="hljs-keyword">var</span> tmp7 = matrix[ <span class="hljs-number">14</span> ] * matrix[ <span class="hljs-number">3</span> ];
        <span class="hljs-keyword">var</span> tmp8 = matrix[ <span class="hljs-number">2</span> ] * matrix[ <span class="hljs-number">11</span> ];
        <span class="hljs-keyword">var</span> tmp9 = matrix[ <span class="hljs-number">10</span> ] * matrix[ <span class="hljs-number">3</span> ];
        <span class="hljs-keyword">var</span> tmp10 = matrix[ <span class="hljs-number">2</span> ] * matrix[ <span class="hljs-number">7</span> ];
        <span class="hljs-keyword">var</span> tmp11 = matrix[ <span class="hljs-number">6</span> ] * matrix[ <span class="hljs-number">3</span> ];
        <span class="hljs-keyword">var</span> tmp12 = matrix[ <span class="hljs-number">8</span> ] * matrix[ <span class="hljs-number">13</span> ];
        <span class="hljs-keyword">var</span> tmp13 = matrix[ <span class="hljs-number">12</span> ] * matrix[ <span class="hljs-number">9</span> ];
        <span class="hljs-keyword">var</span> tmp14 = matrix[ <span class="hljs-number">4</span> ] * matrix[ <span class="hljs-number">13</span> ];
        <span class="hljs-keyword">var</span> tmp15 = matrix[ <span class="hljs-number">12</span> ] * matrix[ <span class="hljs-number">5</span> ];
        <span class="hljs-keyword">var</span> tmp16 = matrix[ <span class="hljs-number">4</span> ] * matrix[ <span class="hljs-number">9</span> ];
        <span class="hljs-keyword">var</span> tmp17 = matrix[ <span class="hljs-number">8</span> ] * matrix[ <span class="hljs-number">5</span> ];
        <span class="hljs-keyword">var</span> tmp18 = matrix[ <span class="hljs-number">0</span> ] * matrix[ <span class="hljs-number">13</span> ];
        <span class="hljs-keyword">var</span> tmp19 = matrix[ <span class="hljs-number">12</span> ] * matrix[ <span class="hljs-number">1</span> ];
        <span class="hljs-keyword">var</span> tmp20 = matrix[ <span class="hljs-number">0</span> ] * matrix[ <span class="hljs-number">9</span> ];
        <span class="hljs-keyword">var</span> tmp21 = matrix[ <span class="hljs-number">8</span> ] * matrix[ <span class="hljs-number">1</span> ];
        <span class="hljs-keyword">var</span> tmp22 = matrix[ <span class="hljs-number">0</span> ] * matrix[ <span class="hljs-number">5</span> ];
        <span class="hljs-keyword">var</span> tmp23 = matrix[ <span class="hljs-number">4</span> ] * matrix[ <span class="hljs-number">1</span> ];

        <span class="hljs-keyword">var</span> t0 = ( ( tmp0 * matrix[ <span class="hljs-number">5</span> ] + tmp3 * matrix[ <span class="hljs-number">9</span> ] + tmp4 * matrix[ <span class="hljs-number">13</span> ] ) -
            ( tmp1 * matrix[ <span class="hljs-number">5</span> ] + tmp2 * matrix[ <span class="hljs-number">9</span> ] + tmp5 * matrix[ <span class="hljs-number">13</span> ] ) );
        <span class="hljs-keyword">var</span> t1 = ( ( tmp1 * matrix[ <span class="hljs-number">1</span> ] + tmp6 * matrix[ <span class="hljs-number">9</span> ] + tmp9 * matrix[ <span class="hljs-number">13</span> ] ) -
            ( tmp0 * matrix[ <span class="hljs-number">1</span> ] + tmp7 * matrix[ <span class="hljs-number">9</span> ] + tmp8 * matrix[ <span class="hljs-number">13</span> ] ) );
        <span class="hljs-keyword">var</span> t2 = ( ( tmp2 * matrix[ <span class="hljs-number">1</span> ] + tmp7 * matrix[ <span class="hljs-number">5</span> ] + tmp10 * matrix[ <span class="hljs-number">13</span> ] ) -
            ( tmp3 * matrix[ <span class="hljs-number">1</span> ] + tmp6 * matrix[ <span class="hljs-number">5</span> ] + tmp11 * matrix[ <span class="hljs-number">13</span> ] ) );
        <span class="hljs-keyword">var</span> t3 = ( ( tmp5 * matrix[ <span class="hljs-number">1</span> ] + tmp8 * matrix[ <span class="hljs-number">5</span> ] + tmp11 * matrix[ <span class="hljs-number">9</span> ] ) -
            ( tmp4 * matrix[ <span class="hljs-number">1</span> ] + tmp9 * matrix[ <span class="hljs-number">5</span> ] + tmp10 * matrix[ <span class="hljs-number">9</span> ] ) );

        <span class="hljs-keyword">var</span> d1 = ( matrix[ <span class="hljs-number">0</span> ] * t0 + matrix[ <span class="hljs-number">4</span> ] * t1 + matrix[ <span class="hljs-number">8</span> ] * t2 + matrix[ <span class="hljs-number">12</span> ] * t3 );
        <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">Math</span>.abs( d1 ) &lt; <span class="hljs-built_in">Number</span>.EPSILON ) {
            Notify.log( <span class="hljs-string">'Warning can\'t inverse matrix '</span> + matrix, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span> );
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        <span class="hljs-keyword">var</span> d = <span class="hljs-number">1.0</span> / d1;

        <span class="hljs-keyword">var</span> out00 = d * t0;
        <span class="hljs-keyword">var</span> out01 = d * t1;
        <span class="hljs-keyword">var</span> out02 = d * t2;
        <span class="hljs-keyword">var</span> out03 = d * t3;

        <span class="hljs-keyword">var</span> out10 = d * ( ( tmp1 * matrix[ <span class="hljs-number">4</span> ] + tmp2 * matrix[ <span class="hljs-number">8</span> ] + tmp5 * matrix[ <span class="hljs-number">12</span> ] ) -
            ( tmp0 * matrix[ <span class="hljs-number">4</span> ] + tmp3 * matrix[ <span class="hljs-number">8</span> ] + tmp4 * matrix[ <span class="hljs-number">12</span> ] ) );
        <span class="hljs-keyword">var</span> out11 = d * ( ( tmp0 * matrix[ <span class="hljs-number">0</span> ] + tmp7 * matrix[ <span class="hljs-number">8</span> ] + tmp8 * matrix[ <span class="hljs-number">12</span> ] ) -
            ( tmp1 * matrix[ <span class="hljs-number">0</span> ] + tmp6 * matrix[ <span class="hljs-number">8</span> ] + tmp9 * matrix[ <span class="hljs-number">12</span> ] ) );
        <span class="hljs-keyword">var</span> out12 = d * ( ( tmp3 * matrix[ <span class="hljs-number">0</span> ] + tmp6 * matrix[ <span class="hljs-number">4</span> ] + tmp11 * matrix[ <span class="hljs-number">12</span> ] ) -
            ( tmp2 * matrix[ <span class="hljs-number">0</span> ] + tmp7 * matrix[ <span class="hljs-number">4</span> ] + tmp10 * matrix[ <span class="hljs-number">12</span> ] ) );
        <span class="hljs-keyword">var</span> out13 = d * ( ( tmp4 * matrix[ <span class="hljs-number">0</span> ] + tmp9 * matrix[ <span class="hljs-number">4</span> ] + tmp10 * matrix[ <span class="hljs-number">8</span> ] ) -
            ( tmp5 * matrix[ <span class="hljs-number">0</span> ] + tmp8 * matrix[ <span class="hljs-number">4</span> ] + tmp11 * matrix[ <span class="hljs-number">8</span> ] ) );

        <span class="hljs-keyword">var</span> out20 = d * ( ( tmp12 * matrix[ <span class="hljs-number">7</span> ] + tmp15 * matrix[ <span class="hljs-number">11</span> ] + tmp16 * matrix[ <span class="hljs-number">15</span> ] ) -
            ( tmp13 * matrix[ <span class="hljs-number">7</span> ] + tmp14 * matrix[ <span class="hljs-number">11</span> ] + tmp17 * matrix[ <span class="hljs-number">15</span> ] ) );
        <span class="hljs-keyword">var</span> out21 = d * ( ( tmp13 * matrix[ <span class="hljs-number">3</span> ] + tmp18 * matrix[ <span class="hljs-number">11</span> ] + tmp21 * matrix[ <span class="hljs-number">15</span> ] ) -
            ( tmp12 * matrix[ <span class="hljs-number">3</span> ] + tmp19 * matrix[ <span class="hljs-number">11</span> ] + tmp20 * matrix[ <span class="hljs-number">15</span> ] ) );
        <span class="hljs-keyword">var</span> out22 = d * ( ( tmp14 * matrix[ <span class="hljs-number">3</span> ] + tmp19 * matrix[ <span class="hljs-number">7</span> ] + tmp22 * matrix[ <span class="hljs-number">15</span> ] ) -
            ( tmp15 * matrix[ <span class="hljs-number">3</span> ] + tmp18 * matrix[ <span class="hljs-number">7</span> ] + tmp23 * matrix[ <span class="hljs-number">15</span> ] ) );
        <span class="hljs-keyword">var</span> out23 = d * ( ( tmp17 * matrix[ <span class="hljs-number">3</span> ] + tmp20 * matrix[ <span class="hljs-number">7</span> ] + tmp23 * matrix[ <span class="hljs-number">11</span> ] ) -
            ( tmp16 * matrix[ <span class="hljs-number">3</span> ] + tmp21 * matrix[ <span class="hljs-number">7</span> ] + tmp22 * matrix[ <span class="hljs-number">11</span> ] ) );

        <span class="hljs-keyword">var</span> out30 = d * ( ( tmp14 * matrix[ <span class="hljs-number">10</span> ] + tmp17 * matrix[ <span class="hljs-number">14</span> ] + tmp13 * matrix[ <span class="hljs-number">6</span> ] ) -
            ( tmp16 * matrix[ <span class="hljs-number">14</span> ] + tmp12 * matrix[ <span class="hljs-number">6</span> ] + tmp15 * matrix[ <span class="hljs-number">10</span> ] ) );
        <span class="hljs-keyword">var</span> out31 = d * ( ( tmp20 * matrix[ <span class="hljs-number">14</span> ] + tmp12 * matrix[ <span class="hljs-number">2</span> ] + tmp19 * matrix[ <span class="hljs-number">10</span> ] ) -
            ( tmp18 * matrix[ <span class="hljs-number">10</span> ] + tmp21 * matrix[ <span class="hljs-number">14</span> ] + tmp13 * matrix[ <span class="hljs-number">2</span> ] ) );
        <span class="hljs-keyword">var</span> out32 = d * ( ( tmp18 * matrix[ <span class="hljs-number">6</span> ] + tmp23 * matrix[ <span class="hljs-number">14</span> ] + tmp15 * matrix[ <span class="hljs-number">2</span> ] ) -
            ( tmp22 * matrix[ <span class="hljs-number">14</span> ] + tmp14 * matrix[ <span class="hljs-number">2</span> ] + tmp19 * matrix[ <span class="hljs-number">6</span> ] ) );
        <span class="hljs-keyword">var</span> out33 = d * ( ( tmp22 * matrix[ <span class="hljs-number">10</span> ] + tmp16 * matrix[ <span class="hljs-number">2</span> ] + tmp21 * matrix[ <span class="hljs-number">6</span> ] ) -
            ( tmp20 * matrix[ <span class="hljs-number">6</span> ] + tmp23 * matrix[ <span class="hljs-number">10</span> ] + tmp17 * matrix[ <span class="hljs-number">2</span> ] ) );

        result[ <span class="hljs-number">0</span> ] = out00;
        result[ <span class="hljs-number">1</span> ] = out01;
        result[ <span class="hljs-number">2</span> ] = out02;
        result[ <span class="hljs-number">3</span> ] = out03;
        result[ <span class="hljs-number">4</span> ] = out10;
        result[ <span class="hljs-number">5</span> ] = out11;
        result[ <span class="hljs-number">6</span> ] = out12;
        result[ <span class="hljs-number">7</span> ] = out13;
        result[ <span class="hljs-number">8</span> ] = out20;
        result[ <span class="hljs-number">9</span> ] = out21;
        result[ <span class="hljs-number">10</span> ] = out22;
        result[ <span class="hljs-number">11</span> ] = out23;
        result[ <span class="hljs-number">12</span> ] = out30;
        result[ <span class="hljs-number">13</span> ] = out31;
        result[ <span class="hljs-number">14</span> ] = out32;
        result[ <span class="hljs-number">15</span> ] = out33;

        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>comes from OpenSceneGraph</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-comment">/*
    Matrix inversion technique:
    Given a matrix mat, we want to invert it.
    mat = [ r00 r01 r02 a
            r10 r11 r12 b
            r20 r21 r22 c
            tx  ty  tz  d ]
    We note that this matrix can be split into three matrices.
    mat = rot * trans * corr, where rot is rotation part, trans is translation part, and corr is the correction due to perspective (if any).
    rot = [ r00 r01 r02 0
            r10 r11 r12 0
            r20 r21 r22 0
            0   0   0   1 ]
    trans = [ 1  0  0  0
              0  1  0  0
              0  0  1  0
              tx ty tz 1 ]
    corr = [ 1 0 0 px
             0 1 0 py
             0 0 1 pz
             0 0 0 s ]

    where the elements of corr are obtained from linear combinations of the elements of rot, trans, and mat.
    So the inverse is mat' = (trans * corr)' * rot', where rot' must be computed the traditional way, which is easy since it is only a 3x3 matrix.
    This problem is simplified if [px py pz s] = [0 0 0 1], which will happen if mat was composed only of rotations, scales, and translations (which is common).  In this case, we can ignore corr entirely which saves on a lot of computations.
  */</span>

    inverse4x3: ( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> inv = [ <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span> ];

        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> matrix, result </span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Copy rotation components</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> r00 = matrix[ <span class="hljs-number">0</span> ];
            <span class="hljs-keyword">var</span> r01 = matrix[ <span class="hljs-number">1</span> ];
            <span class="hljs-keyword">var</span> r02 = matrix[ <span class="hljs-number">2</span> ];

            <span class="hljs-keyword">var</span> r10 = matrix[ <span class="hljs-number">4</span> ];
            <span class="hljs-keyword">var</span> r11 = matrix[ <span class="hljs-number">5</span> ];
            <span class="hljs-keyword">var</span> r12 = matrix[ <span class="hljs-number">6</span> ];

            <span class="hljs-keyword">var</span> r20 = matrix[ <span class="hljs-number">8</span> ];
            <span class="hljs-keyword">var</span> r21 = matrix[ <span class="hljs-number">9</span> ];
            <span class="hljs-keyword">var</span> r22 = matrix[ <span class="hljs-number">10</span> ];</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Partially compute inverse of rot</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            result[ <span class="hljs-number">0</span> ] = r11 * r22 - r12 * r21;
            result[ <span class="hljs-number">1</span> ] = r02 * r21 - r01 * r22;
            result[ <span class="hljs-number">2</span> ] = r01 * r12 - r02 * r11;</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Compute determinant of rot from 3 elements just computed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> det = ( r00 * result[ <span class="hljs-number">0</span> ] + r10 * result[ <span class="hljs-number">1</span> ] + r20 * result[ <span class="hljs-number">2</span> ] );
            <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">Math</span>.abs( det ) &lt; <span class="hljs-built_in">Number</span>.EPSILON ) {
                Notify.log( <span class="hljs-string">'Warning can\'t inverse matrix '</span> + matrix, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span> );
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }

            <span class="hljs-keyword">var</span> oneOverDet = <span class="hljs-number">1.0</span> / det;
            r00 *= oneOverDet;
            r10 *= oneOverDet;
            r20 *= oneOverDet; <span class="hljs-comment">// Saves on later computations</span></pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Finish computing inverse of rot</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            result[ <span class="hljs-number">0</span> ] *= oneOverDet;
            result[ <span class="hljs-number">1</span> ] *= oneOverDet;
            result[ <span class="hljs-number">2</span> ] *= oneOverDet;
            result[ <span class="hljs-number">3</span> ] = <span class="hljs-number">0.0</span>;
            result[ <span class="hljs-number">4</span> ] = r12 * r20 - r10 * r22; <span class="hljs-comment">// Have already been divided by det</span>
            result[ <span class="hljs-number">5</span> ] = r00 * r22 - r02 * r20; <span class="hljs-comment">// same</span>
            result[ <span class="hljs-number">6</span> ] = r02 * r10 - r00 * r12; <span class="hljs-comment">// same</span>
            result[ <span class="hljs-number">7</span> ] = <span class="hljs-number">0.0</span>;
            result[ <span class="hljs-number">8</span> ] = r10 * r21 - r11 * r20; <span class="hljs-comment">// Have already been divided by det</span>
            result[ <span class="hljs-number">9</span> ] = r01 * r20 - r00 * r21; <span class="hljs-comment">// same</span>
            result[ <span class="hljs-number">10</span> ] = r00 * r11 - r01 * r10; <span class="hljs-comment">// same</span>
            result[ <span class="hljs-number">11</span> ] = <span class="hljs-number">0.0</span>;
            result[ <span class="hljs-number">15</span> ] = <span class="hljs-number">1.0</span>;

            <span class="hljs-keyword">var</span> tx, ty, tz;

            <span class="hljs-keyword">var</span> d = matrix[ <span class="hljs-number">15</span> ];
            <span class="hljs-keyword">var</span> dm = d - <span class="hljs-number">1.0</span>;
            <span class="hljs-keyword">if</span> ( dm * dm &gt; <span class="hljs-number">1.0e-6</span> ) <span class="hljs-comment">// Involves perspective, so we must</span>
            { <span class="hljs-comment">// compute the full inverse</span>

                result[ <span class="hljs-number">12</span> ] = result[ <span class="hljs-number">13</span> ] = result[ <span class="hljs-number">14</span> ] = <span class="hljs-number">0.0</span>;

                <span class="hljs-keyword">var</span> a = matrix[ <span class="hljs-number">3</span> ];
                <span class="hljs-keyword">var</span> b = matrix[ <span class="hljs-number">7</span> ];
                <span class="hljs-keyword">var</span> c = matrix[ <span class="hljs-number">11</span> ];
                <span class="hljs-keyword">var</span> px = result[ <span class="hljs-number">0</span> ] * a + result[ <span class="hljs-number">1</span> ] * b + result[ <span class="hljs-number">2</span> ] * c;
                <span class="hljs-keyword">var</span> py = result[ <span class="hljs-number">4</span> ] * a + result[ <span class="hljs-number">5</span> ] * b + result[ <span class="hljs-number">6</span> ] * c;
                <span class="hljs-keyword">var</span> pz = result[ <span class="hljs-number">8</span> ] * a + result[ <span class="hljs-number">9</span> ] * b + result[ <span class="hljs-number">10</span> ] * c;

                tx = matrix[ <span class="hljs-number">12</span> ];
                ty = matrix[ <span class="hljs-number">13</span> ];
                tz = matrix[ <span class="hljs-number">14</span> ];
                det = ( d - ( tx * px + ty * py + tz * pz ) );
                <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">Math</span>.abs( det ) &lt; <span class="hljs-built_in">Number</span>.EPSILON ) {
                    Notify.log( <span class="hljs-string">'Warning can\'t inverse matrix '</span> + matrix );
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                }
                <span class="hljs-keyword">var</span> oneOverS = <span class="hljs-number">1.0</span> / det;

                tx *= oneOverS;
                ty *= oneOverS;
                tz *= oneOverS; <span class="hljs-comment">// Reduces number of calculations later on</span></pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Compute inverse of trans*corr</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                inv[ <span class="hljs-number">0</span> ] = tx * px + <span class="hljs-number">1.0</span>;
                inv[ <span class="hljs-number">1</span> ] = ty * px;
                inv[ <span class="hljs-number">2</span> ] = tz * px;
                inv[ <span class="hljs-number">3</span> ] = -px * oneOverS;
                inv[ <span class="hljs-number">4</span> ] = tx * py;
                inv[ <span class="hljs-number">5</span> ] = ty * py + <span class="hljs-number">1.0</span>;
                inv[ <span class="hljs-number">6</span> ] = tz * py;
                inv[ <span class="hljs-number">7</span> ] = -py * oneOverS;
                inv[ <span class="hljs-number">8</span> ] = tx * pz;
                inv[ <span class="hljs-number">9</span> ] = ty * pz;
                inv[ <span class="hljs-number">10</span> ] = tz * pz + <span class="hljs-number">1.0</span>;
                inv[ <span class="hljs-number">11</span> ] = -pz * oneOverS;
                inv[ <span class="hljs-number">12</span> ] = -tx;
                inv[ <span class="hljs-number">13</span> ] = -ty;
                inv[ <span class="hljs-number">14</span> ] = -tz;
                inv[ <span class="hljs-number">15</span> ] = oneOverS;

                Matrix.preMult( result, inv ); <span class="hljs-comment">// Finish computing full inverse of mat</span>
            } <span class="hljs-keyword">else</span> {

                tx = matrix[ <span class="hljs-number">12</span> ];
                ty = matrix[ <span class="hljs-number">13</span> ];
                tz = matrix[ <span class="hljs-number">14</span> ];</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Compute translation components of mat’</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                result[ <span class="hljs-number">12</span> ] = -( tx * result[ <span class="hljs-number">0</span> ] + ty * result[ <span class="hljs-number">4</span> ] + tz * result[ <span class="hljs-number">8</span> ] );
                result[ <span class="hljs-number">13</span> ] = -( tx * result[ <span class="hljs-number">1</span> ] + ty * result[ <span class="hljs-number">5</span> ] + tz * result[ <span class="hljs-number">9</span> ] );
                result[ <span class="hljs-number">14</span> ] = -( tx * result[ <span class="hljs-number">2</span> ] + ty * result[ <span class="hljs-number">6</span> ] + tz * result[ <span class="hljs-number">10</span> ] );
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        };
    } )(),

    transpose: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> mat, dest </span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>from glMatrix
If we are transposing ourselves we can skip a few steps but have to cache some values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> ( mat === dest ) {
            <span class="hljs-keyword">var</span> a01 = mat[ <span class="hljs-number">1</span> ],
                a02 = mat[ <span class="hljs-number">2</span> ],
                a03 = mat[ <span class="hljs-number">3</span> ];
            <span class="hljs-keyword">var</span> a12 = mat[ <span class="hljs-number">6</span> ],
                a13 = mat[ <span class="hljs-number">7</span> ];
            <span class="hljs-keyword">var</span> a23 = mat[ <span class="hljs-number">11</span> ];

            mat[ <span class="hljs-number">1</span> ] = mat[ <span class="hljs-number">4</span> ];
            mat[ <span class="hljs-number">2</span> ] = mat[ <span class="hljs-number">8</span> ];
            mat[ <span class="hljs-number">3</span> ] = mat[ <span class="hljs-number">12</span> ];
            mat[ <span class="hljs-number">4</span> ] = a01;
            mat[ <span class="hljs-number">6</span> ] = mat[ <span class="hljs-number">9</span> ];
            mat[ <span class="hljs-number">7</span> ] = mat[ <span class="hljs-number">13</span> ];
            mat[ <span class="hljs-number">8</span> ] = a02;
            mat[ <span class="hljs-number">9</span> ] = a12;
            mat[ <span class="hljs-number">11</span> ] = mat[ <span class="hljs-number">14</span> ];
            mat[ <span class="hljs-number">12</span> ] = a03;
            mat[ <span class="hljs-number">13</span> ] = a13;
            mat[ <span class="hljs-number">14</span> ] = a23;
            <span class="hljs-keyword">return</span> mat;
        } <span class="hljs-keyword">else</span> {
            dest[ <span class="hljs-number">0</span> ] = mat[ <span class="hljs-number">0</span> ];
            dest[ <span class="hljs-number">1</span> ] = mat[ <span class="hljs-number">4</span> ];
            dest[ <span class="hljs-number">2</span> ] = mat[ <span class="hljs-number">8</span> ];
            dest[ <span class="hljs-number">3</span> ] = mat[ <span class="hljs-number">12</span> ];
            dest[ <span class="hljs-number">4</span> ] = mat[ <span class="hljs-number">1</span> ];
            dest[ <span class="hljs-number">5</span> ] = mat[ <span class="hljs-number">5</span> ];
            dest[ <span class="hljs-number">6</span> ] = mat[ <span class="hljs-number">9</span> ];
            dest[ <span class="hljs-number">7</span> ] = mat[ <span class="hljs-number">13</span> ];
            dest[ <span class="hljs-number">8</span> ] = mat[ <span class="hljs-number">2</span> ];
            dest[ <span class="hljs-number">9</span> ] = mat[ <span class="hljs-number">6</span> ];
            dest[ <span class="hljs-number">10</span> ] = mat[ <span class="hljs-number">10</span> ];
            dest[ <span class="hljs-number">11</span> ] = mat[ <span class="hljs-number">14</span> ];
            dest[ <span class="hljs-number">12</span> ] = mat[ <span class="hljs-number">3</span> ];
            dest[ <span class="hljs-number">13</span> ] = mat[ <span class="hljs-number">7</span> ];
            dest[ <span class="hljs-number">14</span> ] = mat[ <span class="hljs-number">11</span> ];
            dest[ <span class="hljs-number">15</span> ] = mat[ <span class="hljs-number">15</span> ];
            <span class="hljs-keyword">return</span> dest;
        }
    },

    getFrustumPlanes: ( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">var</span> mvp;

        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> projection, view, result, withNearFar </span>) </span>{
            mvp = mvp ? mvp : Matrix.create();
            Matrix.mult( projection, view, mvp );

            <span class="hljs-keyword">if</span> ( withNearFar === <span class="hljs-literal">undefined</span> )
                withNearFar = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Right clipping plane.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> right = result[ <span class="hljs-number">0</span> ];
            right[ <span class="hljs-number">0</span> ] = mvp[ <span class="hljs-number">3</span> ] - mvp[ <span class="hljs-number">0</span> ];
            right[ <span class="hljs-number">1</span> ] = mvp[ <span class="hljs-number">7</span> ] - mvp[ <span class="hljs-number">4</span> ];
            right[ <span class="hljs-number">2</span> ] = mvp[ <span class="hljs-number">11</span> ] - mvp[ <span class="hljs-number">8</span> ];
            right[ <span class="hljs-number">3</span> ] = mvp[ <span class="hljs-number">15</span> ] - mvp[ <span class="hljs-number">12</span> ];</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Left clipping plane.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> left = result[ <span class="hljs-number">1</span> ];
            left[ <span class="hljs-number">0</span> ] = mvp[ <span class="hljs-number">3</span> ] + mvp[ <span class="hljs-number">0</span> ];
            left[ <span class="hljs-number">1</span> ] = mvp[ <span class="hljs-number">7</span> ] + mvp[ <span class="hljs-number">4</span> ];
            left[ <span class="hljs-number">2</span> ] = mvp[ <span class="hljs-number">11</span> ] + mvp[ <span class="hljs-number">8</span> ];
            left[ <span class="hljs-number">3</span> ] = mvp[ <span class="hljs-number">15</span> ] + mvp[ <span class="hljs-number">12</span> ];</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Bottom clipping plane.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> bottom = result[ <span class="hljs-number">2</span> ];
            bottom[ <span class="hljs-number">0</span> ] = mvp[ <span class="hljs-number">3</span> ] + mvp[ <span class="hljs-number">1</span> ];
            bottom[ <span class="hljs-number">1</span> ] = mvp[ <span class="hljs-number">7</span> ] + mvp[ <span class="hljs-number">5</span> ];
            bottom[ <span class="hljs-number">2</span> ] = mvp[ <span class="hljs-number">11</span> ] + mvp[ <span class="hljs-number">9</span> ];
            bottom[ <span class="hljs-number">3</span> ] = mvp[ <span class="hljs-number">15</span> ] + mvp[ <span class="hljs-number">13</span> ];</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Top clipping plane.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> top = result[ <span class="hljs-number">3</span> ];
            top[ <span class="hljs-number">0</span> ] = mvp[ <span class="hljs-number">3</span> ] - mvp[ <span class="hljs-number">1</span> ];
            top[ <span class="hljs-number">1</span> ] = mvp[ <span class="hljs-number">7</span> ] - mvp[ <span class="hljs-number">5</span> ];
            top[ <span class="hljs-number">2</span> ] = mvp[ <span class="hljs-number">11</span> ] - mvp[ <span class="hljs-number">9</span> ];
            top[ <span class="hljs-number">3</span> ] = mvp[ <span class="hljs-number">15</span> ] - mvp[ <span class="hljs-number">13</span> ];

            <span class="hljs-keyword">if</span> ( withNearFar ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Far clipping plane.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">var</span> far = result[ <span class="hljs-number">4</span> ];
                far[ <span class="hljs-number">0</span> ] = mvp[ <span class="hljs-number">3</span> ] - mvp[ <span class="hljs-number">2</span> ];
                far[ <span class="hljs-number">1</span> ] = mvp[ <span class="hljs-number">7</span> ] - mvp[ <span class="hljs-number">6</span> ];
                far[ <span class="hljs-number">2</span> ] = mvp[ <span class="hljs-number">11</span> ] - mvp[ <span class="hljs-number">10</span> ];
                far[ <span class="hljs-number">3</span> ] = mvp[ <span class="hljs-number">15</span> ] - mvp[ <span class="hljs-number">14</span> ];</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Near clipping plane.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">var</span> near = result[ <span class="hljs-number">5</span> ];
                near[ <span class="hljs-number">0</span> ] = mvp[ <span class="hljs-number">3</span> ] + mvp[ <span class="hljs-number">2</span> ];
                near[ <span class="hljs-number">1</span> ] = mvp[ <span class="hljs-number">7</span> ] + mvp[ <span class="hljs-number">6</span> ];
                near[ <span class="hljs-number">2</span> ] = mvp[ <span class="hljs-number">11</span> ] + mvp[ <span class="hljs-number">10</span> ];
                near[ <span class="hljs-number">3</span> ] = mvp[ <span class="hljs-number">15</span> ] + mvp[ <span class="hljs-number">14</span> ];
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Normalize the planes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> j = withNearFar ? <span class="hljs-number">6</span> : <span class="hljs-number">4</span>;
            <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; j; i++ ) {
                Plane.normalizeEquation( result[ i ] );
            }

        };
    } )(),

    makePerspective: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> fovy, aspect, znear, zfar, result </span>) </span>{
        <span class="hljs-keyword">if</span> ( result === <span class="hljs-literal">undefined</span> ) {
            Notify.warn( <span class="hljs-string">'no matrix destination !'</span> );
            result = Matrix.create();
        }
        <span class="hljs-keyword">var</span> ymax = znear * <span class="hljs-built_in">Math</span>.tan( fovy * <span class="hljs-built_in">Math</span>.PI / <span class="hljs-number">360.0</span> );
        <span class="hljs-keyword">var</span> ymin = -ymax;
        <span class="hljs-keyword">var</span> xmin = ymin * aspect;
        <span class="hljs-keyword">var</span> xmax = ymax * aspect;

        <span class="hljs-keyword">return</span> Matrix.makeFrustum( xmin, xmax, ymin, ymax, znear, zfar, result );
    },

    getFrustum: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> matrix, result </span>) </span>{
        <span class="hljs-keyword">var</span> right = <span class="hljs-number">0.0</span>;
        <span class="hljs-keyword">var</span> left = <span class="hljs-number">0.0</span>;
        <span class="hljs-keyword">var</span> top = <span class="hljs-number">0.0</span>;
        <span class="hljs-keyword">var</span> bottom = <span class="hljs-number">0.0</span>;
        <span class="hljs-keyword">var</span> zNear, zFar;

        <span class="hljs-keyword">if</span> ( matrix[ <span class="hljs-number">0</span> * <span class="hljs-number">4</span> + <span class="hljs-number">3</span> ] !== <span class="hljs-number">0.0</span> || matrix[ <span class="hljs-number">1</span> * <span class="hljs-number">4</span> + <span class="hljs-number">3</span> ] !== <span class="hljs-number">0.0</span> || matrix[ <span class="hljs-number">2</span> * <span class="hljs-number">4</span> + <span class="hljs-number">3</span> ] !== <span class="hljs-number">-1.0</span> || matrix[ <span class="hljs-number">3</span> * <span class="hljs-number">4</span> + <span class="hljs-number">3</span> ] !== <span class="hljs-number">0.0</span> ) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>note: near and far must be used inside this method instead of zNear and zFar
because zNear and zFar are references and they may point to the same variable.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> tempNear = matrix[ <span class="hljs-number">3</span> * <span class="hljs-number">4</span> + <span class="hljs-number">2</span> ] / ( matrix[ <span class="hljs-number">2</span> * <span class="hljs-number">4</span> + <span class="hljs-number">2</span> ] - <span class="hljs-number">1.0</span> );
        <span class="hljs-keyword">var</span> tempFar = matrix[ <span class="hljs-number">3</span> * <span class="hljs-number">4</span> + <span class="hljs-number">2</span> ] / ( <span class="hljs-number">1.0</span> + matrix[ <span class="hljs-number">2</span> * <span class="hljs-number">4</span> + <span class="hljs-number">2</span> ] );

        left = tempNear * ( matrix[ <span class="hljs-number">2</span> * <span class="hljs-number">4</span> ] - <span class="hljs-number">1.0</span> ) / matrix[ <span class="hljs-number">0</span> ];
        right = tempNear * ( <span class="hljs-number">1.0</span> + matrix[ <span class="hljs-number">2</span> * <span class="hljs-number">4</span> ] ) / matrix[ <span class="hljs-number">0</span> ];

        top = tempNear * ( <span class="hljs-number">1.0</span> + matrix[ <span class="hljs-number">2</span> * <span class="hljs-number">4</span> + <span class="hljs-number">1</span> ] ) / matrix[ <span class="hljs-number">1</span> * <span class="hljs-number">4</span> + <span class="hljs-number">1</span> ];
        bottom = tempNear * ( matrix[ <span class="hljs-number">2</span> * <span class="hljs-number">4</span> + <span class="hljs-number">1</span> ] - <span class="hljs-number">1.0</span> ) / matrix[ <span class="hljs-number">1</span> * <span class="hljs-number">4</span> + <span class="hljs-number">1</span> ];

        zNear = tempNear;
        zFar = tempFar;

        result.left = left;
        result.right = right;
        result.top = top;
        result.bottom = bottom;
        result.zNear = zNear;
        result.zFar = zFar;

        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    },

    getPerspective: ( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> c = {
            <span class="hljs-string">'right'</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">'left'</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">'top'</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">'bottom'</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">'zNear'</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">'zFar'</span>: <span class="hljs-number">0</span>
        };
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> matrix, result </span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>get frustum and compute results</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> r = Matrix.getFrustum( matrix, c );
            <span class="hljs-keyword">if</span> ( r ) {
                result.fovy = <span class="hljs-number">180</span> / <span class="hljs-built_in">Math</span>.PI * ( <span class="hljs-built_in">Math</span>.atan( c.top / c.zNear ) - <span class="hljs-built_in">Math</span>.atan( c.bottom / c.zNear ) );
                result.aspectRatio = ( c.right - c.left ) / ( c.top - c.bottom );
            }
            result.zNear = c.zNear;
            result.zFar = c.zFar;
            <span class="hljs-keyword">return</span> result;
        };
    } )(),

    preMultScale: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> m, scale </span>) </span>{

        <span class="hljs-keyword">var</span> x = scale[ <span class="hljs-number">0</span> ];
        <span class="hljs-keyword">var</span> y = scale[ <span class="hljs-number">1</span> ];
        <span class="hljs-keyword">var</span> z = scale[ <span class="hljs-number">2</span> ];

        m[ <span class="hljs-number">0</span> ] *= x;
        m[ <span class="hljs-number">4</span> ] *= y;
        m[ <span class="hljs-number">8</span> ] *= z;

        m[ <span class="hljs-number">1</span> ] *= x;
        m[ <span class="hljs-number">5</span> ] *= y;
        m[ <span class="hljs-number">9</span> ] *= z;

        m[ <span class="hljs-number">2</span> ] *= x;
        m[ <span class="hljs-number">6</span> ] *= y;
        m[ <span class="hljs-number">10</span> ] *= z;

        m[ <span class="hljs-number">3</span> ] *= x;
        m[ <span class="hljs-number">7</span> ] *= y;
        m[ <span class="hljs-number">11</span> ] *= z;

        <span class="hljs-keyword">return</span> m;

    },

    makeScale: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> x, y, z, result </span>) </span>{
        <span class="hljs-keyword">if</span> ( result === <span class="hljs-literal">undefined</span> ) {
            Notify.warn( <span class="hljs-string">'no matrix destination !'</span> );
            result = Matrix.create();
        }
        Matrix.setRow( result, <span class="hljs-number">0</span>, x, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span> );
        Matrix.setRow( result, <span class="hljs-number">1</span>, <span class="hljs-number">0.0</span>, y, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span> );
        Matrix.setRow( result, <span class="hljs-number">2</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, z, <span class="hljs-number">0.0</span> );
        Matrix.setRow( result, <span class="hljs-number">3</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span> );
        <span class="hljs-keyword">return</span> result;
    },

    getScale: ( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> sx = Vec3.create();
        <span class="hljs-keyword">var</span> sy = Vec3.create();
        <span class="hljs-keyword">var</span> sz = Vec3.create();
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> matrix, result </span>) </span>{
            sx[ <span class="hljs-number">0</span> ] = matrix[ <span class="hljs-number">0</span> ];
            sx[ <span class="hljs-number">1</span> ] = matrix[ <span class="hljs-number">4</span> ];
            sx[ <span class="hljs-number">2</span> ] = matrix[ <span class="hljs-number">8</span> ];
            sy[ <span class="hljs-number">0</span> ] = matrix[ <span class="hljs-number">1</span> ];
            sy[ <span class="hljs-number">1</span> ] = matrix[ <span class="hljs-number">5</span> ];
            sy[ <span class="hljs-number">2</span> ] = matrix[ <span class="hljs-number">9</span> ];
            sz[ <span class="hljs-number">0</span> ] = matrix[ <span class="hljs-number">2</span> ];
            sz[ <span class="hljs-number">1</span> ] = matrix[ <span class="hljs-number">6</span> ];
            sz[ <span class="hljs-number">2</span> ] = matrix[ <span class="hljs-number">10</span> ];

            result[ <span class="hljs-number">0</span> ] = Vec3.length( sx );
            result[ <span class="hljs-number">1</span> ] = Vec3.length( sy );
            result[ <span class="hljs-number">2</span> ] = Vec3.length( sz );
            <span class="hljs-keyword">return</span> result;
        };
    } )(),

    getScale2: ( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> sx = Vec3.create();
        <span class="hljs-keyword">var</span> sy = Vec3.create();
        <span class="hljs-keyword">var</span> sz = Vec3.create();
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> matrix, result </span>) </span>{
            sx[ <span class="hljs-number">0</span> ] = matrix[ <span class="hljs-number">0</span> ];
            sx[ <span class="hljs-number">1</span> ] = matrix[ <span class="hljs-number">4</span> ];
            sx[ <span class="hljs-number">2</span> ] = matrix[ <span class="hljs-number">8</span> ];
            sy[ <span class="hljs-number">0</span> ] = matrix[ <span class="hljs-number">1</span> ];
            sy[ <span class="hljs-number">1</span> ] = matrix[ <span class="hljs-number">5</span> ];
            sy[ <span class="hljs-number">2</span> ] = matrix[ <span class="hljs-number">9</span> ];
            sz[ <span class="hljs-number">0</span> ] = matrix[ <span class="hljs-number">2</span> ];
            sz[ <span class="hljs-number">1</span> ] = matrix[ <span class="hljs-number">6</span> ];
            sz[ <span class="hljs-number">2</span> ] = matrix[ <span class="hljs-number">10</span> ];

            result[ <span class="hljs-number">0</span> ] = Vec3.length2( sx );
            result[ <span class="hljs-number">1</span> ] = Vec3.length2( sy );
            result[ <span class="hljs-number">2</span> ] = Vec3.length2( sz );
            <span class="hljs-keyword">return</span> result;
        };
    } )(),

    clampProjectionMatrix: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> projection, znear, zfar, nearFarRatio, resultNearFar </span>) </span>{
        <span class="hljs-keyword">var</span> epsilon = <span class="hljs-number">1e-6</span>;
        <span class="hljs-keyword">if</span> ( zfar &lt; znear - epsilon ) {
            Notify.log( <span class="hljs-string">'clampProjectionMatrix not applied, invalid depth range, znear = '</span> + znear + <span class="hljs-string">'  zfar = '</span> + zfar, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span> );
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        <span class="hljs-keyword">var</span> desiredZnear, desiredZfar;
        <span class="hljs-keyword">if</span> ( zfar &lt; znear + epsilon ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>znear and zfar are too close together and could cause divide by zero problems
late on in the clamping code, so move the znear and zfar apart.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> average = ( znear + zfar ) * <span class="hljs-number">0.5</span>;
            znear = average - epsilon;
            zfar = average + epsilon;</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>OSG_INFO &lt;&lt; ‘_clampProjectionMatrix widening znear and zfar to ‘&lt;&lt;znear&lt;&lt;’ ‘&lt;&lt;zfar&lt;&lt;std::endl;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        }

        <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">Math</span>.abs( Matrix.get( projection, <span class="hljs-number">0</span>, <span class="hljs-number">3</span> ) ) &lt; epsilon &amp;&amp;
            <span class="hljs-built_in">Math</span>.abs( Matrix.get( projection, <span class="hljs-number">1</span>, <span class="hljs-number">3</span> ) ) &lt; epsilon &amp;&amp;
            <span class="hljs-built_in">Math</span>.abs( Matrix.get( projection, <span class="hljs-number">2</span>, <span class="hljs-number">3</span> ) ) &lt; epsilon ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>OSG_INFO &lt;&lt; ‘Orthographic matrix before clamping’&lt;&lt;projection&lt;&lt;std::endl;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">var</span> deltaSpan = ( zfar - znear ) * <span class="hljs-number">0.02</span>;
            <span class="hljs-keyword">if</span> ( deltaSpan &lt; <span class="hljs-number">1.0</span> ) {
                deltaSpan = <span class="hljs-number">1.0</span>;
            }
            desiredZnear = znear - deltaSpan;
            desiredZfar = zfar + deltaSpan;</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>assign the clamped values back to the computed values.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            znear = desiredZnear;
            zfar = desiredZfar;

            Matrix.set( projection, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">-2.0</span> / ( desiredZfar - desiredZnear ) );
            Matrix.set( projection, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, -( desiredZfar + desiredZnear ) / ( desiredZfar - desiredZnear ) );</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>OSG_INFO &lt;&lt; ‘Orthographic matrix after clamping ‘&lt;&lt;projection&lt;&lt;std::endl;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>OSG_INFO &lt;&lt; ‘Persepective matrix before clamping’&lt;&lt;projection&lt;&lt;std::endl;
std::cout &lt;&lt; ‘_computed_znear’&lt;&lt;_computed_znear&lt;&lt;std::endl;
std::cout &lt;&lt; ‘_computed_zfar’&lt;&lt;_computed_zfar&lt;&lt;std::endl;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">var</span> zfarPushRatio = <span class="hljs-number">1.02</span>;
            <span class="hljs-keyword">var</span> znearPullRatio = <span class="hljs-number">0.98</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>znearPullRatio = 0.99;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            desiredZnear = znear * znearPullRatio;
            desiredZfar = zfar * zfarPushRatio;</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>near plane clamping.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> minNearPlane = zfar * nearFarRatio;
            <span class="hljs-keyword">if</span> ( desiredZnear &lt; minNearPlane ) {
                desiredZnear = minNearPlane;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>assign the clamped values back to the computed values.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            znear = desiredZnear;
            zfar = desiredZfar;

            <span class="hljs-keyword">var</span> m22 = Matrix.get( projection, <span class="hljs-number">2</span>, <span class="hljs-number">2</span> );
            <span class="hljs-keyword">var</span> m32 = Matrix.get( projection, <span class="hljs-number">3</span>, <span class="hljs-number">2</span> );
            <span class="hljs-keyword">var</span> m23 = Matrix.get( projection, <span class="hljs-number">2</span>, <span class="hljs-number">3</span> );
            <span class="hljs-keyword">var</span> m33 = Matrix.get( projection, <span class="hljs-number">3</span>, <span class="hljs-number">3</span> );
            <span class="hljs-keyword">var</span> transNearPlane = ( -desiredZnear * m22 + m32 ) / ( -desiredZnear * m23 + m33 );
            <span class="hljs-keyword">var</span> transFarPlane = ( -desiredZfar * m22 + m32 ) / ( -desiredZfar * m23 + m33 );

            <span class="hljs-keyword">var</span> ratio = <span class="hljs-built_in">Math</span>.abs( <span class="hljs-number">2.0</span> / ( transNearPlane - transFarPlane ) );
            <span class="hljs-keyword">var</span> center = -( transNearPlane + transFarPlane ) / <span class="hljs-number">2.0</span>;

            <span class="hljs-keyword">var</span> matrix = [ <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>,
                <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>,
                <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, ratio, <span class="hljs-number">0.0</span>,
                <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, center * ratio, <span class="hljs-number">1.0</span>
            ];
            Matrix.postMult( matrix, projection );</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>OSG_INFO &lt;&lt; ‘Persepective matrix after clamping’&lt;&lt;projection&lt;&lt;std::endl;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        }
        <span class="hljs-keyword">if</span> ( resultNearFar !== <span class="hljs-literal">undefined</span> ) {
            resultNearFar[ <span class="hljs-number">0</span> ] = znear;
            resultNearFar[ <span class="hljs-number">1</span> ] = zfar;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>compute the 4 corners vector of the frustum</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    computeFrustumCornersVectors: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> projectionMatrix, vectorsArray </span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>var znear = projectionMatrix[ 12 + 2 ] / ( projectionMatrix[ 8 + 2 ] - 1.0 );
var zfar = projectionMatrix[ 12 + 2 ] / ( projectionMatrix[ 8 + 2 ] + 1.0 );</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> x = <span class="hljs-number">1.0</span> / projectionMatrix[ <span class="hljs-number">0</span> ];
        <span class="hljs-keyword">var</span> y = <span class="hljs-number">1.0</span> / projectionMatrix[ <span class="hljs-number">1</span> * <span class="hljs-number">4</span> + <span class="hljs-number">1</span> ];

        vectorsArray[ <span class="hljs-number">0</span> ] = [ -x, y, <span class="hljs-number">1.0</span> ];
        vectorsArray[ <span class="hljs-number">1</span> ] = [ -x, -y, <span class="hljs-number">1.0</span> ];
        vectorsArray[ <span class="hljs-number">2</span> ] = [ x, -y, <span class="hljs-number">1.0</span> ];
        vectorsArray[ <span class="hljs-number">3</span> ] = [ x, y, <span class="hljs-number">1.0</span> ];
        <span class="hljs-keyword">return</span> vectorsArray;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>better precison
no far clipping artifacts.
no reason not to use.
Tightening the Precision of Perspective Rendering
<a href="http://www.geometry.caltech.edu/pubs/UD12.pdf">http://www.geometry.caltech.edu/pubs/UD12.pdf</a>
drop-in, just remove the one below, and rename this one</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    makeFrustumInfinite: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> left, right, bottom, top, znear, zfar, result </span>) </span>{
        <span class="hljs-keyword">if</span> ( result === <span class="hljs-literal">undefined</span> ) {
            Notify.warn( <span class="hljs-string">'no matrix destination !'</span> );
            result = Matrix.create();
        }
        <span class="hljs-keyword">var</span> X = <span class="hljs-number">2.0</span> * znear / ( right - left );
        <span class="hljs-keyword">var</span> Y = <span class="hljs-number">2.0</span> * znear / ( top - bottom );
        <span class="hljs-keyword">var</span> A = ( right + left ) / ( right - left );
        <span class="hljs-keyword">var</span> B = ( top + bottom ) / ( top - bottom );
        <span class="hljs-keyword">var</span> C = <span class="hljs-number">-1.0</span>;
        Matrix.setRow( result, <span class="hljs-number">0</span>, X, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span> );
        Matrix.setRow( result, <span class="hljs-number">1</span>, <span class="hljs-number">0.0</span>, Y, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span> );
        Matrix.setRow( result, <span class="hljs-number">2</span>, A, B, C, <span class="hljs-number">-1.0</span> );
        Matrix.setRow( result, <span class="hljs-number">3</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">-2.0</span> * znear, <span class="hljs-number">0.0</span> );
        <span class="hljs-keyword">return</span> result;
    },

    makeFrustum: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> left, right, bottom, top, znear, zfar, result </span>) </span>{
        <span class="hljs-keyword">if</span> ( result === <span class="hljs-literal">undefined</span> ) {
            Notify.warn( <span class="hljs-string">'no matrix destination !'</span> );
            result = Matrix.create();
        }
        <span class="hljs-keyword">var</span> X = <span class="hljs-number">2.0</span> * znear / ( right - left );
        <span class="hljs-keyword">var</span> Y = <span class="hljs-number">2.0</span> * znear / ( top - bottom );
        <span class="hljs-keyword">var</span> A = ( right + left ) / ( right - left );
        <span class="hljs-keyword">var</span> B = ( top + bottom ) / ( top - bottom );
        <span class="hljs-keyword">var</span> C = -( zfar + znear ) / ( zfar - znear );
        <span class="hljs-keyword">var</span> D = <span class="hljs-number">-2.0</span> * zfar * znear / ( zfar - znear );
        Matrix.setRow( result, <span class="hljs-number">0</span>, X, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span> );
        Matrix.setRow( result, <span class="hljs-number">1</span>, <span class="hljs-number">0.0</span>, Y, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span> );
        Matrix.setRow( result, <span class="hljs-number">2</span>, A, B, C, <span class="hljs-number">-1.0</span> );
        Matrix.setRow( result, <span class="hljs-number">3</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, D, <span class="hljs-number">0.0</span> );
        <span class="hljs-keyword">return</span> result;
    },

    makeRotateFromQuat: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> quat, result </span>) </span>{
        Matrix.makeIdentity( result );
        <span class="hljs-keyword">return</span> Matrix.setRotateFromQuat( result, quat );
    },

    setRotateFromQuat: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> matrix, quat </span>) </span>{
        <span class="hljs-keyword">var</span> length2 = Quat.length2( quat );
        <span class="hljs-keyword">if</span> ( Mabs( length2 ) &lt;= NMIN_VALUE ) {
            matrix[ <span class="hljs-number">0</span> ] = <span class="hljs-number">0.0</span>;
            matrix[ <span class="hljs-number">1</span> ] = <span class="hljs-number">0.0</span>;
            matrix[ <span class="hljs-number">2</span> ] = <span class="hljs-number">0.0</span>;

            matrix[ <span class="hljs-number">4</span> ] = <span class="hljs-number">0.0</span>;
            matrix[ <span class="hljs-number">5</span> ] = <span class="hljs-number">0.0</span>;
            matrix[ <span class="hljs-number">6</span> ] = <span class="hljs-number">0.0</span>;

            matrix[ <span class="hljs-number">8</span> ] = <span class="hljs-number">0.0</span>;
            matrix[ <span class="hljs-number">9</span> ] = <span class="hljs-number">0.0</span>;
            matrix[ <span class="hljs-number">10</span> ] = <span class="hljs-number">0.0</span>;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">var</span> rlength2;</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>normalize quat if required.
We can avoid the expensive sqrt in this case since all ‘coefficients’ below are products of two q components.
That is a square of a square root, so it is possible to avoid that</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> ( length2 !== <span class="hljs-number">1.0</span> ) {
                rlength2 = <span class="hljs-number">2.0</span> / length2;
            } <span class="hljs-keyword">else</span> {
                rlength2 = <span class="hljs-number">2.0</span>;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Source: Gamasutra, Rotating Objects Using Quaternions</p>
<p><a href="http://www.gamasutra.com/features/19980703/quaternions_01.htm">http://www.gamasutra.com/features/19980703/quaternions_01.htm</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">var</span> wx, wy, wz, xx, yy, yz, xy, xz, zz, x2, y2, z2;</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>calculate coefficients</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            x2 = rlength2 * quat[ <span class="hljs-number">0</span> ];
            y2 = rlength2 * quat[ <span class="hljs-number">1</span> ];
            z2 = rlength2 * quat[ <span class="hljs-number">2</span> ];

            xx = quat[ <span class="hljs-number">0</span> ] * x2;
            xy = quat[ <span class="hljs-number">0</span> ] * y2;
            xz = quat[ <span class="hljs-number">0</span> ] * z2;

            yy = quat[ <span class="hljs-number">1</span> ] * y2;
            yz = quat[ <span class="hljs-number">1</span> ] * z2;
            zz = quat[ <span class="hljs-number">2</span> ] * z2;

            wx = quat[ <span class="hljs-number">3</span> ] * x2;
            wy = quat[ <span class="hljs-number">3</span> ] * y2;
            wz = quat[ <span class="hljs-number">3</span> ] * z2;</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>Note.  Gamasutra gets the matrix assignments inverted, resulting
in left-handed rotations, which is contrary to OpenGL and OSG’s
methodology.  The matrix assignment has been altered in the next
few lines of code to do the right thing.
Don Burns - Oct 13, 2001</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            matrix[ <span class="hljs-number">0</span> ] = <span class="hljs-number">1.0</span> - ( yy + zz );
            matrix[ <span class="hljs-number">4</span> ] = xy - wz;
            matrix[ <span class="hljs-number">8</span> ] = xz + wy;


            matrix[ <span class="hljs-number">0</span> + <span class="hljs-number">1</span> ] = xy + wz;
            matrix[ <span class="hljs-number">4</span> + <span class="hljs-number">1</span> ] = <span class="hljs-number">1.0</span> - ( xx + zz );
            matrix[ <span class="hljs-number">8</span> + <span class="hljs-number">1</span> ] = yz - wx;

            matrix[ <span class="hljs-number">0</span> + <span class="hljs-number">2</span> ] = xz - wy;
            matrix[ <span class="hljs-number">4</span> + <span class="hljs-number">2</span> ] = yz + wx;
            matrix[ <span class="hljs-number">8</span> + <span class="hljs-number">2</span> ] = <span class="hljs-number">1.0</span> - ( xx + yy );
        }
        <span class="hljs-keyword">return</span> matrix;
    }
};

Matrix.identity = [ <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span> ];

<span class="hljs-built_in">module</span>.exports = Matrix;</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
