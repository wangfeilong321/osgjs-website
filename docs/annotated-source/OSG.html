<!DOCTYPE html>

<html>
<head>
  <title>osg.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="OSG.html">
                OSG.js
              </a>
            
              
              <a class="source" href="BillboardAttribute.html">
                BillboardAttribute.js
              </a>
            
              
              <a class="source" href="BlendColor.html">
                BlendColor.js
              </a>
            
              
              <a class="source" href="BlendFunc.html">
                BlendFunc.js
              </a>
            
              
              <a class="source" href="BoundingBox.html">
                BoundingBox.js
              </a>
            
              
              <a class="source" href="BoundingSphere.html">
                BoundingSphere.js
              </a>
            
              
              <a class="source" href="BufferArray.html">
                BufferArray.js
              </a>
            
              
              <a class="source" href="BufferArrayProxy.html">
                BufferArrayProxy.js
              </a>
            
              
              <a class="source" href="Camera.html">
                Camera.js
              </a>
            
              
              <a class="source" href="ColorMask.html">
                ColorMask.js
              </a>
            
              
              <a class="source" href="ComputeBoundsVisitor.html">
                ComputeBoundsVisitor.js
              </a>
            
              
              <a class="source" href="ComputeMatrixFromNodePath.html">
                ComputeMatrixFromNodePath.js
              </a>
            
              
              <a class="source" href="CullFace.html">
                CullFace.js
              </a>
            
              
              <a class="source" href="CullSettings.html">
                CullSettings.js
              </a>
            
              
              <a class="source" href="CullStack.html">
                CullStack.js
              </a>
            
              
              <a class="source" href="CullVisitor.html">
                CullVisitor.js
              </a>
            
              
              <a class="source" href="CullingSet.html">
                CullingSet.js
              </a>
            
              
              <a class="source" href="Depth.html">
                Depth.js
              </a>
            
              
              <a class="source" href="DrawArrayLengths.html">
                DrawArrayLengths.js
              </a>
            
              
              <a class="source" href="DrawArrays.html">
                DrawArrays.js
              </a>
            
              
              <a class="source" href="DrawElements.html">
                DrawElements.js
              </a>
            
              
              <a class="source" href="EllipsoidModel.html">
                EllipsoidModel.js
              </a>
            
              
              <a class="source" href="FrameBufferObject.html">
                FrameBufferObject.js
              </a>
            
              
              <a class="source" href="FrameStamp.html">
                FrameStamp.js
              </a>
            
              
              <a class="source" href="GLObject.html">
                GLObject.js
              </a>
            
              
              <a class="source" href="Geometry.html">
                Geometry.js
              </a>
            
              
              <a class="source" href="Image.html">
                Image.js
              </a>
            
              
              <a class="source" href="ImageStream.html">
                ImageStream.js
              </a>
            
              
              <a class="source" href="KdTree.html">
                KdTree.js
              </a>
            
              
              <a class="source" href="KdTreeBuilder.html">
                KdTreeBuilder.js
              </a>
            
              
              <a class="source" href="KdTreeRayIntersector.html">
                KdTreeRayIntersector.js
              </a>
            
              
              <a class="source" href="KdTreeSphereIntersector.html">
                KdTreeSphereIntersector.js
              </a>
            
              
              <a class="source" href="Light.html">
                Light.js
              </a>
            
              
              <a class="source" href="LightSource.html">
                LightSource.js
              </a>
            
              
              <a class="source" href="LineWidth.html">
                LineWidth.js
              </a>
            
              
              <a class="source" href="Lod.html">
                Lod.js
              </a>
            
              
              <a class="source" href="Map.html">
                Map.js
              </a>
            
              
              <a class="source" href="Material.html">
                Material.js
              </a>
            
              
              <a class="source" href="Math.html">
                Math.js
              </a>
            
              
              <a class="source" href="Matrix.html">
                Matrix.js
              </a>
            
              
              <a class="source" href="MatrixMemoryPool.html">
                MatrixMemoryPool.js
              </a>
            
              
              <a class="source" href="MatrixTransform.html">
                MatrixTransform.js
              </a>
            
              
              <a class="source" href="Node.html">
                Node.js
              </a>
            
              
              <a class="source" href="NodeVisitor.html">
                NodeVisitor.js
              </a>
            
              
              <a class="source" href="Notify.html">
                Notify.js
              </a>
            
              
              <a class="source" href="Object.html">
                Object.js
              </a>
            
              
              <a class="source" href="Options.html">
                Options.js
              </a>
            
              
              <a class="source" href="PagedLOD.html">
                PagedLOD.js
              </a>
            
              
              <a class="source" href="Plane.html">
                Plane.js
              </a>
            
              
              <a class="source" href="Polytope.html">
                Polytope.js
              </a>
            
              
              <a class="source" href="PrimitiveFunctor.html">
                PrimitiveFunctor.js
              </a>
            
              
              <a class="source" href="PrimitiveSet.html">
                PrimitiveSet.js
              </a>
            
              
              <a class="source" href="Program.html">
                Program.js
              </a>
            
              
              <a class="source" href="Projection.html">
                Projection.js
              </a>
            
              
              <a class="source" href="Quat.html">
                Quat.js
              </a>
            
              
              <a class="source" href="RenderBin.html">
                RenderBin.js
              </a>
            
              
              <a class="source" href="RenderLeaf.html">
                RenderLeaf.js
              </a>
            
              
              <a class="source" href="RenderStage.html">
                RenderStage.js
              </a>
            
              
              <a class="source" href="Shader.html">
                Shader.js
              </a>
            
              
              <a class="source" href="Shape.html">
                Shape.js
              </a>
            
              
              <a class="source" href="Stack.html">
                Stack.js
              </a>
            
              
              <a class="source" href="State.html">
                State.js
              </a>
            
              
              <a class="source" href="StateAttribute.html">
                StateAttribute.js
              </a>
            
              
              <a class="source" href="StateGraph.html">
                StateGraph.js
              </a>
            
              
              <a class="source" href="StateSet.html">
                StateSet.js
              </a>
            
              
              <a class="source" href="Texture.html">
                Texture.js
              </a>
            
              
              <a class="source" href="TextureCubeMap.html">
                TextureCubeMap.js
              </a>
            
              
              <a class="source" href="TextureManager.html">
                TextureManager.js
              </a>
            
              
              <a class="source" href="Timer.html">
                Timer.js
              </a>
            
              
              <a class="source" href="Transform.html">
                Transform.js
              </a>
            
              
              <a class="source" href="TransformEnums.html">
                TransformEnums.js
              </a>
            
              
              <a class="source" href="TriangleIndexFunctor.html">
                TriangleIndexFunctor.js
              </a>
            
              
              <a class="source" href="Uniform.html">
                Uniform.js
              </a>
            
              
              <a class="source" href="UpdateVisitor.html">
                UpdateVisitor.js
              </a>
            
              
              <a class="source" href="Utils.html">
                Utils.js
              </a>
            
              
              <a class="source" href="Vec2.html">
                Vec2.js
              </a>
            
              
              <a class="source" href="Vec3.html">
                Vec3.js
              </a>
            
              
              <a class="source" href="Vec4.html">
                Vec4.js
              </a>
            
              
              <a class="source" href="Viewport.html">
                Viewport.js
              </a>
            
              
              <a class="source" href="WebGLCaps.html">
                WebGLCaps.js
              </a>
            
              
              <a class="source" href="osg.html">
                osg.js
              </a>
            
              
              <a class="source" href="Animation.html">
                Animation.js
              </a>
            
              
              <a class="source" href="AnimationUpdateCallback.html">
                AnimationUpdateCallback.js
              </a>
            
              
              <a class="source" href="BasicAnimationManager.html">
                BasicAnimationManager.js
              </a>
            
              
              <a class="source" href="Bone.html">
                Bone.js
              </a>
            
              
              <a class="source" href="Channel.html">
                Channel.js
              </a>
            
              
              <a class="source" href="CollectAnimationUpdateCallbackVisitor.html">
                CollectAnimationUpdateCallbackVisitor.js
              </a>
            
              
              <a class="source" href="CollectBoneVisitor.html">
                CollectBoneVisitor.js
              </a>
            
              
              <a class="source" href="Easing.html">
                Easing.js
              </a>
            
              
              <a class="source" href="FindNearestParentSkeleton.html">
                FindNearestParentSkeleton.js
              </a>
            
              
              <a class="source" href="Interpolator.html">
                Interpolator.js
              </a>
            
              
              <a class="source" href="MorphAttribute.html">
                MorphAttribute.js
              </a>
            
              
              <a class="source" href="MorphGeometry.html">
                MorphGeometry.js
              </a>
            
              
              <a class="source" href="RigGeometry.html">
                RigGeometry.js
              </a>
            
              
              <a class="source" href="RigTransformHardware.html">
                RigTransformHardware.js
              </a>
            
              
              <a class="source" href="Skeleton.html">
                Skeleton.js
              </a>
            
              
              <a class="source" href="SkinningAttribute.html">
                SkinningAttribute.js
              </a>
            
              
              <a class="source" href="StackedMatrix.html">
                StackedMatrix.js
              </a>
            
              
              <a class="source" href="StackedQuaternion.html">
                StackedQuaternion.js
              </a>
            
              
              <a class="source" href="StackedRotateAxis.html">
                StackedRotateAxis.js
              </a>
            
              
              <a class="source" href="StackedScale.html">
                StackedScale.js
              </a>
            
              
              <a class="source" href="StackedTranslate.html">
                StackedTranslate.js
              </a>
            
              
              <a class="source" href="Target.html">
                Target.js
              </a>
            
              
              <a class="source" href="UpdateBone.html">
                UpdateBone.js
              </a>
            
              
              <a class="source" href="UpdateMatrixTransform.html">
                UpdateMatrixTransform.js
              </a>
            
              
              <a class="source" href="UpdateMorph.html">
                UpdateMorph.js
              </a>
            
              
              <a class="source" href="UpdateRigGeometry.html">
                UpdateRigGeometry.js
              </a>
            
              
              <a class="source" href="UpdateSkeleton.html">
                UpdateSkeleton.js
              </a>
            
              
              <a class="source" href="channelType.html">
                channelType.js
              </a>
            
              
              <a class="source" href="osgAnimation.html">
                osgAnimation.js
              </a>
            
              
              <a class="source" href="DatabasePager.html">
                DatabasePager.js
              </a>
            
              
              <a class="source" href="Input.html">
                Input.js
              </a>
            
              
              <a class="source" href="Options.html">
                Options.js
              </a>
            
              
              <a class="source" href="ReaderParser.html">
                ReaderParser.js
              </a>
            
              
              <a class="source" href="osgDB.html">
                osgDB.js
              </a>
            
              
              <a class="source" href="FirstPersonManipulator.html">
                FirstPersonManipulator.js
              </a>
            
              
              <a class="source" href="FirstPersonManipulatorDeviceOrientationController.html">
                FirstPersonManipulatorDeviceOrientationController.js
              </a>
            
              
              <a class="source" href="FirstPersonManipulatorHammerController.html">
                FirstPersonManipulatorHammerController.js
              </a>
            
              
              <a class="source" href="FirstPersonManipulatorStandardMouseKeyboardController.html">
                FirstPersonManipulatorStandardMouseKeyboardController.js
              </a>
            
              
              <a class="source" href="FirstPersonManipulatorWebVRController.html">
                FirstPersonManipulatorWebVRController.js
              </a>
            
              
              <a class="source" href="Manipulator.html">
                Manipulator.js
              </a>
            
              
              <a class="source" href="OrbitManipulator.html">
                OrbitManipulator.js
              </a>
            
              
              <a class="source" href="OrbitManipulatorDeviceOrientationController.html">
                OrbitManipulatorDeviceOrientationController.js
              </a>
            
              
              <a class="source" href="OrbitManipulatorEnums.html">
                OrbitManipulatorEnums.js
              </a>
            
              
              <a class="source" href="OrbitManipulatorGamePadController.html">
                OrbitManipulatorGamePadController.js
              </a>
            
              
              <a class="source" href="OrbitManipulatorHammerController.html">
                OrbitManipulatorHammerController.js
              </a>
            
              
              <a class="source" href="OrbitManipulatorLeapMotionController.html">
                OrbitManipulatorLeapMotionController.js
              </a>
            
              
              <a class="source" href="OrbitManipulatorStandardMouseKeyboardController.html">
                OrbitManipulatorStandardMouseKeyboardController.js
              </a>
            
              
              <a class="source" href="OrbitManipulatorWebVRController.html">
                OrbitManipulatorWebVRController.js
              </a>
            
              
              <a class="source" href="SwitchManipulator.html">
                SwitchManipulator.js
              </a>
            
              
              <a class="source" href="osgGA.html">
                osgGA.js
              </a>
            
              
              <a class="source" href="osgNameSpace.html">
                osgNameSpace.js
              </a>
            
              
              <a class="source" href="Compiler.html">
                Compiler.js
              </a>
            
              
              <a class="source" href="ShaderGenerator.html">
                ShaderGenerator.js
              </a>
            
              
              <a class="source" href="ShaderGeneratorProxy.html">
                ShaderGeneratorProxy.js
              </a>
            
              
              <a class="source" href="ShaderProcessor.html">
                ShaderProcessor.js
              </a>
            
              
              <a class="source" href="node.html">
                node.js
              </a>
            
              
              <a class="source" href="Node.html">
                Node.js
              </a>
            
              
              <a class="source" href="data.html">
                data.js
              </a>
            
              
              <a class="source" href="functions.html">
                functions.js
              </a>
            
              
              <a class="source" href="lights.html">
                lights.js
              </a>
            
              
              <a class="source" href="morph.html">
                morph.js
              </a>
            
              
              <a class="source" href="operations.html">
                operations.js
              </a>
            
              
              <a class="source" href="shadows.html">
                shadows.js
              </a>
            
              
              <a class="source" href="skinning.html">
                skinning.js
              </a>
            
              
              <a class="source" href="textures.html">
                textures.js
              </a>
            
              
              <a class="source" href="nodeFactory.html">
                nodeFactory.js
              </a>
            
              
              <a class="source" href="osgShader.html">
                osgShader.js
              </a>
            
              
              <a class="source" href="shaderLib.html">
                shaderLib.js
              </a>
            
              
              <a class="source" href="utils.html">
                utils.js
              </a>
            
              
              <a class="source" href="ShadowCastAttribute.html">
                ShadowCastAttribute.js
              </a>
            
              
              <a class="source" href="ShadowCastCompiler.html">
                ShadowCastCompiler.js
              </a>
            
              
              <a class="source" href="ShadowCastShaderGenerator.html">
                ShadowCastShaderGenerator.js
              </a>
            
              
              <a class="source" href="ShadowCasterVisitor.html">
                ShadowCasterVisitor.js
              </a>
            
              
              <a class="source" href="ShadowFrustumIntersection.html">
                ShadowFrustumIntersection.js
              </a>
            
              
              <a class="source" href="ShadowMap.html">
                ShadowMap.js
              </a>
            
              
              <a class="source" href="ShadowReceiveAttribute.html">
                ShadowReceiveAttribute.js
              </a>
            
              
              <a class="source" href="ShadowSettings.html">
                ShadowSettings.js
              </a>
            
              
              <a class="source" href="ShadowTechnique.html">
                ShadowTechnique.js
              </a>
            
              
              <a class="source" href="ShadowTexture.html">
                ShadowTexture.js
              </a>
            
              
              <a class="source" href="ShadowedScene.html">
                ShadowedScene.js
              </a>
            
              
              <a class="source" href="osgShadow.html">
                osgShadow.js
              </a>
            
              
              <a class="source" href="shaderLib.html">
                shaderLib.js
              </a>
            
              
              <a class="source" href="Text.html">
                Text.js
              </a>
            
              
              <a class="source" href="osgText.html">
                osgText.js
              </a>
            
              
              <a class="source" href="Composer.html">
                Composer.js
              </a>
            
              
              <a class="source" href="DisplayGeometryVisitor.html">
                DisplayGeometryVisitor.js
              </a>
            
              
              <a class="source" href="DisplayGraph.html">
                DisplayGraph.js
              </a>
            
              
              <a class="source" href="DisplayGraphNode.html">
                DisplayGraphNode.js
              </a>
            
              
              <a class="source" href="DisplayGraphRenderer.html">
                DisplayGraphRenderer.js
              </a>
            
              
              <a class="source" href="DisplayNormalVisitor.html">
                DisplayNormalVisitor.js
              </a>
            
              
              <a class="source" href="GizmoGeometry.html">
                GizmoGeometry.js
              </a>
            
              
              <a class="source" href="IntersectionVisitor.html">
                IntersectionVisitor.js
              </a>
            
              
              <a class="source" href="LineSegmentIntersector.html">
                LineSegmentIntersector.js
              </a>
            
              
              <a class="source" href="NodeGizmo.html">
                NodeGizmo.js
              </a>
            
              
              <a class="source" href="ParameterVisitor.html">
                ParameterVisitor.js
              </a>
            
              
              <a class="source" href="PolytopeIntersector.html">
                PolytopeIntersector.js
              </a>
            
              
              <a class="source" href="PolytopePrimitiveIntersector.html">
                PolytopePrimitiveIntersector.js
              </a>
            
              
              <a class="source" href="SphereIntersector.html">
                SphereIntersector.js
              </a>
            
              
              <a class="source" href="TangentSpaceGenerator.html">
                TangentSpaceGenerator.js
              </a>
            
              
              <a class="source" href="TriangleIntersector.html">
                TriangleIntersector.js
              </a>
            
              
              <a class="source" href="TriangleSphereIntersector.html">
                TriangleSphereIntersector.js
              </a>
            
              
              <a class="source" href="WebVR.html">
                WebVR.js
              </a>
            
              
              <a class="source" href="WebVRCustom.html">
                WebVRCustom.js
              </a>
            
              
              <a class="source" href="osgPool.html">
                osgPool.js
              </a>
            
              
              <a class="source" href="osgUtil.html">
                osgUtil.js
              </a>
            
              
              <a class="source" href="Renderer.html">
                Renderer.js
              </a>
            
              
              <a class="source" href="Scene.html">
                Scene.js
              </a>
            
              
              <a class="source" href="View.html">
                View.js
              </a>
            
              
              <a class="source" href="Viewer.html">
                Viewer.js
              </a>
            
              
              <a class="source" href="createStats.html">
                createStats.js
              </a>
            
              
              <a class="source" href="DeviceOrientation.html">
                DeviceOrientation.js
              </a>
            
              
              <a class="source" href="EventProxy.html">
                EventProxy.js
              </a>
            
              
              <a class="source" href="GamePad.html">
                GamePad.js
              </a>
            
              
              <a class="source" href="Hammer.html">
                Hammer.js
              </a>
            
              
              <a class="source" href="LeapMotion.html">
                LeapMotion.js
              </a>
            
              
              <a class="source" href="StandardMouseKeyboard.html">
                StandardMouseKeyboard.js
              </a>
            
              
              <a class="source" href="WebVR.html">
                WebVR.js
              </a>
            
              
              <a class="source" href="osgViewer.html">
                osgViewer.js
              </a>
            
              
              <a class="source" href="webgl-debug.html">
                webgl-debug.js
              </a>
            
              
              <a class="source" href="webgl-utils.html">
                webgl-utils.js
              </a>
            
              
              <a class="source" href="osgWrappers.html">
                osgWrappers.js
              </a>
            
              
              <a class="source" href="osg.html">
                osg.js
              </a>
            
              
              <a class="source" href="osgAnimation.html">
                osgAnimation.js
              </a>
            
              
              <a class="source" href="osgText.html">
                osgText.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>osg.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-meta">'use strict'</span>;
<span class="hljs-keyword">var</span> P = <span class="hljs-built_in">require</span>( <span class="hljs-string">'bluebird'</span> );


<span class="hljs-keyword">var</span> osgWrapper = {};

osgWrapper.Object = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> input, obj </span>) </span>{
    <span class="hljs-keyword">var</span> jsonObj = input.getJSON();

    <span class="hljs-keyword">if</span> ( jsonObj.Name ) obj.setName( jsonObj.Name );

    <span class="hljs-keyword">if</span> ( jsonObj.UserDataContainer ) {
        <span class="hljs-keyword">var</span> userdata = input.setJSON( jsonObj.UserDataContainer ).readUserDataContainer();
        <span class="hljs-keyword">if</span> ( userdata !== <span class="hljs-literal">undefined</span> ) {
            obj.setUserData( userdata );
        }
    }

    <span class="hljs-keyword">return</span> obj;
};
<span class="hljs-comment">/* jshint newcap: false */</span>
osgWrapper.Node = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> input, node </span>) </span>{
    <span class="hljs-keyword">var</span> jsonObj = input.getJSON();

    osgWrapper.Object( input, node );

    <span class="hljs-keyword">var</span> promiseArray = [];

    <span class="hljs-keyword">if</span> ( jsonObj.UpdateCallbacks ) {
        <span class="hljs-keyword">var</span> cbAddCallback = node.addUpdateCallback.bind( node );
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>, l = jsonObj.UpdateCallbacks.length; j &lt; l; j++ ) {
            <span class="hljs-keyword">var</span> promise = input.setJSON( jsonObj.UpdateCallbacks[ j ] ).readObject();
            promiseArray.push( promise );
            promise.then( cbAddCallback );
        }
    }

    <span class="hljs-keyword">if</span> ( jsonObj.StateSet ) {
        <span class="hljs-keyword">var</span> pp = input.setJSON( jsonObj.StateSet ).readObject();
        promiseArray.push( pp );
        pp.then( node.setStateSet.bind( node ) );
    }

    <span class="hljs-keyword">var</span> queue = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>For each url, create a function call and add it to the queue</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ( jsonObj.Children ) {
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, k = jsonObj.Children.length; i &lt; k; i++ ) {
            queue.push( input.setJSON( jsonObj.Children[ i ] ).readObject() );
        }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Resolve first updateCallbacks and stateset.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">return</span> P.all( promiseArray ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Need to wait until the stateset and the all the callbacks are resolved</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> P.all( queue ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> queueNodes </span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>All the results from P.all are on the argument as an array
Now insert children in the right order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> len = queueNodes.length;
            <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; len; i++ )
                node.addChild( queueNodes[ i ] );
            <span class="hljs-keyword">return</span> node;
        } );
    } );
};

osgWrapper.StateSet = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> input, stateSet </span>) </span>{
    <span class="hljs-keyword">var</span> jsonObj = input.getJSON();

    osgWrapper.Object( input, stateSet );

    <span class="hljs-keyword">if</span> ( jsonObj.RenderingHint !== <span class="hljs-literal">undefined</span> ) {
        stateSet.setRenderingHint( jsonObj.RenderingHint );
    }

    <span class="hljs-keyword">var</span> createAttribute = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> jsonAttribute </span>) </span>{
        <span class="hljs-keyword">var</span> promise = input.setJSON( jsonAttribute ).readObject();
        <span class="hljs-keyword">if</span> ( promise.isRejected() ) <span class="hljs-comment">// sometimes we have some empty objects</span>
            <span class="hljs-keyword">return</span>;
        promiseArray.push( promise );
        promise.then( stateSet.setAttributeAndModes.bind( stateSet ) );
    };

    <span class="hljs-keyword">var</span> promiseArray = [];

    <span class="hljs-keyword">if</span> ( jsonObj.AttributeList !== <span class="hljs-literal">undefined</span> ) {
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, l = jsonObj.AttributeList.length; i &lt; l; i++ ) {
            createAttribute( jsonObj.AttributeList[ i ] );
        }
    }

    <span class="hljs-keyword">var</span> createTextureAttribute = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> unit, textureAttribute </span>) </span>{
        <span class="hljs-keyword">var</span> promise = input.setJSON( textureAttribute ).readObject();
        <span class="hljs-keyword">if</span> ( promise.isRejected() ) <span class="hljs-comment">// sometimes we have some empty objects</span>
            <span class="hljs-keyword">return</span>;
        promiseArray.push( promise );
        promise.then( stateSet.setTextureAttributeAndModes.bind( stateSet, unit ) );
    };

    <span class="hljs-keyword">if</span> ( jsonObj.TextureAttributeList ) {
        <span class="hljs-keyword">var</span> textures = jsonObj.TextureAttributeList;
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> t = <span class="hljs-number">0</span>, lt = textures.length; t &lt; lt; t++ ) {
            <span class="hljs-keyword">var</span> textureAttributes = textures[ t ];
            <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> a = <span class="hljs-number">0</span>, al = textureAttributes.length; a &lt; al; a++ ) {
                createTextureAttribute( t, textureAttributes[ a ] );
            }
        }
    }

    <span class="hljs-keyword">return</span> P.all( promiseArray ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> stateSet;
    } );
};

osgWrapper.Material = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> input, material </span>) </span>{
    <span class="hljs-keyword">var</span> jsonObj = input.getJSON();
    <span class="hljs-keyword">if</span> ( !jsonObj.Diffuse || !jsonObj.Emission || !jsonObj.Specular || jsonObj.Shininess === <span class="hljs-literal">undefined</span> )
        <span class="hljs-keyword">return</span> P.reject();

    osgWrapper.Object( input, material );

    material.setAmbient( jsonObj.Ambient );
    material.setDiffuse( jsonObj.Diffuse );
    material.setEmission( jsonObj.Emission );
    material.setSpecular( jsonObj.Specular );
    material.setShininess( jsonObj.Shininess );
    <span class="hljs-keyword">return</span> P.resolve( material );
};

osgWrapper.BlendFunc = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> input, blend </span>) </span>{
    <span class="hljs-keyword">var</span> jsonObj = input.getJSON();
    <span class="hljs-keyword">if</span> ( !jsonObj.SourceRGB || !jsonObj.SourceAlpha || !jsonObj.DestinationRGB || !jsonObj.DestinationAlpha )
        <span class="hljs-keyword">return</span> P.reject();

    osgWrapper.Object( input, blend );

    blend.setSourceRGB( jsonObj.SourceRGB );
    blend.setSourceAlpha( jsonObj.SourceAlpha );
    blend.setDestinationRGB( jsonObj.DestinationRGB );
    blend.setDestinationAlpha( jsonObj.DestinationAlpha );
    <span class="hljs-keyword">return</span> P.resolve( blend );
};

osgWrapper.CullFace = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> input, attr </span>) </span>{
    <span class="hljs-keyword">var</span> jsonObj = input.getJSON();
    <span class="hljs-keyword">if</span> ( jsonObj.Mode === <span class="hljs-literal">undefined</span> )
        <span class="hljs-keyword">return</span> P.reject();

    osgWrapper.Object( input, attr );
    attr.setMode( jsonObj.Mode );
    <span class="hljs-keyword">return</span> P.resolve( attr );
};

osgWrapper.BlendColor = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> input, attr </span>) </span>{
    <span class="hljs-keyword">var</span> jsonObj = input.getJSON();
    <span class="hljs-keyword">if</span> ( !jsonObj.ConstantColor )
        <span class="hljs-keyword">return</span> P.reject();

    osgWrapper.Object( input, attr );
    attr.setConstantColor( jsonObj.ConstantColor );
    <span class="hljs-keyword">return</span> P.resolve( attr );
};

osgWrapper.Light = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> input, light </span>) </span>{
    <span class="hljs-keyword">var</span> jsonObj = input.getJSON();

    <span class="hljs-keyword">if</span> ( !jsonObj.Ambient ||
        !jsonObj.Diffuse ||
        !jsonObj.Direction ||
        !jsonObj.Position ||
        !jsonObj.Specular ||
        jsonObj.LightNum === <span class="hljs-literal">undefined</span> ||
        jsonObj.SpotCutoff === <span class="hljs-literal">undefined</span> ||
        jsonObj.LinearAttenuation === <span class="hljs-literal">undefined</span> ||
        jsonObj.ConstantAttenuation === <span class="hljs-literal">undefined</span> ||
        jsonObj.QuadraticAttenuation === <span class="hljs-literal">undefined</span> )
        <span class="hljs-keyword">return</span> P.reject();

    osgWrapper.Object( input, light );
    light.setAmbient( jsonObj.Ambient );
    light.setConstantAttenuation( jsonObj.ConstantAttenuation );
    light.setDiffuse( jsonObj.Diffuse );
    light.setDirection( jsonObj.Direction );
    light.setLightNumber( jsonObj.LightNum );
    light.setLinearAttenuation( jsonObj.LinearAttenuation );
    light.setPosition( jsonObj.Position );
    light.setQuadraticAttenuation( jsonObj.QuadraticAttenuation );
    light.setSpecular( jsonObj.Specular );
    light.setSpotCutoff( jsonObj.SpotCutoff );
    light.setSpotBlend( <span class="hljs-number">0.01</span> );
    <span class="hljs-keyword">if</span> ( jsonObj.SpotExponent !== <span class="hljs-literal">undefined</span> ) {
        light.setSpotBlend( jsonObj.SpotExponent / <span class="hljs-number">128.0</span> );
    }
    <span class="hljs-keyword">return</span> P.resolve( light );
};

osgWrapper.Texture = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> input, texture </span>) </span>{
    <span class="hljs-keyword">var</span> jsonObj = input.getJSON();

    osgWrapper.Object( input, texture );

    <span class="hljs-keyword">if</span> ( jsonObj.MinFilter ) texture.setMinFilter( jsonObj.MinFilter );
    <span class="hljs-keyword">if</span> ( jsonObj.MagFilter ) texture.setMagFilter( jsonObj.MagFilter );
    <span class="hljs-keyword">if</span> ( jsonObj.WrapT ) texture.setWrapT( jsonObj.WrapT );
    <span class="hljs-keyword">if</span> ( jsonObj.WrapS ) texture.setWrapS( jsonObj.WrapS );</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>no file return dummy texture</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> file = jsonObj.File;
    <span class="hljs-keyword">if</span> ( file === <span class="hljs-literal">undefined</span> ) {
        file = <span class="hljs-string">'no-image-provided'</span>;
    }

    <span class="hljs-keyword">return</span> input.readImageURL( file ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> img </span>) </span>{
        texture.setImage( img );
        <span class="hljs-keyword">return</span> texture;
    } );
};

osgWrapper.Projection = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> input, node </span>) </span>{
    <span class="hljs-keyword">var</span> jsonObj = input.getJSON();
    <span class="hljs-keyword">if</span> ( !jsonObj.Matrix )
        <span class="hljs-keyword">return</span> P.reject();

    <span class="hljs-keyword">var</span> promise = osgWrapper.Node( input, node );
    node.setMatrix( jsonObj.Matrix );
    <span class="hljs-keyword">return</span> promise;
};

osgWrapper.MatrixTransform = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> input, node </span>) </span>{
    <span class="hljs-keyword">var</span> jsonObj = input.getJSON();
    <span class="hljs-keyword">if</span> ( !jsonObj.Matrix )
        <span class="hljs-keyword">return</span> P.reject();

    <span class="hljs-keyword">var</span> promise = osgWrapper.Node( input, node );
    node.setMatrix( jsonObj.Matrix );
    <span class="hljs-keyword">return</span> promise;
};

osgWrapper.LightSource = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> input, node </span>) </span>{
    <span class="hljs-keyword">var</span> jsonObj = input.getJSON();
    <span class="hljs-keyword">if</span> ( !jsonObj.Light )
        <span class="hljs-keyword">return</span> P.reject();

    <span class="hljs-keyword">var</span> promise = osgWrapper.Node( input, node );
    <span class="hljs-keyword">return</span> P.all( [ input.setJSON( jsonObj.Light ).readObject(), promise ] ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> args </span>) </span>{
        <span class="hljs-keyword">var</span> light = args[ <span class="hljs-number">0</span> ];</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>var lightsource = args[ 1 ];</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        node.setLight( light );
        <span class="hljs-keyword">return</span> node;
    } );
};

osgWrapper.Geometry = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> input, node </span>) </span>{
    <span class="hljs-keyword">var</span> jsonObj = input.getJSON();
    <span class="hljs-keyword">if</span> ( !jsonObj.VertexAttributeList )
        <span class="hljs-keyword">return</span> P.reject();

    jsonObj.PrimitiveSetList = jsonObj.PrimitiveSetList || [];

    <span class="hljs-keyword">var</span> arraysPromise = [];
    arraysPromise.push( osgWrapper.Node( input, node ) );

    <span class="hljs-keyword">var</span> prims = node.getPrimitives();
    <span class="hljs-keyword">var</span> cbAddPrimitives = prims.push.bind( prims );
    <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">var</span> l = jsonObj.PrimitiveSetList.length;
    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; l; i++ ) {
        <span class="hljs-keyword">var</span> promisePrimitive = input.setJSON( jsonObj.PrimitiveSetList[ i ] ).readPrimitiveSet();
        arraysPromise.push( promisePrimitive );
        promisePrimitive.then( cbAddPrimitives );
    }

    <span class="hljs-keyword">var</span> cbSetBuffer = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> name, buffer </span>) </span>{
        <span class="hljs-keyword">this</span>.getVertexAttributeList()[ name ] = buffer;
    };

    <span class="hljs-keyword">var</span> vList = jsonObj.VertexAttributeList;
    <span class="hljs-keyword">var</span> keys = <span class="hljs-built_in">window</span>.Object.keys( vList );
    l = keys.length;
    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; l; i++ ) {
        <span class="hljs-keyword">var</span> name = keys[ i ];
        <span class="hljs-keyword">var</span> promiseBuffer = input.setJSON( vList[ name ] ).readBufferArray();
        arraysPromise.push( promiseBuffer );
        promiseBuffer.then( cbSetBuffer.bind( node, name ) );
    }

    <span class="hljs-keyword">return</span> P.all( arraysPromise ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> node;
    } );
};

osgWrapper.PagedLOD = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> input, plod </span>) </span>{
    <span class="hljs-keyword">var</span> jsonObj = input.getJSON();

    osgWrapper.Object( input, plod );</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Parse center Mode</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ( jsonObj.CenterMode === <span class="hljs-string">'USE_BOUNDING_SPHERE_CENTER'</span> )
        plod.setCenterMode( <span class="hljs-number">0</span> );
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( jsonObj.CenterMode === <span class="hljs-string">'UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED'</span> )
        plod.setCenterMode( <span class="hljs-number">2</span> );</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Parse center and radius</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    plod.setCenter( [ jsonObj.UserCenter[ <span class="hljs-number">0</span> ], jsonObj.UserCenter[ <span class="hljs-number">1</span> ], jsonObj.UserCenter[ <span class="hljs-number">2</span> ] ] );
    plod.setRadius( jsonObj.UserCenter[ <span class="hljs-number">3</span> ] );</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Parse RangeMode</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ( jsonObj.RangeMode === <span class="hljs-string">'PIXEL_SIZE_ON_SCREEN'</span> )
        plod.setRangeMode( <span class="hljs-number">1</span> );

    <span class="hljs-keyword">var</span> str;</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Parse Ranges</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> o = jsonObj.RangeList;

    <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">window</span>.Object.keys( o ).length; i++ ) {
        str = <span class="hljs-string">'Range '</span> + i;
        <span class="hljs-keyword">var</span> v = o[ str ];
        plod.setRange( i, v[ <span class="hljs-number">0</span> ], v[ <span class="hljs-number">1</span> ] );
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Parse Files</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    o = jsonObj.RangeDataList;
    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">window</span>.Object.keys( o ).length; i++ ) {
        str = <span class="hljs-string">'File '</span> + i;
        plod.setFileName( i, o[ str ] );
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Set database path from options
TODO: Check also if we have a path from json</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    plod.setDatabasePath( input.getDatabasePath() );

    <span class="hljs-keyword">var</span> queue = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>For each url, create a function call and add it to the queue</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ( jsonObj.Children ) {
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>, k = jsonObj.Children.length; j &lt; k; j++ ) {
            queue.push( input.setJSON( jsonObj.Children[ j ] ).readObject() );
        }
    }

    <span class="hljs-keyword">return</span> P.all( queue ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> queueNodes </span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>All the results from P.all are on the argument as an array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> len = queueNodes.length;
        <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; len; i++ )
            plod.addChildNode( queueNodes[ i ] );
        <span class="hljs-keyword">return</span> plod;
    } );
};
<span class="hljs-built_in">module</span>.exports = osgWrapper;</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
