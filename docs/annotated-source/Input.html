<!DOCTYPE html>

<html>
<head>
  <title>Input.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="OSG.html">
                OSG.js
              </a>
            
              
              <a class="source" href="BillboardAttribute.html">
                BillboardAttribute.js
              </a>
            
              
              <a class="source" href="BlendColor.html">
                BlendColor.js
              </a>
            
              
              <a class="source" href="BlendFunc.html">
                BlendFunc.js
              </a>
            
              
              <a class="source" href="BoundingBox.html">
                BoundingBox.js
              </a>
            
              
              <a class="source" href="BoundingSphere.html">
                BoundingSphere.js
              </a>
            
              
              <a class="source" href="BufferArray.html">
                BufferArray.js
              </a>
            
              
              <a class="source" href="BufferArrayProxy.html">
                BufferArrayProxy.js
              </a>
            
              
              <a class="source" href="Camera.html">
                Camera.js
              </a>
            
              
              <a class="source" href="ColorMask.html">
                ColorMask.js
              </a>
            
              
              <a class="source" href="ComputeBoundsVisitor.html">
                ComputeBoundsVisitor.js
              </a>
            
              
              <a class="source" href="ComputeMatrixFromNodePath.html">
                ComputeMatrixFromNodePath.js
              </a>
            
              
              <a class="source" href="CullFace.html">
                CullFace.js
              </a>
            
              
              <a class="source" href="CullSettings.html">
                CullSettings.js
              </a>
            
              
              <a class="source" href="CullStack.html">
                CullStack.js
              </a>
            
              
              <a class="source" href="CullVisitor.html">
                CullVisitor.js
              </a>
            
              
              <a class="source" href="CullingSet.html">
                CullingSet.js
              </a>
            
              
              <a class="source" href="Depth.html">
                Depth.js
              </a>
            
              
              <a class="source" href="DrawArrayLengths.html">
                DrawArrayLengths.js
              </a>
            
              
              <a class="source" href="DrawArrays.html">
                DrawArrays.js
              </a>
            
              
              <a class="source" href="DrawElements.html">
                DrawElements.js
              </a>
            
              
              <a class="source" href="EllipsoidModel.html">
                EllipsoidModel.js
              </a>
            
              
              <a class="source" href="FrameBufferObject.html">
                FrameBufferObject.js
              </a>
            
              
              <a class="source" href="FrameStamp.html">
                FrameStamp.js
              </a>
            
              
              <a class="source" href="GLObject.html">
                GLObject.js
              </a>
            
              
              <a class="source" href="Geometry.html">
                Geometry.js
              </a>
            
              
              <a class="source" href="Image.html">
                Image.js
              </a>
            
              
              <a class="source" href="ImageStream.html">
                ImageStream.js
              </a>
            
              
              <a class="source" href="KdTree.html">
                KdTree.js
              </a>
            
              
              <a class="source" href="KdTreeBuilder.html">
                KdTreeBuilder.js
              </a>
            
              
              <a class="source" href="KdTreeRayIntersector.html">
                KdTreeRayIntersector.js
              </a>
            
              
              <a class="source" href="KdTreeSphereIntersector.html">
                KdTreeSphereIntersector.js
              </a>
            
              
              <a class="source" href="Light.html">
                Light.js
              </a>
            
              
              <a class="source" href="LightSource.html">
                LightSource.js
              </a>
            
              
              <a class="source" href="LineWidth.html">
                LineWidth.js
              </a>
            
              
              <a class="source" href="Lod.html">
                Lod.js
              </a>
            
              
              <a class="source" href="Map.html">
                Map.js
              </a>
            
              
              <a class="source" href="Material.html">
                Material.js
              </a>
            
              
              <a class="source" href="Math.html">
                Math.js
              </a>
            
              
              <a class="source" href="Matrix.html">
                Matrix.js
              </a>
            
              
              <a class="source" href="MatrixMemoryPool.html">
                MatrixMemoryPool.js
              </a>
            
              
              <a class="source" href="MatrixTransform.html">
                MatrixTransform.js
              </a>
            
              
              <a class="source" href="Node.html">
                Node.js
              </a>
            
              
              <a class="source" href="NodeVisitor.html">
                NodeVisitor.js
              </a>
            
              
              <a class="source" href="Notify.html">
                Notify.js
              </a>
            
              
              <a class="source" href="Object.html">
                Object.js
              </a>
            
              
              <a class="source" href="Options.html">
                Options.js
              </a>
            
              
              <a class="source" href="PagedLOD.html">
                PagedLOD.js
              </a>
            
              
              <a class="source" href="Plane.html">
                Plane.js
              </a>
            
              
              <a class="source" href="Polytope.html">
                Polytope.js
              </a>
            
              
              <a class="source" href="PrimitiveFunctor.html">
                PrimitiveFunctor.js
              </a>
            
              
              <a class="source" href="PrimitiveSet.html">
                PrimitiveSet.js
              </a>
            
              
              <a class="source" href="Program.html">
                Program.js
              </a>
            
              
              <a class="source" href="Projection.html">
                Projection.js
              </a>
            
              
              <a class="source" href="Quat.html">
                Quat.js
              </a>
            
              
              <a class="source" href="RenderBin.html">
                RenderBin.js
              </a>
            
              
              <a class="source" href="RenderLeaf.html">
                RenderLeaf.js
              </a>
            
              
              <a class="source" href="RenderStage.html">
                RenderStage.js
              </a>
            
              
              <a class="source" href="Shader.html">
                Shader.js
              </a>
            
              
              <a class="source" href="Shape.html">
                Shape.js
              </a>
            
              
              <a class="source" href="Stack.html">
                Stack.js
              </a>
            
              
              <a class="source" href="State.html">
                State.js
              </a>
            
              
              <a class="source" href="StateAttribute.html">
                StateAttribute.js
              </a>
            
              
              <a class="source" href="StateGraph.html">
                StateGraph.js
              </a>
            
              
              <a class="source" href="StateSet.html">
                StateSet.js
              </a>
            
              
              <a class="source" href="Texture.html">
                Texture.js
              </a>
            
              
              <a class="source" href="TextureCubeMap.html">
                TextureCubeMap.js
              </a>
            
              
              <a class="source" href="TextureManager.html">
                TextureManager.js
              </a>
            
              
              <a class="source" href="Timer.html">
                Timer.js
              </a>
            
              
              <a class="source" href="Transform.html">
                Transform.js
              </a>
            
              
              <a class="source" href="TransformEnums.html">
                TransformEnums.js
              </a>
            
              
              <a class="source" href="TriangleIndexFunctor.html">
                TriangleIndexFunctor.js
              </a>
            
              
              <a class="source" href="Uniform.html">
                Uniform.js
              </a>
            
              
              <a class="source" href="UpdateVisitor.html">
                UpdateVisitor.js
              </a>
            
              
              <a class="source" href="Utils.html">
                Utils.js
              </a>
            
              
              <a class="source" href="Vec2.html">
                Vec2.js
              </a>
            
              
              <a class="source" href="Vec3.html">
                Vec3.js
              </a>
            
              
              <a class="source" href="Vec4.html">
                Vec4.js
              </a>
            
              
              <a class="source" href="Viewport.html">
                Viewport.js
              </a>
            
              
              <a class="source" href="WebGLCaps.html">
                WebGLCaps.js
              </a>
            
              
              <a class="source" href="osg.html">
                osg.js
              </a>
            
              
              <a class="source" href="Animation.html">
                Animation.js
              </a>
            
              
              <a class="source" href="AnimationUpdateCallback.html">
                AnimationUpdateCallback.js
              </a>
            
              
              <a class="source" href="BasicAnimationManager.html">
                BasicAnimationManager.js
              </a>
            
              
              <a class="source" href="Bone.html">
                Bone.js
              </a>
            
              
              <a class="source" href="Channel.html">
                Channel.js
              </a>
            
              
              <a class="source" href="CollectAnimationUpdateCallbackVisitor.html">
                CollectAnimationUpdateCallbackVisitor.js
              </a>
            
              
              <a class="source" href="CollectBoneVisitor.html">
                CollectBoneVisitor.js
              </a>
            
              
              <a class="source" href="Easing.html">
                Easing.js
              </a>
            
              
              <a class="source" href="FindNearestParentSkeleton.html">
                FindNearestParentSkeleton.js
              </a>
            
              
              <a class="source" href="Interpolator.html">
                Interpolator.js
              </a>
            
              
              <a class="source" href="MorphAttribute.html">
                MorphAttribute.js
              </a>
            
              
              <a class="source" href="MorphGeometry.html">
                MorphGeometry.js
              </a>
            
              
              <a class="source" href="RigGeometry.html">
                RigGeometry.js
              </a>
            
              
              <a class="source" href="RigTransformHardware.html">
                RigTransformHardware.js
              </a>
            
              
              <a class="source" href="Skeleton.html">
                Skeleton.js
              </a>
            
              
              <a class="source" href="SkinningAttribute.html">
                SkinningAttribute.js
              </a>
            
              
              <a class="source" href="StackedMatrix.html">
                StackedMatrix.js
              </a>
            
              
              <a class="source" href="StackedQuaternion.html">
                StackedQuaternion.js
              </a>
            
              
              <a class="source" href="StackedRotateAxis.html">
                StackedRotateAxis.js
              </a>
            
              
              <a class="source" href="StackedScale.html">
                StackedScale.js
              </a>
            
              
              <a class="source" href="StackedTranslate.html">
                StackedTranslate.js
              </a>
            
              
              <a class="source" href="Target.html">
                Target.js
              </a>
            
              
              <a class="source" href="UpdateBone.html">
                UpdateBone.js
              </a>
            
              
              <a class="source" href="UpdateMatrixTransform.html">
                UpdateMatrixTransform.js
              </a>
            
              
              <a class="source" href="UpdateMorph.html">
                UpdateMorph.js
              </a>
            
              
              <a class="source" href="UpdateRigGeometry.html">
                UpdateRigGeometry.js
              </a>
            
              
              <a class="source" href="UpdateSkeleton.html">
                UpdateSkeleton.js
              </a>
            
              
              <a class="source" href="channelType.html">
                channelType.js
              </a>
            
              
              <a class="source" href="osgAnimation.html">
                osgAnimation.js
              </a>
            
              
              <a class="source" href="DatabasePager.html">
                DatabasePager.js
              </a>
            
              
              <a class="source" href="Input.html">
                Input.js
              </a>
            
              
              <a class="source" href="Options.html">
                Options.js
              </a>
            
              
              <a class="source" href="ReaderParser.html">
                ReaderParser.js
              </a>
            
              
              <a class="source" href="osgDB.html">
                osgDB.js
              </a>
            
              
              <a class="source" href="FirstPersonManipulator.html">
                FirstPersonManipulator.js
              </a>
            
              
              <a class="source" href="FirstPersonManipulatorDeviceOrientationController.html">
                FirstPersonManipulatorDeviceOrientationController.js
              </a>
            
              
              <a class="source" href="FirstPersonManipulatorHammerController.html">
                FirstPersonManipulatorHammerController.js
              </a>
            
              
              <a class="source" href="FirstPersonManipulatorStandardMouseKeyboardController.html">
                FirstPersonManipulatorStandardMouseKeyboardController.js
              </a>
            
              
              <a class="source" href="FirstPersonManipulatorWebVRController.html">
                FirstPersonManipulatorWebVRController.js
              </a>
            
              
              <a class="source" href="Manipulator.html">
                Manipulator.js
              </a>
            
              
              <a class="source" href="OrbitManipulator.html">
                OrbitManipulator.js
              </a>
            
              
              <a class="source" href="OrbitManipulatorDeviceOrientationController.html">
                OrbitManipulatorDeviceOrientationController.js
              </a>
            
              
              <a class="source" href="OrbitManipulatorEnums.html">
                OrbitManipulatorEnums.js
              </a>
            
              
              <a class="source" href="OrbitManipulatorGamePadController.html">
                OrbitManipulatorGamePadController.js
              </a>
            
              
              <a class="source" href="OrbitManipulatorHammerController.html">
                OrbitManipulatorHammerController.js
              </a>
            
              
              <a class="source" href="OrbitManipulatorLeapMotionController.html">
                OrbitManipulatorLeapMotionController.js
              </a>
            
              
              <a class="source" href="OrbitManipulatorStandardMouseKeyboardController.html">
                OrbitManipulatorStandardMouseKeyboardController.js
              </a>
            
              
              <a class="source" href="OrbitManipulatorWebVRController.html">
                OrbitManipulatorWebVRController.js
              </a>
            
              
              <a class="source" href="SwitchManipulator.html">
                SwitchManipulator.js
              </a>
            
              
              <a class="source" href="osgGA.html">
                osgGA.js
              </a>
            
              
              <a class="source" href="osgNameSpace.html">
                osgNameSpace.js
              </a>
            
              
              <a class="source" href="Compiler.html">
                Compiler.js
              </a>
            
              
              <a class="source" href="ShaderGenerator.html">
                ShaderGenerator.js
              </a>
            
              
              <a class="source" href="ShaderGeneratorProxy.html">
                ShaderGeneratorProxy.js
              </a>
            
              
              <a class="source" href="ShaderProcessor.html">
                ShaderProcessor.js
              </a>
            
              
              <a class="source" href="node.html">
                node.js
              </a>
            
              
              <a class="source" href="Node.html">
                Node.js
              </a>
            
              
              <a class="source" href="data.html">
                data.js
              </a>
            
              
              <a class="source" href="functions.html">
                functions.js
              </a>
            
              
              <a class="source" href="lights.html">
                lights.js
              </a>
            
              
              <a class="source" href="morph.html">
                morph.js
              </a>
            
              
              <a class="source" href="operations.html">
                operations.js
              </a>
            
              
              <a class="source" href="shadows.html">
                shadows.js
              </a>
            
              
              <a class="source" href="skinning.html">
                skinning.js
              </a>
            
              
              <a class="source" href="textures.html">
                textures.js
              </a>
            
              
              <a class="source" href="nodeFactory.html">
                nodeFactory.js
              </a>
            
              
              <a class="source" href="osgShader.html">
                osgShader.js
              </a>
            
              
              <a class="source" href="shaderLib.html">
                shaderLib.js
              </a>
            
              
              <a class="source" href="utils.html">
                utils.js
              </a>
            
              
              <a class="source" href="ShadowCastAttribute.html">
                ShadowCastAttribute.js
              </a>
            
              
              <a class="source" href="ShadowCastCompiler.html">
                ShadowCastCompiler.js
              </a>
            
              
              <a class="source" href="ShadowCastShaderGenerator.html">
                ShadowCastShaderGenerator.js
              </a>
            
              
              <a class="source" href="ShadowCasterVisitor.html">
                ShadowCasterVisitor.js
              </a>
            
              
              <a class="source" href="ShadowFrustumIntersection.html">
                ShadowFrustumIntersection.js
              </a>
            
              
              <a class="source" href="ShadowMap.html">
                ShadowMap.js
              </a>
            
              
              <a class="source" href="ShadowReceiveAttribute.html">
                ShadowReceiveAttribute.js
              </a>
            
              
              <a class="source" href="ShadowSettings.html">
                ShadowSettings.js
              </a>
            
              
              <a class="source" href="ShadowTechnique.html">
                ShadowTechnique.js
              </a>
            
              
              <a class="source" href="ShadowTexture.html">
                ShadowTexture.js
              </a>
            
              
              <a class="source" href="ShadowedScene.html">
                ShadowedScene.js
              </a>
            
              
              <a class="source" href="osgShadow.html">
                osgShadow.js
              </a>
            
              
              <a class="source" href="shaderLib.html">
                shaderLib.js
              </a>
            
              
              <a class="source" href="Text.html">
                Text.js
              </a>
            
              
              <a class="source" href="osgText.html">
                osgText.js
              </a>
            
              
              <a class="source" href="Composer.html">
                Composer.js
              </a>
            
              
              <a class="source" href="DisplayGeometryVisitor.html">
                DisplayGeometryVisitor.js
              </a>
            
              
              <a class="source" href="DisplayGraph.html">
                DisplayGraph.js
              </a>
            
              
              <a class="source" href="DisplayGraphNode.html">
                DisplayGraphNode.js
              </a>
            
              
              <a class="source" href="DisplayGraphRenderer.html">
                DisplayGraphRenderer.js
              </a>
            
              
              <a class="source" href="DisplayNormalVisitor.html">
                DisplayNormalVisitor.js
              </a>
            
              
              <a class="source" href="GizmoGeometry.html">
                GizmoGeometry.js
              </a>
            
              
              <a class="source" href="IntersectionVisitor.html">
                IntersectionVisitor.js
              </a>
            
              
              <a class="source" href="LineSegmentIntersector.html">
                LineSegmentIntersector.js
              </a>
            
              
              <a class="source" href="NodeGizmo.html">
                NodeGizmo.js
              </a>
            
              
              <a class="source" href="ParameterVisitor.html">
                ParameterVisitor.js
              </a>
            
              
              <a class="source" href="PolytopeIntersector.html">
                PolytopeIntersector.js
              </a>
            
              
              <a class="source" href="PolytopePrimitiveIntersector.html">
                PolytopePrimitiveIntersector.js
              </a>
            
              
              <a class="source" href="SphereIntersector.html">
                SphereIntersector.js
              </a>
            
              
              <a class="source" href="TangentSpaceGenerator.html">
                TangentSpaceGenerator.js
              </a>
            
              
              <a class="source" href="TriangleIntersector.html">
                TriangleIntersector.js
              </a>
            
              
              <a class="source" href="TriangleSphereIntersector.html">
                TriangleSphereIntersector.js
              </a>
            
              
              <a class="source" href="WebVR.html">
                WebVR.js
              </a>
            
              
              <a class="source" href="WebVRCustom.html">
                WebVRCustom.js
              </a>
            
              
              <a class="source" href="osgPool.html">
                osgPool.js
              </a>
            
              
              <a class="source" href="osgUtil.html">
                osgUtil.js
              </a>
            
              
              <a class="source" href="Renderer.html">
                Renderer.js
              </a>
            
              
              <a class="source" href="Scene.html">
                Scene.js
              </a>
            
              
              <a class="source" href="View.html">
                View.js
              </a>
            
              
              <a class="source" href="Viewer.html">
                Viewer.js
              </a>
            
              
              <a class="source" href="createStats.html">
                createStats.js
              </a>
            
              
              <a class="source" href="DeviceOrientation.html">
                DeviceOrientation.js
              </a>
            
              
              <a class="source" href="EventProxy.html">
                EventProxy.js
              </a>
            
              
              <a class="source" href="GamePad.html">
                GamePad.js
              </a>
            
              
              <a class="source" href="Hammer.html">
                Hammer.js
              </a>
            
              
              <a class="source" href="LeapMotion.html">
                LeapMotion.js
              </a>
            
              
              <a class="source" href="StandardMouseKeyboard.html">
                StandardMouseKeyboard.js
              </a>
            
              
              <a class="source" href="WebVR.html">
                WebVR.js
              </a>
            
              
              <a class="source" href="osgViewer.html">
                osgViewer.js
              </a>
            
              
              <a class="source" href="webgl-debug.html">
                webgl-debug.js
              </a>
            
              
              <a class="source" href="webgl-utils.html">
                webgl-utils.js
              </a>
            
              
              <a class="source" href="osgWrappers.html">
                osgWrappers.js
              </a>
            
              
              <a class="source" href="osg.html">
                osg.js
              </a>
            
              
              <a class="source" href="osgAnimation.html">
                osgAnimation.js
              </a>
            
              
              <a class="source" href="osgText.html">
                osgText.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>Input.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-meta">'use strict'</span>;
<span class="hljs-keyword">var</span> P = <span class="hljs-built_in">require</span>( <span class="hljs-string">'bluebird'</span> );
<span class="hljs-keyword">var</span> MACROUTILS = <span class="hljs-built_in">require</span>( <span class="hljs-string">'osg/Utils'</span> );
<span class="hljs-keyword">var</span> osgNameSpace = <span class="hljs-built_in">require</span>( <span class="hljs-string">'osgNameSpace'</span> );
<span class="hljs-keyword">var</span> Options = <span class="hljs-built_in">require</span>( <span class="hljs-string">'osgDB/Options'</span> );
<span class="hljs-keyword">var</span> Notify = <span class="hljs-built_in">require</span>( <span class="hljs-string">'osg/Notify'</span> );
<span class="hljs-keyword">var</span> Image = <span class="hljs-built_in">require</span>( <span class="hljs-string">'osg/Image'</span> );
<span class="hljs-keyword">var</span> BufferArray = <span class="hljs-built_in">require</span>( <span class="hljs-string">'osg/BufferArray'</span> );
<span class="hljs-keyword">var</span> DrawArrays = <span class="hljs-built_in">require</span>( <span class="hljs-string">'osg/DrawArrays'</span> );
<span class="hljs-keyword">var</span> DrawArrayLengths = <span class="hljs-built_in">require</span>( <span class="hljs-string">'osg/DrawArrayLengths'</span> );
<span class="hljs-keyword">var</span> DrawElements = <span class="hljs-built_in">require</span>( <span class="hljs-string">'osg/DrawElements'</span> );
<span class="hljs-keyword">var</span> PrimitiveSet = <span class="hljs-built_in">require</span>( <span class="hljs-string">'osg/PrimitiveSet'</span> );


<span class="hljs-keyword">var</span> Input = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> json, identifier </span>) </span>{
    <span class="hljs-keyword">this</span>._json = json;
    <span class="hljs-keyword">var</span> map = identifier;
    <span class="hljs-keyword">if</span> ( map === <span class="hljs-literal">undefined</span> ) {
        map = {};
    }
    <span class="hljs-keyword">this</span>._identifierMap = map;
    <span class="hljs-keyword">this</span>._objectRegistry = {};

    <span class="hljs-keyword">this</span>._cacheReadObject = {}; <span class="hljs-comment">//wrappers</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>this._progressXHRCallback = undefined;
this._prefixURL = ‘’;
this.setImageLoadingOptions( {
    promise: true,
    onload: undefined
} );</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
    <span class="hljs-keyword">this</span>.setOptions( MACROUTILS.objectMix( {}, Options ) );</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>{
    prefixURL: ‘’,
    progressXHRCallback: undefined,
    readImageURL: undefined,
    imageLoadingUsePromise: undefined,
    imageOnload: undefined,
};</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>};</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>keep one instance of image fallback</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">if</span> ( !Input.imageFallback ) {
    Input.imageFallback = ( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> fallback = <span class="hljs-keyword">new</span> <span class="hljs-built_in">window</span>.Image();
        fallback.src = <span class="hljs-string">'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2P8DwQACgAD/il4QJ8AAAAASUVORK5CYII='</span>;
        <span class="hljs-keyword">return</span> fallback;
    } )();
}

Input.prototype = {

    clone: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> input = <span class="hljs-keyword">new</span> Input();
        input._objectRegistry = <span class="hljs-keyword">this</span>._objectRegistry;
        input._cacheReadObject = <span class="hljs-keyword">this</span>._cacheReadObject;
        <span class="hljs-keyword">return</span> input;
    },

    setOptions: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> options </span>) </span>{
        <span class="hljs-keyword">this</span>._defaultOptions = options;
    },
    getOptions: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._defaultOptions;
    },
    setProgressXHRCallback: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> func </span>) </span>{
        <span class="hljs-keyword">this</span>._defaultOptions.progressXHRCallback = func;
    },
    setReadNodeURLCallback: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> func </span>) </span>{
        <span class="hljs-keyword">this</span>._defaultOptions.readNodeURL = func;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>used to override the type from pathname
typically if you want to create proxy object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    registerObject: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> fullyQualifiedObjectname, constructor </span>) </span>{
        <span class="hljs-keyword">this</span>._objectRegistry[ fullyQualifiedObjectname ] = <span class="hljs-keyword">constructor</span>;
    },

    getJSON: function () {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._json;
    },

    setJSON: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> json </span>) </span>{
        <span class="hljs-keyword">this</span>._json = json;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    },

    setPrefixURL: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> prefix </span>) </span>{
        <span class="hljs-keyword">this</span>._defaultOptions.prefixURL = prefix;
    },

    getPrefixURL: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._defaultOptions.prefixURL;
    },

    setDatabasePath: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> path </span>) </span>{
        <span class="hljs-keyword">this</span>._defaultOptions.databasePath = path;
    },

    getDatabasePath: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._defaultOptions.databasePath;
    },

    computeURL: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> url </span>) </span>{

        <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span> <span class="hljs-keyword">this</span>._defaultOptions.prefixURL === <span class="hljs-string">'string'</span> &amp;&amp;
            <span class="hljs-keyword">this</span>._defaultOptions.prefixURL.length &gt; <span class="hljs-number">0</span> ) {

            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._defaultOptions.prefixURL + url;
        }

        <span class="hljs-keyword">return</span> url;
    },


    requestFile: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> url, options </span>) </span>{

        <span class="hljs-keyword">var</span> defer = P.defer();

        <span class="hljs-keyword">var</span> req = <span class="hljs-keyword">new</span> XMLHttpRequest();
        req.open( <span class="hljs-string">'GET'</span>, url, <span class="hljs-literal">true</span> );</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>handle responseType</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> ( options &amp;&amp; options.responseType )
            req.responseType = options.responseType;

        <span class="hljs-keyword">if</span> ( options &amp;&amp; options.progress ) {
            req.addEventListener( <span class="hljs-string">'progress'</span>, options.progress, <span class="hljs-literal">false</span> );
        }

        req.addEventListener( <span class="hljs-string">'error'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            defer.reject();
        }, <span class="hljs-literal">false</span> );

        req.addEventListener( <span class="hljs-string">'load'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> <span class="hljs-comment">/*oEvent */</span></span>) </span>{

            <span class="hljs-keyword">if</span> ( req.responseType === <span class="hljs-string">'arraybuffer'</span> )
                defer.resolve( req.response );
            <span class="hljs-keyword">else</span>
                defer.resolve( req.responseText );

        } );

        req.send( <span class="hljs-literal">null</span> );
        <span class="hljs-keyword">return</span> defer.promise;
    },

    getObjectWrapper: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> path </span>) </span>{
        <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>._objectRegistry[ path ] ) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span>( <span class="hljs-keyword">this</span>._objectRegistry[ path ] )();
        }

        <span class="hljs-keyword">var</span> scope = osgNameSpace;
        <span class="hljs-keyword">var</span> splittedPath = path.split( <span class="hljs-string">'.'</span> );
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, l = splittedPath.length; i &lt; l; i++ ) {
            <span class="hljs-keyword">var</span> obj = scope[ splittedPath[ i ] ];
            <span class="hljs-keyword">if</span> ( obj === <span class="hljs-literal">undefined</span> ) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
            }
            scope = obj;
        }
        <span class="hljs-keyword">this</span>._objectRegistry[ path ] = scope;</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>create the new obj</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span>( scope )();
    },

    fetchImage: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> image, url, options, defer </span>) </span>{
        <span class="hljs-keyword">var</span> checkInlineImage = <span class="hljs-string">'data:image/'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>crossOrigin does not work for inline data image</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> isInlineImage = ( url.substring( <span class="hljs-number">0</span>, checkInlineImage.length ) === checkInlineImage );
        <span class="hljs-keyword">var</span> img = <span class="hljs-keyword">new</span> <span class="hljs-built_in">window</span>.Image();
        img.onerror = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            Notify.warn( <span class="hljs-string">'warning use white texture as fallback instead of '</span> + url );
            image.setImage( Input.imageFallback );
            <span class="hljs-keyword">if</span> ( defer ) {
                defer.resolve( image );
            }
        };

        <span class="hljs-keyword">if</span> ( !isInlineImage &amp;&amp; options.imageCrossOrigin ) {
            img.crossOrigin = options.imageCrossOrigin;
        }

        img.onload = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

            <span class="hljs-keyword">if</span> ( defer ) {
                <span class="hljs-keyword">if</span> ( options.imageOnload ) options.imageOnload.call( image );
                defer.resolve( image );
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( options.imageOnload )
                options.imageOnload.call( image );

        };

        image.setURL( url );
        image.setImage( img );

        img.src = url;
        <span class="hljs-keyword">return</span> image;
    },

    readImageURL: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> url, options </span>) </span>{

        <span class="hljs-keyword">if</span> ( options === <span class="hljs-literal">undefined</span> ) {
            options = <span class="hljs-keyword">this</span>._defaultOptions;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>hook reader</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> ( options.readImageURL ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>be carefull if you plan to call hook the call and after
call the original readImageURL, you will need to remove
from options the readImageURL if you dont want an infinte
recursion call</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">return</span> options.readImageURL.call( <span class="hljs-keyword">this</span>, url, options );
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>if image is on inline image skip url computation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> ( url.substr( <span class="hljs-number">0</span>, <span class="hljs-number">10</span> ) !== <span class="hljs-string">'data:image'</span> ) {
            url = <span class="hljs-keyword">this</span>.computeURL( url );
        }


        <span class="hljs-keyword">var</span> image = <span class="hljs-keyword">new</span> Image();
        <span class="hljs-keyword">if</span> ( options.imageLoadingUsePromise !== <span class="hljs-literal">true</span> ) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.fetchImage( image, url, options );
        }

        <span class="hljs-keyword">var</span> defer = P.defer();
        <span class="hljs-keyword">this</span>.fetchImage( image, url, options, defer );

        <span class="hljs-keyword">return</span> defer.promise;
    },


    readNodeURL: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> url, opt </span>) </span>{

        <span class="hljs-keyword">var</span> options = opt;
        <span class="hljs-keyword">if</span> ( options === <span class="hljs-literal">undefined</span> ) {
            options = <span class="hljs-keyword">this</span>._defaultOptions;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>hook reader</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> ( options.readNodeURL ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>be carefull if you plan to call hook the call and after
call the original readNodeURL, you will need to remove
from options the readNodeURL if you dont want an infinte
recursion call</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">return</span> options.readNodeURL.call( <span class="hljs-keyword">this</span>, url, options );
        }

        url = <span class="hljs-keyword">this</span>.computeURL( url );

        <span class="hljs-keyword">var</span> defer = P.defer();</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>copy because we are going to modify it to have relative prefix to load assets</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        options = MACROUTILS.objectMix( {}, options );</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>automatic prefix if non specfied</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> ( !!!options.prefixURL ) {
            <span class="hljs-keyword">var</span> prefix = <span class="hljs-keyword">this</span>.getPrefixURL();
            <span class="hljs-keyword">var</span> index = url.lastIndexOf( <span class="hljs-string">'/'</span> );
            <span class="hljs-keyword">if</span> ( index !== <span class="hljs-number">-1</span> ) {
                prefix = url.substring( <span class="hljs-number">0</span>, index + <span class="hljs-number">1</span> );
            }
            options.prefixURL = prefix;
        }

        <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;

        <span class="hljs-keyword">var</span> ReaderParser = <span class="hljs-built_in">require</span>( <span class="hljs-string">'osgDB/ReaderParser'</span> );

        <span class="hljs-keyword">var</span> readSceneGraph = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> data </span>) </span>{

            ReaderParser.parseSceneGraph( data, options ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> child </span>) </span>{
                defer.resolve( child );
                Notify.log( <span class="hljs-string">'loaded '</span> + url );
            } ).catch( defer.reject.bind( defer ) );
        };

        <span class="hljs-keyword">var</span> ungzipFile = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> file </span>) </span>{

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pad</span>(<span class="hljs-params"> n </span>) </span>{
                <span class="hljs-keyword">return</span> n.length &lt; <span class="hljs-number">2</span> ? <span class="hljs-string">'0'</span> + n : n;
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">uintToString</span>(<span class="hljs-params"> uintArray </span>) </span>{
                <span class="hljs-keyword">var</span> str = <span class="hljs-string">''</span>;
                <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, len = uintArray.length; i &lt; len; ++i ) {
                    str += ( <span class="hljs-string">'%'</span> + pad( uintArray[ i ].toString( <span class="hljs-number">16</span> ) ) );
                }
                str = <span class="hljs-built_in">decodeURIComponent</span>( str );
                <span class="hljs-keyword">return</span> str;
            }


            <span class="hljs-keyword">var</span> unpacked = self._unzipTypedArray( file );

            <span class="hljs-keyword">var</span> typedArray = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>( unpacked );
            <span class="hljs-keyword">var</span> str = uintToString( typedArray );
            <span class="hljs-keyword">return</span> str;
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>try to get the file as responseText to parse JSON</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> fileTextPromise = self.requestFile( url );
        fileTextPromise.then( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> str </span>) </span>{

            <span class="hljs-keyword">var</span> data;
            <span class="hljs-keyword">try</span> {

                data = <span class="hljs-built_in">JSON</span>.parse( str );

            } <span class="hljs-keyword">catch</span> ( error ) { <span class="hljs-comment">// can't parse try with ungzip code path</span>

                Notify.error( <span class="hljs-string">'cant parse url '</span> + url + <span class="hljs-string">' try to gunzip'</span> );

            }</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>we have the json, read it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> ( data )
                <span class="hljs-keyword">return</span> readSceneGraph( data );</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>no data try with gunzip</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> fileGzipPromise = self.requestFile( url, {
                responseType: <span class="hljs-string">'arraybuffer'</span>
            } );
            fileGzipPromise.then( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> file </span>) </span>{

                <span class="hljs-keyword">var</span> str = ungzipFile( file );
                data = <span class="hljs-built_in">JSON</span>.parse( str );
                readSceneGraph( data );

            } ).catch( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> status </span>) </span>{

                Notify.error( <span class="hljs-string">'cant read file '</span> + url + <span class="hljs-string">' status '</span> + status );
                defer.reject();

            } ).done();

            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;

        } ).catch( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> status </span>) </span>{

            Notify.error( <span class="hljs-string">'cant get file '</span> + url + <span class="hljs-string">' status '</span> + status );
            defer.reject();

        } ).done();

        <span class="hljs-keyword">return</span> defer.promise;
    },

    _unzipTypedArray: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> binary </span>) </span>{

        <span class="hljs-keyword">var</span> typedArray = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>( binary );</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>check magic number 1f8b</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> ( typedArray[ <span class="hljs-number">0</span> ] === <span class="hljs-number">0x1f</span> &amp;&amp; typedArray[ <span class="hljs-number">1</span> ] === <span class="hljs-number">0x8b</span> ) {
            <span class="hljs-keyword">var</span> zlib = <span class="hljs-built_in">require</span>( <span class="hljs-string">'zlib'</span> );

            <span class="hljs-keyword">if</span> ( !zlib ) {
                Notify.error( <span class="hljs-string">'osg failed to use a gunzip.min.js to uncompress a gz file.\n You can add this vendors to enable this feature or adds the good header in your gzip file served by your server'</span> );
            }

            <span class="hljs-keyword">var</span> zdec = <span class="hljs-keyword">new</span> zlib.Gunzip( typedArray );
            <span class="hljs-keyword">var</span> result = zdec.decompress();
            <span class="hljs-keyword">return</span> result.buffer;
        }

        <span class="hljs-keyword">return</span> binary;
    },

    readBinaryArrayURL: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> url, options </span>) </span>{

        <span class="hljs-keyword">if</span> ( options === <span class="hljs-literal">undefined</span> ) {
            options = <span class="hljs-keyword">this</span>._defaultOptions;
        }

        <span class="hljs-keyword">if</span> ( options.readBinaryArrayURL ) {
            <span class="hljs-keyword">return</span> options.readBinaryArrayURL.call( <span class="hljs-keyword">this</span>, url, options );
        }

        url = <span class="hljs-keyword">this</span>.computeURL( url );


        <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>._identifierMap[ url ] !== <span class="hljs-literal">undefined</span> ) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._identifierMap[ url ];
        }
        <span class="hljs-keyword">var</span> defer = P.defer();

        <span class="hljs-keyword">var</span> filePromise = <span class="hljs-keyword">this</span>.requestFile( url, {
            responseType: <span class="hljs-string">'arraybuffer'</span>,
            progress: <span class="hljs-keyword">this</span>._defaultOptions.progressXHRCallback
        } );

        <span class="hljs-keyword">this</span>._identifierMap[ url ] = defer.promise;
        filePromise.then( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> file </span>) </span>{
            defer.resolve( <span class="hljs-keyword">this</span>._unzipTypedArray( file ) );
        }.bind( <span class="hljs-keyword">this</span> ) );

        <span class="hljs-keyword">return</span> defer.promise;
    },

    initializeBufferArray: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> vb, type, buf, options </span>) </span>{
        <span class="hljs-keyword">if</span> ( options === <span class="hljs-literal">undefined</span> )
            options = <span class="hljs-keyword">this</span>.getOptions();
        <span class="hljs-keyword">if</span> ( options.initializeBufferArray )
            <span class="hljs-keyword">return</span> options.initializeBufferArray.call( <span class="hljs-keyword">this</span>, vb, type, buf );

        <span class="hljs-keyword">var</span> url = vb.File;
        <span class="hljs-keyword">var</span> defer = P.defer();
        <span class="hljs-keyword">this</span>.readBinaryArrayURL( url ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> array </span>) </span>{

            <span class="hljs-keyword">var</span> typedArray;</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>manage endianness</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> bigEndian;
            ( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> a = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>( [ <span class="hljs-number">0x12</span>, <span class="hljs-number">0x34</span> ] );
                <span class="hljs-keyword">var</span> b = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint16Array</span>( a.buffer );
                bigEndian = ( ( b[ <span class="hljs-number">0</span> ] ).toString( <span class="hljs-number">16</span> ) === <span class="hljs-string">'1234'</span> );
            } )();

            <span class="hljs-keyword">var</span> offset = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">if</span> ( vb.Offset !== <span class="hljs-literal">undefined</span> ) {
                offset = vb.Offset;
            }

            <span class="hljs-keyword">var</span> bytesPerElement = MACROUTILS[ type ].BYTES_PER_ELEMENT;
            <span class="hljs-keyword">var</span> nbItems = vb.Size;
            <span class="hljs-keyword">var</span> nbCoords = buf.getItemSize();
            <span class="hljs-keyword">var</span> totalSizeInBytes = nbItems * bytesPerElement * nbCoords;

            <span class="hljs-keyword">if</span> ( bigEndian ) {
                Notify.log( <span class="hljs-string">'big endian detected'</span> );
                <span class="hljs-keyword">var</span> TypedArray = MACROUTILS[ type ];
                <span class="hljs-keyword">var</span> tmpArray = <span class="hljs-keyword">new</span> TypedArray( nbItems * nbCoords );
                <span class="hljs-keyword">var</span> data = <span class="hljs-keyword">new</span> <span class="hljs-built_in">DataView</span>( array, offset, totalSizeInBytes );
                <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>,
                    l = tmpArray.length;
                <span class="hljs-keyword">if</span> ( type === <span class="hljs-string">'Uint16Array'</span> ) {
                    <span class="hljs-keyword">for</span> ( ; i &lt; l; i++ ) {
                        tmpArray[ i ] = data.getUint16( i * bytesPerElement, <span class="hljs-literal">true</span> );
                    }
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( type === <span class="hljs-string">'Float32Array'</span> ) {
                    <span class="hljs-keyword">for</span> ( ; i &lt; l; i++ ) {
                        tmpArray[ i ] = data.getFloat32( i * bytesPerElement, <span class="hljs-literal">true</span> );
                    }
                }
                typedArray = tmpArray;
                data = <span class="hljs-literal">null</span>;
            } <span class="hljs-keyword">else</span> {
                typedArray = <span class="hljs-keyword">new</span> MACROUTILS[ type ]( array, offset, nbCoords * nbItems );
            }

            buf.setElements( typedArray );
            defer.resolve( buf );
        } ).catch( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            Notify.warn( <span class="hljs-string">'Can\'t read binary array URL'</span> );
        } );
        <span class="hljs-keyword">return</span> defer.promise;
    },

    readBufferArray: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> options </span>) </span>{
        <span class="hljs-keyword">var</span> jsonObj = <span class="hljs-keyword">this</span>.getJSON();

        <span class="hljs-keyword">var</span> uniqueID = jsonObj.UniqueID;
        <span class="hljs-keyword">var</span> osgjsObject;
        <span class="hljs-keyword">if</span> ( uniqueID !== <span class="hljs-literal">undefined</span> ) {
            osgjsObject = <span class="hljs-keyword">this</span>._identifierMap[ uniqueID ];
            <span class="hljs-keyword">if</span> ( osgjsObject !== <span class="hljs-literal">undefined</span> ) {
                <span class="hljs-keyword">return</span> osgjsObject;
            }
        }

        <span class="hljs-keyword">if</span> ( options === <span class="hljs-literal">undefined</span> )
            options = <span class="hljs-keyword">this</span>.getOptions();
        <span class="hljs-keyword">if</span> ( options.readBufferArray )
            <span class="hljs-keyword">return</span> options.readBufferArray.call( <span class="hljs-keyword">this</span> );

        <span class="hljs-keyword">if</span> ( ( !jsonObj.Elements &amp;&amp; !jsonObj.Array ) || !jsonObj.ItemSize || !jsonObj.Type )
            <span class="hljs-keyword">return</span> P.reject();

        <span class="hljs-keyword">var</span> promise;</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>inline array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> ( jsonObj.Elements ) {
            promise = P.resolve( <span class="hljs-keyword">new</span> BufferArray( BufferArray[ jsonObj.Type ], jsonObj.Elements, jsonObj.ItemSize ) );

        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( jsonObj.Array ) {

            <span class="hljs-keyword">var</span> buf = <span class="hljs-keyword">new</span> BufferArray( BufferArray[ jsonObj.Type ] );
            buf.setItemSize( jsonObj.ItemSize );

            <span class="hljs-keyword">var</span> vb, type;
            <span class="hljs-keyword">if</span> ( jsonObj.Array.Float32Array ) {
                vb = jsonObj.Array.Float32Array;
                type = <span class="hljs-string">'Float32Array'</span>;
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( jsonObj.Array.Uint16Array ) {
                vb = jsonObj.Array.Uint16Array;
                type = <span class="hljs-string">'Uint16Array'</span>;
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( jsonObj.Array.Uint8Array ) {
                vb = jsonObj.Array.Uint8Array;
                type = <span class="hljs-string">'Uint8Array'</span>;
            } <span class="hljs-keyword">else</span> {
                Notify.warn( <span class="hljs-string">'Typed Array '</span> + <span class="hljs-built_in">window</span>.Object.keys( jsonObj.Array )[ <span class="hljs-number">0</span> ] );
                type = <span class="hljs-string">'Float32Array'</span>;
            }

            <span class="hljs-keyword">if</span> ( vb.File ) {
                promise = <span class="hljs-keyword">this</span>.initializeBufferArray( vb, type, buf );
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( vb.Elements ) {
                buf.setElements( <span class="hljs-keyword">new</span> MACROUTILS[ type ]( vb.Elements ) );
                promise = P.resolve( buf );
            }
        }

        <span class="hljs-keyword">if</span> ( uniqueID !== <span class="hljs-literal">undefined</span> ) {
            <span class="hljs-keyword">this</span>._identifierMap[ uniqueID ] = promise;
        }
        <span class="hljs-keyword">return</span> promise;
    },

    readUserDataContainer: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> jsonObj = <span class="hljs-keyword">this</span>.getJSON();
        <span class="hljs-keyword">var</span> osgjsObject;
        <span class="hljs-keyword">var</span> uniqueID = jsonObj.UniqueID;
        <span class="hljs-keyword">if</span> ( uniqueID !== <span class="hljs-literal">undefined</span> ) {
            osgjsObject = <span class="hljs-keyword">this</span>._identifierMap[ uniqueID ];
            <span class="hljs-keyword">if</span> ( osgjsObject !== <span class="hljs-literal">undefined</span> ) {
                <span class="hljs-keyword">return</span> osgjsObject.Values;
            }
        }

        <span class="hljs-keyword">this</span>._identifierMap[ uniqueID ] = jsonObj;
        <span class="hljs-keyword">return</span> jsonObj.Values;
    },

    readPrimitiveSet: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> jsonObj = <span class="hljs-keyword">this</span>.getJSON();
        <span class="hljs-keyword">var</span> uniqueID;
        <span class="hljs-keyword">var</span> osgjsObject;

        <span class="hljs-keyword">var</span> defer = P.defer();
        <span class="hljs-keyword">var</span> obj, mode, first, count;
        <span class="hljs-keyword">var</span> drawElementPrimitive = jsonObj.DrawElementUShort || jsonObj.DrawElementUByte || jsonObj.DrawElementUInt || jsonObj.DrawElementsUShort || jsonObj.DrawElementsUByte || jsonObj.DrawElementsUInt || <span class="hljs-literal">undefined</span>;
        <span class="hljs-keyword">if</span> ( drawElementPrimitive ) {

            uniqueID = drawElementPrimitive.UniqueID;
            <span class="hljs-keyword">if</span> ( uniqueID !== <span class="hljs-literal">undefined</span> ) {
                osgjsObject = <span class="hljs-keyword">this</span>._identifierMap[ uniqueID ];
                <span class="hljs-keyword">if</span> ( osgjsObject !== <span class="hljs-literal">undefined</span> ) {
                    <span class="hljs-keyword">return</span> osgjsObject;
                }
            }

            <span class="hljs-keyword">var</span> jsonArray = drawElementPrimitive.Indices;
            <span class="hljs-keyword">var</span> prevJson = jsonObj;

            mode = drawElementPrimitive.Mode;
            <span class="hljs-keyword">if</span> ( !mode ) {
                mode = PrimitiveSet.TRIANGLES;
            } <span class="hljs-keyword">else</span> {
                mode = PrimitiveSet[ mode ];
            }
            obj = <span class="hljs-keyword">new</span> DrawElements( mode );

            <span class="hljs-keyword">this</span>.setJSON( jsonArray );
            <span class="hljs-keyword">this</span>.readBufferArray().then( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> array </span>) </span>{
                obj.setIndices( array );
                defer.resolve( obj );
            } ).catch( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                Notify.warn( <span class="hljs-string">'Error buffer array'</span> );
            } );
            <span class="hljs-keyword">this</span>.setJSON( prevJson );
        }

        <span class="hljs-keyword">var</span> drawArrayPrimitive = jsonObj.DrawArray || jsonObj.DrawArrays;
        <span class="hljs-keyword">if</span> ( drawArrayPrimitive ) {

            uniqueID = drawArrayPrimitive.UniqueID;
            <span class="hljs-keyword">if</span> ( uniqueID !== <span class="hljs-literal">undefined</span> ) {
                osgjsObject = <span class="hljs-keyword">this</span>._identifierMap[ uniqueID ];
                <span class="hljs-keyword">if</span> ( osgjsObject !== <span class="hljs-literal">undefined</span> ) {
                    <span class="hljs-keyword">return</span> osgjsObject;
                }
            }

            mode = drawArrayPrimitive.Mode || drawArrayPrimitive.mode;
            first = drawArrayPrimitive.First !== <span class="hljs-literal">undefined</span> ? drawArrayPrimitive.First : drawArrayPrimitive.first;
            count = drawArrayPrimitive.Count !== <span class="hljs-literal">undefined</span> ? drawArrayPrimitive.Count : drawArrayPrimitive.count;
            <span class="hljs-keyword">var</span> drawArray = <span class="hljs-keyword">new</span> DrawArrays( PrimitiveSet[ mode ], first, count );
            defer.resolve( drawArray );
        }

        <span class="hljs-keyword">var</span> drawArrayLengthsPrimitive = jsonObj.DrawArrayLengths || <span class="hljs-literal">undefined</span>;
        <span class="hljs-keyword">if</span> ( drawArrayLengthsPrimitive ) {

            uniqueID = drawArrayLengthsPrimitive.UniqueID;
            <span class="hljs-keyword">if</span> ( uniqueID !== <span class="hljs-literal">undefined</span> ) {
                osgjsObject = <span class="hljs-keyword">this</span>._identifierMap[ uniqueID ];
                <span class="hljs-keyword">if</span> ( osgjsObject !== <span class="hljs-literal">undefined</span> ) {
                    <span class="hljs-keyword">return</span> osgjsObject;
                }
            }

            mode = drawArrayLengthsPrimitive.Mode;
            first = drawArrayLengthsPrimitive.First;
            <span class="hljs-keyword">var</span> array = drawArrayLengthsPrimitive.ArrayLengths;
            <span class="hljs-keyword">var</span> drawArrayLengths = <span class="hljs-keyword">new</span> DrawArrayLengths( PrimitiveSet[ mode ], first, array );
            defer.resolve( drawArrayLengths );
        }

        <span class="hljs-keyword">if</span> ( uniqueID !== <span class="hljs-literal">undefined</span> ) {
            <span class="hljs-keyword">this</span>._identifierMap[ uniqueID ] = defer.promise;
        }

        <span class="hljs-keyword">return</span> defer.promise;
    },


    readObject: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">var</span> jsonObj = <span class="hljs-keyword">this</span>.getJSON();
        <span class="hljs-keyword">var</span> prop = <span class="hljs-built_in">window</span>.Object.keys( jsonObj )[ <span class="hljs-number">0</span> ];
        <span class="hljs-keyword">if</span> ( !prop ) {
            Notify.warn( <span class="hljs-string">'can\'t find property for object '</span> + jsonObj );
            <span class="hljs-keyword">return</span> P.reject();
        }

        <span class="hljs-keyword">var</span> uniqueID = jsonObj[ prop ].UniqueID;
        <span class="hljs-keyword">var</span> osgjsObject;
        <span class="hljs-keyword">if</span> ( uniqueID !== <span class="hljs-literal">undefined</span> ) {
            osgjsObject = <span class="hljs-keyword">this</span>._identifierMap[ uniqueID ];
            <span class="hljs-keyword">if</span> ( osgjsObject !== <span class="hljs-literal">undefined</span> ) {
                <span class="hljs-keyword">return</span> osgjsObject;
            }
        }

        <span class="hljs-keyword">var</span> obj = <span class="hljs-keyword">this</span>.getObjectWrapper( prop );

        <span class="hljs-keyword">if</span> ( !obj ) {
            Notify.warn( <span class="hljs-string">'can\'t instanciate object '</span> + prop );
            <span class="hljs-keyword">return</span> P.reject();
        }

        <span class="hljs-keyword">var</span> ReaderParser = <span class="hljs-built_in">require</span>( <span class="hljs-string">'osgDB/ReaderParser'</span> );
        <span class="hljs-keyword">var</span> scope = ReaderParser.ObjectWrapper.serializers;

        <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>._cacheReadObject[ prop ] ) {
            scope = <span class="hljs-keyword">this</span>._cacheReadObject[ prop ];
        } <span class="hljs-keyword">else</span> {

            <span class="hljs-keyword">var</span> splittedPath = prop.split( <span class="hljs-string">'.'</span> );
            <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, l = splittedPath.length; i &lt; l; i++ ) {
                <span class="hljs-keyword">var</span> reader = scope[ splittedPath[ i ] ];
                <span class="hljs-keyword">if</span> ( reader === <span class="hljs-literal">undefined</span> ) {
                    Notify.warn( <span class="hljs-string">'can\'t find function to read object '</span> + prop + <span class="hljs-string">' - undefined'</span> );
                    <span class="hljs-keyword">return</span> P.reject();
                }
                scope = reader;
            }
            <span class="hljs-keyword">this</span>._cacheReadObject[ prop ] = scope;
        }

        <span class="hljs-keyword">var</span> promise = scope( <span class="hljs-keyword">this</span>.setJSON( jsonObj[ prop ] ), obj );

        <span class="hljs-keyword">if</span> ( uniqueID !== <span class="hljs-literal">undefined</span> ) {
            <span class="hljs-keyword">this</span>._identifierMap[ uniqueID ] = promise;
            obj._uniqueID = uniqueID;
        }

        <span class="hljs-keyword">return</span> promise;
    }
};

<span class="hljs-built_in">module</span>.exports = Input;</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
