<!DOCTYPE html>

<html>
<head>
  <title>BasicAnimationManager.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="OSG.html">
                OSG.js
              </a>
            
              
              <a class="source" href="BillboardAttribute.html">
                BillboardAttribute.js
              </a>
            
              
              <a class="source" href="BlendColor.html">
                BlendColor.js
              </a>
            
              
              <a class="source" href="BlendFunc.html">
                BlendFunc.js
              </a>
            
              
              <a class="source" href="BoundingBox.html">
                BoundingBox.js
              </a>
            
              
              <a class="source" href="BoundingSphere.html">
                BoundingSphere.js
              </a>
            
              
              <a class="source" href="BufferArray.html">
                BufferArray.js
              </a>
            
              
              <a class="source" href="BufferArrayProxy.html">
                BufferArrayProxy.js
              </a>
            
              
              <a class="source" href="Camera.html">
                Camera.js
              </a>
            
              
              <a class="source" href="ColorMask.html">
                ColorMask.js
              </a>
            
              
              <a class="source" href="ComputeBoundsVisitor.html">
                ComputeBoundsVisitor.js
              </a>
            
              
              <a class="source" href="ComputeMatrixFromNodePath.html">
                ComputeMatrixFromNodePath.js
              </a>
            
              
              <a class="source" href="CullFace.html">
                CullFace.js
              </a>
            
              
              <a class="source" href="CullSettings.html">
                CullSettings.js
              </a>
            
              
              <a class="source" href="CullStack.html">
                CullStack.js
              </a>
            
              
              <a class="source" href="CullVisitor.html">
                CullVisitor.js
              </a>
            
              
              <a class="source" href="CullingSet.html">
                CullingSet.js
              </a>
            
              
              <a class="source" href="Depth.html">
                Depth.js
              </a>
            
              
              <a class="source" href="DrawArrayLengths.html">
                DrawArrayLengths.js
              </a>
            
              
              <a class="source" href="DrawArrays.html">
                DrawArrays.js
              </a>
            
              
              <a class="source" href="DrawElements.html">
                DrawElements.js
              </a>
            
              
              <a class="source" href="EllipsoidModel.html">
                EllipsoidModel.js
              </a>
            
              
              <a class="source" href="FrameBufferObject.html">
                FrameBufferObject.js
              </a>
            
              
              <a class="source" href="FrameStamp.html">
                FrameStamp.js
              </a>
            
              
              <a class="source" href="GLObject.html">
                GLObject.js
              </a>
            
              
              <a class="source" href="Geometry.html">
                Geometry.js
              </a>
            
              
              <a class="source" href="Image.html">
                Image.js
              </a>
            
              
              <a class="source" href="ImageStream.html">
                ImageStream.js
              </a>
            
              
              <a class="source" href="KdTree.html">
                KdTree.js
              </a>
            
              
              <a class="source" href="KdTreeBuilder.html">
                KdTreeBuilder.js
              </a>
            
              
              <a class="source" href="KdTreeRayIntersector.html">
                KdTreeRayIntersector.js
              </a>
            
              
              <a class="source" href="KdTreeSphereIntersector.html">
                KdTreeSphereIntersector.js
              </a>
            
              
              <a class="source" href="Light.html">
                Light.js
              </a>
            
              
              <a class="source" href="LightSource.html">
                LightSource.js
              </a>
            
              
              <a class="source" href="LineWidth.html">
                LineWidth.js
              </a>
            
              
              <a class="source" href="Lod.html">
                Lod.js
              </a>
            
              
              <a class="source" href="Map.html">
                Map.js
              </a>
            
              
              <a class="source" href="Material.html">
                Material.js
              </a>
            
              
              <a class="source" href="Math.html">
                Math.js
              </a>
            
              
              <a class="source" href="Matrix.html">
                Matrix.js
              </a>
            
              
              <a class="source" href="MatrixMemoryPool.html">
                MatrixMemoryPool.js
              </a>
            
              
              <a class="source" href="MatrixTransform.html">
                MatrixTransform.js
              </a>
            
              
              <a class="source" href="Node.html">
                Node.js
              </a>
            
              
              <a class="source" href="NodeVisitor.html">
                NodeVisitor.js
              </a>
            
              
              <a class="source" href="Notify.html">
                Notify.js
              </a>
            
              
              <a class="source" href="Object.html">
                Object.js
              </a>
            
              
              <a class="source" href="Options.html">
                Options.js
              </a>
            
              
              <a class="source" href="PagedLOD.html">
                PagedLOD.js
              </a>
            
              
              <a class="source" href="Plane.html">
                Plane.js
              </a>
            
              
              <a class="source" href="Polytope.html">
                Polytope.js
              </a>
            
              
              <a class="source" href="PrimitiveFunctor.html">
                PrimitiveFunctor.js
              </a>
            
              
              <a class="source" href="PrimitiveSet.html">
                PrimitiveSet.js
              </a>
            
              
              <a class="source" href="Program.html">
                Program.js
              </a>
            
              
              <a class="source" href="Projection.html">
                Projection.js
              </a>
            
              
              <a class="source" href="Quat.html">
                Quat.js
              </a>
            
              
              <a class="source" href="RenderBin.html">
                RenderBin.js
              </a>
            
              
              <a class="source" href="RenderLeaf.html">
                RenderLeaf.js
              </a>
            
              
              <a class="source" href="RenderStage.html">
                RenderStage.js
              </a>
            
              
              <a class="source" href="Shader.html">
                Shader.js
              </a>
            
              
              <a class="source" href="Shape.html">
                Shape.js
              </a>
            
              
              <a class="source" href="Stack.html">
                Stack.js
              </a>
            
              
              <a class="source" href="State.html">
                State.js
              </a>
            
              
              <a class="source" href="StateAttribute.html">
                StateAttribute.js
              </a>
            
              
              <a class="source" href="StateGraph.html">
                StateGraph.js
              </a>
            
              
              <a class="source" href="StateSet.html">
                StateSet.js
              </a>
            
              
              <a class="source" href="Texture.html">
                Texture.js
              </a>
            
              
              <a class="source" href="TextureCubeMap.html">
                TextureCubeMap.js
              </a>
            
              
              <a class="source" href="TextureManager.html">
                TextureManager.js
              </a>
            
              
              <a class="source" href="Timer.html">
                Timer.js
              </a>
            
              
              <a class="source" href="Transform.html">
                Transform.js
              </a>
            
              
              <a class="source" href="TransformEnums.html">
                TransformEnums.js
              </a>
            
              
              <a class="source" href="TriangleIndexFunctor.html">
                TriangleIndexFunctor.js
              </a>
            
              
              <a class="source" href="Uniform.html">
                Uniform.js
              </a>
            
              
              <a class="source" href="UpdateVisitor.html">
                UpdateVisitor.js
              </a>
            
              
              <a class="source" href="Utils.html">
                Utils.js
              </a>
            
              
              <a class="source" href="Vec2.html">
                Vec2.js
              </a>
            
              
              <a class="source" href="Vec3.html">
                Vec3.js
              </a>
            
              
              <a class="source" href="Vec4.html">
                Vec4.js
              </a>
            
              
              <a class="source" href="Viewport.html">
                Viewport.js
              </a>
            
              
              <a class="source" href="WebGLCaps.html">
                WebGLCaps.js
              </a>
            
              
              <a class="source" href="osg.html">
                osg.js
              </a>
            
              
              <a class="source" href="Animation.html">
                Animation.js
              </a>
            
              
              <a class="source" href="AnimationUpdateCallback.html">
                AnimationUpdateCallback.js
              </a>
            
              
              <a class="source" href="BasicAnimationManager.html">
                BasicAnimationManager.js
              </a>
            
              
              <a class="source" href="Bone.html">
                Bone.js
              </a>
            
              
              <a class="source" href="Channel.html">
                Channel.js
              </a>
            
              
              <a class="source" href="CollectAnimationUpdateCallbackVisitor.html">
                CollectAnimationUpdateCallbackVisitor.js
              </a>
            
              
              <a class="source" href="CollectBoneVisitor.html">
                CollectBoneVisitor.js
              </a>
            
              
              <a class="source" href="Easing.html">
                Easing.js
              </a>
            
              
              <a class="source" href="FindNearestParentSkeleton.html">
                FindNearestParentSkeleton.js
              </a>
            
              
              <a class="source" href="Interpolator.html">
                Interpolator.js
              </a>
            
              
              <a class="source" href="MorphAttribute.html">
                MorphAttribute.js
              </a>
            
              
              <a class="source" href="MorphGeometry.html">
                MorphGeometry.js
              </a>
            
              
              <a class="source" href="RigGeometry.html">
                RigGeometry.js
              </a>
            
              
              <a class="source" href="RigTransformHardware.html">
                RigTransformHardware.js
              </a>
            
              
              <a class="source" href="Skeleton.html">
                Skeleton.js
              </a>
            
              
              <a class="source" href="SkinningAttribute.html">
                SkinningAttribute.js
              </a>
            
              
              <a class="source" href="StackedMatrix.html">
                StackedMatrix.js
              </a>
            
              
              <a class="source" href="StackedQuaternion.html">
                StackedQuaternion.js
              </a>
            
              
              <a class="source" href="StackedRotateAxis.html">
                StackedRotateAxis.js
              </a>
            
              
              <a class="source" href="StackedScale.html">
                StackedScale.js
              </a>
            
              
              <a class="source" href="StackedTranslate.html">
                StackedTranslate.js
              </a>
            
              
              <a class="source" href="Target.html">
                Target.js
              </a>
            
              
              <a class="source" href="UpdateBone.html">
                UpdateBone.js
              </a>
            
              
              <a class="source" href="UpdateMatrixTransform.html">
                UpdateMatrixTransform.js
              </a>
            
              
              <a class="source" href="UpdateMorph.html">
                UpdateMorph.js
              </a>
            
              
              <a class="source" href="UpdateRigGeometry.html">
                UpdateRigGeometry.js
              </a>
            
              
              <a class="source" href="UpdateSkeleton.html">
                UpdateSkeleton.js
              </a>
            
              
              <a class="source" href="channelType.html">
                channelType.js
              </a>
            
              
              <a class="source" href="osgAnimation.html">
                osgAnimation.js
              </a>
            
              
              <a class="source" href="DatabasePager.html">
                DatabasePager.js
              </a>
            
              
              <a class="source" href="Input.html">
                Input.js
              </a>
            
              
              <a class="source" href="Options.html">
                Options.js
              </a>
            
              
              <a class="source" href="ReaderParser.html">
                ReaderParser.js
              </a>
            
              
              <a class="source" href="osgDB.html">
                osgDB.js
              </a>
            
              
              <a class="source" href="FirstPersonManipulator.html">
                FirstPersonManipulator.js
              </a>
            
              
              <a class="source" href="FirstPersonManipulatorDeviceOrientationController.html">
                FirstPersonManipulatorDeviceOrientationController.js
              </a>
            
              
              <a class="source" href="FirstPersonManipulatorHammerController.html">
                FirstPersonManipulatorHammerController.js
              </a>
            
              
              <a class="source" href="FirstPersonManipulatorStandardMouseKeyboardController.html">
                FirstPersonManipulatorStandardMouseKeyboardController.js
              </a>
            
              
              <a class="source" href="FirstPersonManipulatorWebVRController.html">
                FirstPersonManipulatorWebVRController.js
              </a>
            
              
              <a class="source" href="Manipulator.html">
                Manipulator.js
              </a>
            
              
              <a class="source" href="OrbitManipulator.html">
                OrbitManipulator.js
              </a>
            
              
              <a class="source" href="OrbitManipulatorDeviceOrientationController.html">
                OrbitManipulatorDeviceOrientationController.js
              </a>
            
              
              <a class="source" href="OrbitManipulatorEnums.html">
                OrbitManipulatorEnums.js
              </a>
            
              
              <a class="source" href="OrbitManipulatorGamePadController.html">
                OrbitManipulatorGamePadController.js
              </a>
            
              
              <a class="source" href="OrbitManipulatorHammerController.html">
                OrbitManipulatorHammerController.js
              </a>
            
              
              <a class="source" href="OrbitManipulatorLeapMotionController.html">
                OrbitManipulatorLeapMotionController.js
              </a>
            
              
              <a class="source" href="OrbitManipulatorStandardMouseKeyboardController.html">
                OrbitManipulatorStandardMouseKeyboardController.js
              </a>
            
              
              <a class="source" href="OrbitManipulatorWebVRController.html">
                OrbitManipulatorWebVRController.js
              </a>
            
              
              <a class="source" href="SwitchManipulator.html">
                SwitchManipulator.js
              </a>
            
              
              <a class="source" href="osgGA.html">
                osgGA.js
              </a>
            
              
              <a class="source" href="osgNameSpace.html">
                osgNameSpace.js
              </a>
            
              
              <a class="source" href="Compiler.html">
                Compiler.js
              </a>
            
              
              <a class="source" href="ShaderGenerator.html">
                ShaderGenerator.js
              </a>
            
              
              <a class="source" href="ShaderGeneratorProxy.html">
                ShaderGeneratorProxy.js
              </a>
            
              
              <a class="source" href="ShaderProcessor.html">
                ShaderProcessor.js
              </a>
            
              
              <a class="source" href="node.html">
                node.js
              </a>
            
              
              <a class="source" href="Node.html">
                Node.js
              </a>
            
              
              <a class="source" href="data.html">
                data.js
              </a>
            
              
              <a class="source" href="functions.html">
                functions.js
              </a>
            
              
              <a class="source" href="lights.html">
                lights.js
              </a>
            
              
              <a class="source" href="morph.html">
                morph.js
              </a>
            
              
              <a class="source" href="operations.html">
                operations.js
              </a>
            
              
              <a class="source" href="shadows.html">
                shadows.js
              </a>
            
              
              <a class="source" href="skinning.html">
                skinning.js
              </a>
            
              
              <a class="source" href="textures.html">
                textures.js
              </a>
            
              
              <a class="source" href="nodeFactory.html">
                nodeFactory.js
              </a>
            
              
              <a class="source" href="osgShader.html">
                osgShader.js
              </a>
            
              
              <a class="source" href="shaderLib.html">
                shaderLib.js
              </a>
            
              
              <a class="source" href="utils.html">
                utils.js
              </a>
            
              
              <a class="source" href="ShadowCastAttribute.html">
                ShadowCastAttribute.js
              </a>
            
              
              <a class="source" href="ShadowCastCompiler.html">
                ShadowCastCompiler.js
              </a>
            
              
              <a class="source" href="ShadowCastShaderGenerator.html">
                ShadowCastShaderGenerator.js
              </a>
            
              
              <a class="source" href="ShadowCasterVisitor.html">
                ShadowCasterVisitor.js
              </a>
            
              
              <a class="source" href="ShadowFrustumIntersection.html">
                ShadowFrustumIntersection.js
              </a>
            
              
              <a class="source" href="ShadowMap.html">
                ShadowMap.js
              </a>
            
              
              <a class="source" href="ShadowReceiveAttribute.html">
                ShadowReceiveAttribute.js
              </a>
            
              
              <a class="source" href="ShadowSettings.html">
                ShadowSettings.js
              </a>
            
              
              <a class="source" href="ShadowTechnique.html">
                ShadowTechnique.js
              </a>
            
              
              <a class="source" href="ShadowTexture.html">
                ShadowTexture.js
              </a>
            
              
              <a class="source" href="ShadowedScene.html">
                ShadowedScene.js
              </a>
            
              
              <a class="source" href="osgShadow.html">
                osgShadow.js
              </a>
            
              
              <a class="source" href="shaderLib.html">
                shaderLib.js
              </a>
            
              
              <a class="source" href="Text.html">
                Text.js
              </a>
            
              
              <a class="source" href="osgText.html">
                osgText.js
              </a>
            
              
              <a class="source" href="Composer.html">
                Composer.js
              </a>
            
              
              <a class="source" href="DisplayGeometryVisitor.html">
                DisplayGeometryVisitor.js
              </a>
            
              
              <a class="source" href="DisplayGraph.html">
                DisplayGraph.js
              </a>
            
              
              <a class="source" href="DisplayGraphNode.html">
                DisplayGraphNode.js
              </a>
            
              
              <a class="source" href="DisplayGraphRenderer.html">
                DisplayGraphRenderer.js
              </a>
            
              
              <a class="source" href="DisplayNormalVisitor.html">
                DisplayNormalVisitor.js
              </a>
            
              
              <a class="source" href="GizmoGeometry.html">
                GizmoGeometry.js
              </a>
            
              
              <a class="source" href="IntersectionVisitor.html">
                IntersectionVisitor.js
              </a>
            
              
              <a class="source" href="LineSegmentIntersector.html">
                LineSegmentIntersector.js
              </a>
            
              
              <a class="source" href="NodeGizmo.html">
                NodeGizmo.js
              </a>
            
              
              <a class="source" href="ParameterVisitor.html">
                ParameterVisitor.js
              </a>
            
              
              <a class="source" href="PolytopeIntersector.html">
                PolytopeIntersector.js
              </a>
            
              
              <a class="source" href="PolytopePrimitiveIntersector.html">
                PolytopePrimitiveIntersector.js
              </a>
            
              
              <a class="source" href="SphereIntersector.html">
                SphereIntersector.js
              </a>
            
              
              <a class="source" href="TangentSpaceGenerator.html">
                TangentSpaceGenerator.js
              </a>
            
              
              <a class="source" href="TriangleIntersector.html">
                TriangleIntersector.js
              </a>
            
              
              <a class="source" href="TriangleSphereIntersector.html">
                TriangleSphereIntersector.js
              </a>
            
              
              <a class="source" href="WebVR.html">
                WebVR.js
              </a>
            
              
              <a class="source" href="WebVRCustom.html">
                WebVRCustom.js
              </a>
            
              
              <a class="source" href="osgPool.html">
                osgPool.js
              </a>
            
              
              <a class="source" href="osgUtil.html">
                osgUtil.js
              </a>
            
              
              <a class="source" href="Renderer.html">
                Renderer.js
              </a>
            
              
              <a class="source" href="Scene.html">
                Scene.js
              </a>
            
              
              <a class="source" href="View.html">
                View.js
              </a>
            
              
              <a class="source" href="Viewer.html">
                Viewer.js
              </a>
            
              
              <a class="source" href="createStats.html">
                createStats.js
              </a>
            
              
              <a class="source" href="DeviceOrientation.html">
                DeviceOrientation.js
              </a>
            
              
              <a class="source" href="EventProxy.html">
                EventProxy.js
              </a>
            
              
              <a class="source" href="GamePad.html">
                GamePad.js
              </a>
            
              
              <a class="source" href="Hammer.html">
                Hammer.js
              </a>
            
              
              <a class="source" href="LeapMotion.html">
                LeapMotion.js
              </a>
            
              
              <a class="source" href="StandardMouseKeyboard.html">
                StandardMouseKeyboard.js
              </a>
            
              
              <a class="source" href="WebVR.html">
                WebVR.js
              </a>
            
              
              <a class="source" href="osgViewer.html">
                osgViewer.js
              </a>
            
              
              <a class="source" href="webgl-debug.html">
                webgl-debug.js
              </a>
            
              
              <a class="source" href="webgl-utils.html">
                webgl-utils.js
              </a>
            
              
              <a class="source" href="osgWrappers.html">
                osgWrappers.js
              </a>
            
              
              <a class="source" href="osg.html">
                osg.js
              </a>
            
              
              <a class="source" href="osgAnimation.html">
                osgAnimation.js
              </a>
            
              
              <a class="source" href="osgText.html">
                osgText.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>BasicAnimationManager.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-meta">'use strict'</span>;
<span class="hljs-keyword">var</span> Notify = <span class="hljs-built_in">require</span>( <span class="hljs-string">'osg/Notify'</span> );
<span class="hljs-keyword">var</span> MACROUTILS = <span class="hljs-built_in">require</span>( <span class="hljs-string">'osg/Utils'</span> );
<span class="hljs-keyword">var</span> BaseObject = <span class="hljs-built_in">require</span>( <span class="hljs-string">'osg/Object'</span> );
<span class="hljs-keyword">var</span> Quat = <span class="hljs-built_in">require</span>( <span class="hljs-string">'osg/Quat'</span> );
<span class="hljs-keyword">var</span> Vec3 = <span class="hljs-built_in">require</span>( <span class="hljs-string">'osg/Vec3'</span> );
<span class="hljs-keyword">var</span> Matrix = <span class="hljs-built_in">require</span>( <span class="hljs-string">'osg/Matrix'</span> );
<span class="hljs-keyword">var</span> Channel = <span class="hljs-built_in">require</span>( <span class="hljs-string">'osgAnimation/Channel'</span> );
<span class="hljs-keyword">var</span> Animation = <span class="hljs-built_in">require</span>( <span class="hljs-string">'osgAnimation/Animation'</span> );
<span class="hljs-keyword">var</span> Interpolator = <span class="hljs-built_in">require</span>( <span class="hljs-string">'osgAnimation/Interpolator'</span> );
<span class="hljs-keyword">var</span> CollectAnimationUpdateCallbackVisitor = <span class="hljs-built_in">require</span>( <span class="hljs-string">'osgAnimation/CollectAnimationUpdateCallbackVisitor'</span> );
<span class="hljs-keyword">var</span> Target = <span class="hljs-built_in">require</span>( <span class="hljs-string">'osgAnimation/Target'</span> );
<span class="hljs-keyword">var</span> UpdateMorph = <span class="hljs-built_in">require</span>( <span class="hljs-string">'osgAnimation/UpdateMorph'</span> );


<span class="hljs-keyword">var</span> Float = {
    lerp: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> t, a, b </span>) </span>{
        <span class="hljs-keyword">return</span> a + ( b - a ) * t;
    },
    init: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-number">0.0</span>;
    },
    copy: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> src </span>) </span>{
        <span class="hljs-keyword">return</span> src;
    },
    create: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-number">0.0</span>;
    }
};

<span class="hljs-keyword">var</span> TypeToSize = [];
TypeToSize[ Channel.ChannelType.Float ] = <span class="hljs-number">1</span>;
TypeToSize[ Channel.ChannelType.FloatCubicBezier ] = <span class="hljs-number">1</span>;
TypeToSize[ Channel.ChannelType.Vec3 ] = <span class="hljs-number">3</span>;
TypeToSize[ Channel.ChannelType.Vec3CubicBezier ] = <span class="hljs-number">3</span>;
TypeToSize[ Channel.ChannelType.Quat ] = <span class="hljs-number">4</span>;
TypeToSize[ Channel.ChannelType.QuatSlerp ] = <span class="hljs-number">4</span>;
TypeToSize[ Channel.ChannelType.Matrix ] = <span class="hljs-number">16</span>;


<span class="hljs-keyword">var</span> ResultType = [];
ResultType.length = Channel.ChannelType.Count;
ResultType[ Channel.ChannelType.Vec3 ] = Vec3;
ResultType[ Channel.ChannelType.Quat ] = Quat;
ResultType[ Channel.ChannelType.QuatSlerp ] = Quat;
ResultType[ Channel.ChannelType.Float ] = Float;
ResultType[ Channel.ChannelType.FloatCubicBezier ] = Float;
ResultType[ Channel.ChannelType.Vec3CubicBezier ] = Vec3;
ResultType[ Channel.ChannelType.Matrix ] = Matrix;

<span class="hljs-comment">/**
 *  BasicAnimationManager
 *  @class BasicAnimationManager
 */</span>
<span class="hljs-keyword">var</span> BasicAnimationManager = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    BaseObject.call( <span class="hljs-keyword">this</span> );

    <span class="hljs-keyword">this</span>._simulationTime = <span class="hljs-number">0.0</span>;
    <span class="hljs-keyword">this</span>._pauseTime = <span class="hljs-number">0.0</span>;
    <span class="hljs-keyword">this</span>._timeFactor = <span class="hljs-number">1.0</span>;
    <span class="hljs-keyword">this</span>._startTime = <span class="hljs-number">0.0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>contains a map with instance animations</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>._instanceAnimations = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>animations to start</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>._startAnimations = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>target contains an array of all target for this manager
index in the array is used as ID
see Animation.createTarget
[
    { id: 0,
      channels: [],
      value: 0.0,
      defaultValue: 0.0,
      type
    },
    …
];</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>._targets = [];
    <span class="hljs-keyword">this</span>._targetsMap = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>target id with active lists
[
  Vec3: [ targetID0, targetID1 ]
  Quat: [ targetID2, targetID3,  … ]
  Float: [ … ]
]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>._targetsByTypes = [];
    <span class="hljs-keyword">this</span>._targetsByTypes.length = Channel.ChannelType.Count;
    <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, ni = <span class="hljs-keyword">this</span>._targetsByTypes.length; i &lt; ni; i++ ) {
        <span class="hljs-keyword">this</span>._targetsByTypes[ i ] = [];
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>current playing animations</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>._activeAnimations = {};
    <span class="hljs-keyword">this</span>._activeAnimationList = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>current actives channels by types
  [ chanel0, channel1, … ] // Vec3 type
  [ chanel2, channel3, … ] // Quat type
  [ chanel5, channel6, … ] // Float type</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>._activeChannelsByTypes = [];
    <span class="hljs-keyword">this</span>._activeChannelsByTypes.length = Channel.ChannelType.Count;
    <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>, nj = <span class="hljs-keyword">this</span>._activeChannelsByTypes.length; j &lt; nj; j++ ) {
        <span class="hljs-keyword">this</span>._activeChannelsByTypes[ j ] = [];
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>assign all target/channel in animationCallback
then they can read it directly
animation callback to update</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>._animationsUpdateCallback = {};
    <span class="hljs-keyword">this</span>._animationsUpdateCallbackArray = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>queue of animations to register</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>._animationsToRegister = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Pause status (true / false)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>._pause = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">this</span>._dirty = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">this</span>._seekTime = <span class="hljs-number">-1</span>;
};

BasicAnimationManager.prototype = MACROUTILS.objectInherit( BaseObject.prototype, {

    init: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> animations </span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>reset all</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>._simulationTime = <span class="hljs-number">0.0</span>;
        <span class="hljs-keyword">this</span>._pauseTime = <span class="hljs-number">0.0</span>;
        <span class="hljs-keyword">this</span>._timeFactor = <span class="hljs-number">1.0</span>;
        <span class="hljs-keyword">this</span>._startTime = <span class="hljs-number">0.0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>contains a map with instance animations</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>._instanceAnimations = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>animations to start</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>._startAnimations = {};

        <span class="hljs-keyword">this</span>._resetTargets();

        <span class="hljs-keyword">this</span>._activeAnimations = {};
        <span class="hljs-keyword">this</span>._activeAnimationList.length = <span class="hljs-number">0</span>;

        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, ni = <span class="hljs-keyword">this</span>._activeChannelsByTypes.length; i &lt; ni; i++ )
            <span class="hljs-keyword">this</span>._activeChannelsByTypes[ i ].length = <span class="hljs-number">0</span>;

        <span class="hljs-keyword">this</span>._animationsUpdateCallback = {};
        <span class="hljs-keyword">this</span>._animationsUpdateCallbackArray.length = <span class="hljs-number">0</span>;

        <span class="hljs-keyword">this</span>._pause = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">this</span>._seekTime = <span class="hljs-number">-1</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>add animations</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.addAnimations( animations );
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>push all animations into the queue</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    addAnimations: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> animations </span>) </span>{

        <span class="hljs-keyword">var</span> instanceAnimationList = <span class="hljs-keyword">this</span>._addAnimation( animations );</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>qeue them to assign target</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-built_in">Array</span>.prototype.push.apply( <span class="hljs-keyword">this</span>._animationsToRegister, instanceAnimationList );
        <span class="hljs-keyword">this</span>._dirty = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>._registerAnimations();
    },


    update: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> node, nv </span>) </span>{

        <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>._dirty ) {
            <span class="hljs-keyword">this</span>._findAnimationUpdateCallback( node );
            <span class="hljs-keyword">this</span>._registerTargetFoundInAnimationCallback();
            <span class="hljs-keyword">this</span>._registerAnimations();
        }

        <span class="hljs-keyword">var</span> t = nv.getFrameStamp().getSimulationTime();

        <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>._seekTime !== <span class="hljs-number">-1</span> )
            <span class="hljs-keyword">this</span>._pauseTime = -<span class="hljs-keyword">this</span>._seekTime + <span class="hljs-keyword">this</span>._startTime + t;
        <span class="hljs-keyword">this</span>._seekTime = <span class="hljs-number">-1</span>;

        <span class="hljs-keyword">if</span> ( !<span class="hljs-keyword">this</span>._pause ) { <span class="hljs-comment">// Not in pause</span>
            <span class="hljs-keyword">this</span>._simulationTime = <span class="hljs-keyword">this</span>._startTime + ( t - <span class="hljs-keyword">this</span>._pauseTime );
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">this</span>._pauseTime = ( t - <span class="hljs-keyword">this</span>._simulationTime + <span class="hljs-keyword">this</span>._startTime );
        }

        <span class="hljs-keyword">this</span>.updateManager( <span class="hljs-keyword">this</span>._simulationTime * <span class="hljs-keyword">this</span>._timeFactor );
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    },

    updateManager: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> t </span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>adds active animations / channels requested</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>._processStartAnimation( t );

        <span class="hljs-keyword">var</span> l = Channel.ChannelType.Count;</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>update all actives channels by type</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; l; i++ ) {
            <span class="hljs-keyword">var</span> activeChannelType = <span class="hljs-keyword">this</span>._activeChannelsByTypes[ i ];
            <span class="hljs-keyword">this</span>._updateChannelsType( t, activeChannelType, Interpolator[ i ] );
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>update targets</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; l; j++ ) {
            <span class="hljs-keyword">var</span> targetType = <span class="hljs-keyword">this</span>._targetsByTypes[ j ];
            <span class="hljs-keyword">this</span>._updateTargetType( targetType, ResultType[ j ] );
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>update all animation callback
expect to have UpdateMatrixTransform</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> k = <span class="hljs-number">0</span>, nk = <span class="hljs-keyword">this</span>._animationsUpdateCallbackArray.length; k &lt; nk; k++ ) {
            <span class="hljs-keyword">var</span> animCallback = <span class="hljs-keyword">this</span>._animationsUpdateCallbackArray[ k ];
            animCallback.computeChannels();
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>check animation finished</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>._removeFinishedAnimation( t );
    },

    togglePause: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ <span class="hljs-comment">//Pause the manager's time</span>
        <span class="hljs-keyword">this</span>._pause = !<span class="hljs-keyword">this</span>._pause;</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>if we resume an animation we don’t want to move forward the animation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> ( !<span class="hljs-keyword">this</span>._pause )
            <span class="hljs-keyword">this</span>._seekTime = <span class="hljs-keyword">this</span>._simulationTime;
    },

    getSimulationTime: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._simulationTime;
    },

    setSimulationTime: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> t </span>) </span>{
        <span class="hljs-keyword">this</span>._simulationTime = t;
    },

    setSeekTime: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> t </span>) </span>{
        <span class="hljs-keyword">this</span>._simulationTime = t;
        <span class="hljs-keyword">this</span>._seekTime = t;
    },

    stopAnimation: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> name </span>) </span>{
        <span class="hljs-keyword">var</span> activeAnimationList = <span class="hljs-keyword">this</span>._activeAnimationList;
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, nbAnim = activeAnimationList.length; i &lt; nbAnim; ++i ) {
            <span class="hljs-keyword">if</span> ( activeAnimationList[ i ].name === name ) {
                <span class="hljs-keyword">this</span>._removeActiveChannels( <span class="hljs-keyword">this</span>._instanceAnimations[ name ] );
                <span class="hljs-keyword">this</span>._activeAnimations[ name ] = <span class="hljs-literal">undefined</span>;
                activeAnimationList.splice( i, <span class="hljs-number">1</span> );
                <span class="hljs-keyword">return</span>;
            }
        }
    },

    stopAllAnimation: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> activeAnimationList = <span class="hljs-keyword">this</span>._activeAnimationList;
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, nbAnim = activeAnimationList.length; i &lt; nbAnim; ++i ) {
            <span class="hljs-keyword">var</span> name = activeAnimationList[ i ].name;
            <span class="hljs-keyword">this</span>._removeActiveChannels( <span class="hljs-keyword">this</span>._instanceAnimations[ name ] );
            <span class="hljs-keyword">this</span>._activeAnimations[ name ] = <span class="hljs-literal">undefined</span>;
        }
        activeAnimationList.length = <span class="hljs-number">0</span>;
    },

    setTimeFactor: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> timeFactor </span>) </span>{
        <span class="hljs-keyword">var</span> tf = timeFactor / <span class="hljs-keyword">this</span>._timeFactor;
        <span class="hljs-keyword">this</span>._startTime += ( <span class="hljs-keyword">this</span>._simulationTime - <span class="hljs-keyword">this</span>._simulationTime * tf ) / tf;

        <span class="hljs-keyword">this</span>._timeFactor = timeFactor;

        <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>._pause )
            <span class="hljs-keyword">this</span>._simulationTime += ( <span class="hljs-keyword">this</span>._simulationTime - <span class="hljs-keyword">this</span>._simulationTime * tf ) / tf;
    },

    getTimeFactor: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._timeFactor;
    },

    isPlaying: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> name </span>) </span>{
        <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>._activeAnimations[ name ] ) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>play animation using object as config
{
    name: string,
    priority: 0,
    weight: 1.0,
    loop: true / false
}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    playAnimationObject: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> obj </span>) </span>{

        <span class="hljs-keyword">var</span> anim = <span class="hljs-keyword">this</span>._instanceAnimations[ obj.name ];
        <span class="hljs-keyword">if</span> ( !anim ) {
            Notify.info( <span class="hljs-string">'no animation '</span> + obj.name + <span class="hljs-string">' found'</span> );
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.isPlaying( obj.name ) ) <span class="hljs-keyword">return</span>;

        anim.priority = ( obj.priority === <span class="hljs-literal">undefined</span> ) ? <span class="hljs-number">0</span> : obj.priority;
        anim.weight = ( obj.weight === <span class="hljs-literal">undefined</span> ) ? <span class="hljs-number">1.0</span> : obj.weight;
        anim.loop = ( obj.loop === <span class="hljs-literal">undefined</span> ) ? <span class="hljs-literal">true</span> : obj.loop;

        <span class="hljs-keyword">this</span>._startAnimations[ anim.name ] = anim;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>if first argument is an object
playAnimationObject is called instead</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    playAnimation: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> name, loop, priority, weight </span>) </span>{

        <span class="hljs-keyword">var</span> animationObject;
        <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span> name === <span class="hljs-string">'object'</span> )
            animationObject = name;
        <span class="hljs-keyword">else</span> {
            animationObject = {
                name: name,
                priority: priority,
                weight: weight,
                loop: loop
            };
        }

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.playAnimationObject( animationObject );
    },

    getAnimations: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._instanceAnimations;
    },


    _registerAnimations: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">if</span> ( !<span class="hljs-keyword">this</span>._targets.length ) <span class="hljs-keyword">return</span>;

        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, ni = <span class="hljs-keyword">this</span>._animationsToRegister.length; i &lt; ni; i++ ) {
            <span class="hljs-keyword">var</span> instanceAnimation = <span class="hljs-keyword">this</span>._animationsToRegister[ i ];
            <span class="hljs-keyword">this</span>._registerInstanceAnimation( instanceAnimation );
        }

        <span class="hljs-keyword">this</span>._animationsToRegister.length = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">this</span>._dirty = <span class="hljs-literal">false</span>;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Register animation</p>
<p>Register animation list all target from channel in the animations and associate
target found in the scenegraph. If no target are registered animation cant be
registered. In this case animation will be pending and resolved after a visitor
extract target.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _registerInstanceAnimation: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> instanceAnimation </span>) </span>{

        <span class="hljs-keyword">var</span> instanceChannels = instanceAnimation.channels;
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, ni = instanceChannels.length; i &lt; ni; i++ ) {
            <span class="hljs-keyword">var</span> instanceChannel = instanceChannels[ i ];
            <span class="hljs-keyword">var</span> targetName = instanceChannel.channel.target;
            <span class="hljs-keyword">var</span> name = instanceChannel.channel.name;
            <span class="hljs-keyword">var</span> uniqueTargetName = targetName + <span class="hljs-string">'.'</span> + name;</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>disply a warning if animation has a channel but not target found in the
scene graph. We could probably optimize and removes those channels, but
it must be a user decision in case the user plugin different scene
graph together and target would appear later in the scenegraph</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> ( !<span class="hljs-keyword">this</span>._targetMap[ uniqueTargetName ] ) {
                Notify.warn( <span class="hljs-string">'registerInstanceAnimation did not find targetName ('</span> + uniqueTargetName + <span class="hljs-string">') in the scene graph'</span> );
                <span class="hljs-keyword">continue</span>;
            }

            instanceChannel.targetID = <span class="hljs-keyword">this</span>._targetMap[ uniqueTargetName ].id;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    },

    _findAnimationUpdateCallback: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> node </span>) </span>{
        <span class="hljs-keyword">var</span> collector = <span class="hljs-keyword">new</span> CollectAnimationUpdateCallbackVisitor();
        node.accept( collector );
        <span class="hljs-keyword">this</span>._animationsUpdateCallback = collector.getAnimationUpdateCallbackMap();
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>assignTargetToAnimationCallback</p>
<p>check all animationUpdateCallback collected and try to
assign the channel instance registered in the manager. If a
animationUpdateCallback contains channels not known by the
manager we skip it.  It means that it should be called
after the animations has been registered into the animation
manager</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _registerTargetFoundInAnimationCallback: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">this</span>._resetTargets();

        <span class="hljs-keyword">var</span> targetID = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">var</span> targetMap = <span class="hljs-keyword">this</span>._targetMap;
        <span class="hljs-keyword">var</span> targets = <span class="hljs-keyword">this</span>._targets;

        <span class="hljs-keyword">var</span> registerTarget = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> uniqueTargetName, target, name </span>) </span>{
            <span class="hljs-keyword">if</span> ( !targetMap[ uniqueTargetName ] ) {
                targetMap[ uniqueTargetName ] = target;</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>assign an id that will be an index into a array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                target.id = targetID++;
                targets.push( target );

                <span class="hljs-keyword">var</span> type = target.type; <span class="hljs-comment">// split by type</span>
                <span class="hljs-keyword">this</span>._targetsByTypes[ type ].push( target );
            } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>detect differents target instance with same
unique target name. It’s a problem</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> ( target !== targetMap[ uniqueTargetName ] )
                    Notify.warn( <span class="hljs-string">'detected differents target instance with the same name ('</span> + name + <span class="hljs-string">')'</span> );
            }
        }.bind( <span class="hljs-keyword">this</span> );


        <span class="hljs-keyword">var</span> target;
        <span class="hljs-keyword">var</span> name;
        <span class="hljs-keyword">var</span> uniqueTargetName;

        <span class="hljs-keyword">var</span> animationCallbackMap = <span class="hljs-keyword">this</span>._animationsUpdateCallback;
        <span class="hljs-keyword">var</span> keys = <span class="hljs-built_in">window</span>.Object.keys( animationCallbackMap );
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, ni = keys.length; i &lt; ni; i++ ) {
            <span class="hljs-keyword">var</span> key = keys[ i ];
            <span class="hljs-keyword">var</span> animationCallback = animationCallbackMap[ key ];</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>handle UpdateBone and UpdateMatrixTransform but not stateSet</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> ( animationCallback.getStackedTransforms &amp;&amp; animationCallback.getStackedTransforms().length ) {
                <span class="hljs-keyword">this</span>._animationsUpdateCallbackArray.push( animationCallback );

                <span class="hljs-keyword">var</span> stackedTransforms = animationCallback.getStackedTransforms();
                <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>, nj = stackedTransforms.length; j &lt; nj; j++ ) {
                    <span class="hljs-keyword">var</span> stackedTransform = stackedTransforms[ j ];
                    target = stackedTransform.getTarget();
                    name = stackedTransform.getName();
                    uniqueTargetName = animationCallback.getName() + <span class="hljs-string">'.'</span> + name;

                    registerTarget( uniqueTargetName, target, name );
                }
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( animationCallback <span class="hljs-keyword">instanceof</span> UpdateMorph ) {
                <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> t = <span class="hljs-number">0</span>, numTarget = animationCallback.getNumTarget(); t &lt; numTarget; t++ ) {
                    name = animationCallback.getTargetName( t );
                    uniqueTargetName = name + <span class="hljs-string">'.'</span> + t;
                    target = animationCallback.getTarget( t );

                    registerTarget( uniqueTargetName, target, name );
                }
            }
        }
    },

    _addAnimation: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> animations </span>) </span>{

        <span class="hljs-keyword">var</span> instanceAnimationList = [];
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, ni = animations.length; i &lt; ni; i++ ) {

            <span class="hljs-keyword">var</span> animation = animations[ i ];
            <span class="hljs-keyword">var</span> animationName = animation.name;

            <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>._instanceAnimations[ animationName ] )
                <span class="hljs-keyword">continue</span>;

            <span class="hljs-keyword">var</span> instanceAnimation = Animation.createInstanceAnimation( animation );
            <span class="hljs-keyword">this</span>._instanceAnimations[ animationName ] = instanceAnimation;
            instanceAnimationList.push( instanceAnimation );
        }

        <span class="hljs-keyword">return</span> instanceAnimationList;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>add channels from instance animation to the active channels list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _addActiveChannels: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> t, instanceAnimation </span>) </span>{

        <span class="hljs-keyword">var</span> instanceChannels = instanceAnimation.channels;
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, ni = instanceChannels.length; i &lt; ni; i++ ) {
            <span class="hljs-keyword">var</span> instanceChannel = instanceChannels[ i ];
            <span class="hljs-keyword">var</span> type = instanceChannel.channel.type;
            instanceChannel.t = t; <span class="hljs-comment">// reset time</span>
            instanceChannel.instanceAnimation = instanceAnimation; <span class="hljs-comment">// link with parent animation</span>
            <span class="hljs-keyword">var</span> targetID = instanceChannel.targetID;

            <span class="hljs-keyword">if</span> ( targetID === Target.InvalidTargetID ) <span class="hljs-keyword">continue</span>;

            <span class="hljs-keyword">this</span>._activeChannelsByTypes[ type ].push( instanceChannel );
            <span class="hljs-keyword">this</span>._targets[ targetID ].channels.push( instanceChannel );
        }

    },

    _removeActiveChannels: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> instanceAnimation </span>) </span>{

        <span class="hljs-keyword">var</span> instanceChannels = instanceAnimation.channels;
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, ni = instanceChannels.length; i &lt; ni; i++ ) {
            <span class="hljs-keyword">var</span> instanceChannel = instanceChannels[ i ];
            <span class="hljs-keyword">var</span> type = instanceChannel.channel.type;
            <span class="hljs-keyword">var</span> targetID = instanceChannel.targetID;

            <span class="hljs-keyword">if</span> ( targetID === Target.InvalidTargetID ) <span class="hljs-keyword">continue</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>remove channel instance from targetID channel list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> targetChannelsList = <span class="hljs-keyword">this</span>._targets[ targetID ].channels;
            <span class="hljs-keyword">var</span> index = targetChannelsList.indexOf( instanceChannel );
            targetChannelsList.splice( index, <span class="hljs-number">1</span> );</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>remove channel from active channels</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> channelTypeList = <span class="hljs-keyword">this</span>._activeChannelsByTypes[ type ];
            <span class="hljs-keyword">var</span> channelIndex = channelTypeList.indexOf( instanceChannel );
            channelTypeList.splice( channelIndex, <span class="hljs-number">1</span> );
        }

    },</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>blend value from each channels for each target
or copy default value if not updated by an active animation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _updateTargetType: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> targetList, operatorType </span>) </span>{

        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, ni = targetList.length; i &lt; ni; i++ ) {

            <span class="hljs-keyword">var</span> target = targetList[ i ];
            <span class="hljs-keyword">var</span> affectedChannels = target.channels;
            <span class="hljs-keyword">var</span> nbChannels = affectedChannels.length;</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>note operatorType operations doesn’t always operate on arrays (float)
so we can’t simply assume that target.value is an array so we need
to write “target.value = …”</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">if</span> ( nbChannels === <span class="hljs-number">0</span> ) { <span class="hljs-comment">// no blending ?</span>
                target.value = operatorType.copy( target.defaultValue, target.value );

            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( nbChannels === <span class="hljs-number">1</span> ) {
                target.value = operatorType.copy( affectedChannels[ <span class="hljs-number">0</span> ].value, target.value );

            } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>blend between multiple channels</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                target.value = operatorType.init( target.value );
                <span class="hljs-keyword">var</span> accumulatedWeight = <span class="hljs-number">0.0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>it’s the same as targetOut = (v0 <em> w0 + v1 </em> w1 + …) / (w0 + w1 + …)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>, nj = affectedChannels.length; j &lt; nj; j++ ) {

                    <span class="hljs-keyword">var</span> achannel = affectedChannels[ j ];
                    <span class="hljs-keyword">var</span> weight = achannel.weight;
                    accumulatedWeight += weight;</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>avoid divide by zero and useless lerp</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> ( accumulatedWeight === <span class="hljs-number">0.0</span> || weight === <span class="hljs-number">0.0</span> )
                        <span class="hljs-keyword">continue</span>;

                    <span class="hljs-keyword">var</span> ratio = weight / accumulatedWeight;
                    target.value = operatorType.lerp( ratio, target.value, achannel.value, target.value );
                }
            }
        }
    },

    _updateChannelsType: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> t, channels, interpolator </span>) </span>{

        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, ni = channels.length; i &lt; ni; i++ ) {
            <span class="hljs-keyword">var</span> channel = channels[ i ];
            <span class="hljs-keyword">var</span> instanceAnimation = channel.instanceAnimation;
            <span class="hljs-keyword">var</span> loop = instanceAnimation.loop;

            <span class="hljs-keyword">var</span> tLocal = t - channel.t;</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>handle loop, careful in case animation is one frame</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> ( loop &amp;&amp; instanceAnimation.duration &gt; <span class="hljs-number">0.0</span> ) tLocal = tLocal % instanceAnimation.duration;

            interpolator( tLocal + instanceAnimation.firstKeyTime, channel );
        }
    },

    _removeFinishedAnimation: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> t </span>) </span>{

        <span class="hljs-keyword">var</span> activeAnimationList = <span class="hljs-keyword">this</span>._activeAnimationList;

        <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">while</span> ( i &lt; activeAnimationList.length ) {
            <span class="hljs-keyword">var</span> instanceAnimation = activeAnimationList[ i ];
            <span class="hljs-keyword">var</span> name = instanceAnimation.name;

            <span class="hljs-keyword">if</span> ( t &gt; instanceAnimation.end &amp;&amp; instanceAnimation.loop === <span class="hljs-literal">false</span> ) {
                <span class="hljs-keyword">this</span>._removeActiveChannels( instanceAnimation );
                <span class="hljs-keyword">this</span>._activeAnimations[ name ] = <span class="hljs-literal">undefined</span>;
                activeAnimationList.splice( i, <span class="hljs-number">1</span> );
            } <span class="hljs-keyword">else</span> {
                i++;
            }
        }
    },

    _addActiveAnimation: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> t, cmd </span>) </span>{

        <span class="hljs-keyword">this</span>._activeAnimations[ cmd.name ] = cmd; <span class="hljs-comment">// set animation in the list of active one</span>

        <span class="hljs-keyword">var</span> instanceAnimation = <span class="hljs-keyword">this</span>._instanceAnimations[ cmd.name ];
        instanceAnimation.start = t;
        instanceAnimation.end = t + instanceAnimation.duration;
        <span class="hljs-keyword">this</span>._addActiveChannels( t, instanceAnimation );</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>keep track of instance animation active in a list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>._activeAnimationList.push( instanceAnimation );
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>execute start animations events
during the updateManager</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _processStartAnimation: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> t </span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>dont really start animation if we dont have yet targets</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> ( !<span class="hljs-keyword">this</span>._targets.length ) <span class="hljs-keyword">return</span>;

        <span class="hljs-keyword">var</span> animations = <span class="hljs-keyword">this</span>._startAnimations;
        <span class="hljs-keyword">var</span> keys = <span class="hljs-built_in">window</span>.Object.keys( animations );
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, ni = keys.length; i &lt; ni; i++ ) {
            <span class="hljs-keyword">var</span> key = keys[ i ];
            <span class="hljs-keyword">var</span> cmd = animations[ key ];
            <span class="hljs-keyword">var</span> name = cmd.name;

            <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.isPlaying( name ) )
                <span class="hljs-keyword">continue</span>;

            <span class="hljs-keyword">this</span>._addActiveAnimation( t, cmd );
        }

        <span class="hljs-keyword">if</span> ( keys.length ) <span class="hljs-keyword">this</span>._startAnimations = {};
    },

    _resetTargets: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">this</span>._targetMap = {};
        <span class="hljs-keyword">this</span>._targets.length = <span class="hljs-number">0</span>;

        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, ni = <span class="hljs-keyword">this</span>._targetsByTypes.length; i &lt; ni; i++ ) {
            <span class="hljs-keyword">this</span>._targetsByTypes[ i ].length = <span class="hljs-number">0</span>;
        }

    },

    setAnimationLerpEndStart: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> anim, lerpDuration </span>) </span>{
        <span class="hljs-keyword">var</span> channels = anim.channels;
        <span class="hljs-keyword">if</span> ( anim.originalDuration === <span class="hljs-literal">undefined</span> )
            anim.originalDuration = anim.duration;

        anim.duration = anim.originalDuration + lerpDuration;

        <span class="hljs-keyword">var</span> firstKey = anim.firstKeyTime;
        <span class="hljs-keyword">var</span> animDuration = anim.originalDuration;

        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, nbChannels = channels.length; i &lt; nbChannels; ++i ) {
            <span class="hljs-keyword">var</span> ch = channels[ i ].channel;</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>compare first and last key and detect if we can loop the channel or not
it uses an arbitrary epsilon</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">Math</span>.abs( ch.start - firstKey ) &gt; <span class="hljs-number">0.01</span> || <span class="hljs-built_in">Math</span>.abs( ch.duration - animDuration ) &gt; <span class="hljs-number">0.01</span> )
                <span class="hljs-keyword">continue</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>update channel end time</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> ( ch.originalEnd === <span class="hljs-literal">undefined</span> )
                ch.originalEnd = ch.end;

            ch.end = ch.originalEnd + lerpDuration;</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>add or remove additonal key and time</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">var</span> sizeElt = TypeToSize[ ch.type ];
            <span class="hljs-keyword">var</span> size = ch.times.buffer.byteLength / <span class="hljs-number">4</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>no lerp between end and start</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> ( lerpDuration === <span class="hljs-number">0.0</span> ) {

                ch.keys = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Float32Array</span>( ch.keys.buffer, <span class="hljs-number">0</span>, ( size - <span class="hljs-number">1</span> ) * sizeElt );
                ch.times = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Float32Array</span>( ch.times.buffer, <span class="hljs-number">0</span>, size - <span class="hljs-number">1</span> );

            } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>take full size of buffer (with additional keys)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                ch.keys = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Float32Array</span>( ch.keys.buffer, <span class="hljs-number">0</span>, size * sizeElt );</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>copy first key</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">var</span> idLast = ( size - <span class="hljs-number">1</span> ) * sizeElt;
                <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; sizeElt; ++j )
                    ch.keys[ idLast + j ] = ch.keys[ j ];

                ch.times = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Float32Array</span>( ch.times.buffer, <span class="hljs-number">0</span>, size );
                ch.times[ size - <span class="hljs-number">1</span> ] = ch.times[ size - <span class="hljs-number">2</span> ] + lerpDuration;
            }
        }
    }

} );

BasicAnimationManager.TypeToSize = TypeToSize;

<span class="hljs-built_in">module</span>.exports = BasicAnimationManager;</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
